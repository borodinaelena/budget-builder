import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject, Injectable, InjectionToken, Injector, NgModule } from '@angular/core';
import { __assign, __decorate, __extends, __metadata, __param } from 'tslib';
import { CommonModule, Location } from '@angular/common';
import { ActivatedRoute, Router, RouterModule } from '@angular/router';
import { FormsModule } from '@angular/forms';
import { NB_WINDOW, NbAlertModule, NbButtonModule, NbCardModule, NbCheckboxModule, NbIconModule, NbInputModule, NbLayoutModule } from '@nebular/theme';
import { BehaviorSubject, Subject, of } from 'rxjs';
import { catchError, delay, filter, map, share, switchMap, takeUntil } from 'rxjs/operators';
import { HttpClient, HttpErrorResponse, HttpHeaders, HttpResponse } from '@angular/common/http';

import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@nebular/theme';
import * as ɵngcc5 from '@angular/forms';

var _c0 = ["*"];
function NbLoginComponent_nb_alert_4_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 26);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var error_r10 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(error_r10);
} }
function NbLoginComponent_nb_alert_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 22);
    ɵngcc0.ɵɵelementStart(1, "p", 23);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Oh snap!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 24);
    ɵngcc0.ɵɵtemplate(5, NbLoginComponent_nb_alert_4_li_5_Template, 2, 1, "li", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.errors);
} }
function NbLoginComponent_nb_alert_5_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 26);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var message_r12 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(message_r12);
} }
function NbLoginComponent_nb_alert_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 27);
    ɵngcc0.ɵɵelementStart(1, "p", 23);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Hooray!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 24);
    ɵngcc0.ɵɵtemplate(5, NbLoginComponent_nb_alert_5_li_5_Template, 2, 1, "li", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.messages);
} }
function NbLoginComponent_ng_container_13_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 29);
    ɵngcc0.ɵɵtext(1, " Email is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbLoginComponent_ng_container_13_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 29);
    ɵngcc0.ɵɵtext(1, " Email should be the real one! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbLoginComponent_ng_container_13_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbLoginComponent_ng_container_13_p_1_Template, 2, 0, "p", 28);
    ɵngcc0.ɵɵtemplate(2, NbLoginComponent_ng_container_13_p_2_Template, 2, 0, "p", 28);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r3 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.pattern);
} }
function NbLoginComponent_ng_container_22_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 29);
    ɵngcc0.ɵɵtext(1, " Password is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbLoginComponent_ng_container_22_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 29);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r16 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" Password should contain from ", ctx_r16.getConfigValue("forms.validation.password.minLength"), " to ", ctx_r16.getConfigValue("forms.validation.password.maxLength"), " characters ");
} }
function NbLoginComponent_ng_container_22_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbLoginComponent_ng_container_22_p_1_Template, 2, 0, "p", 28);
    ɵngcc0.ɵɵtemplate(2, NbLoginComponent_ng_container_22_p_2_Template, 2, 2, "p", 28);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r5 = ɵngcc0.ɵɵreference(21);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r5.errors == null ? null : _r5.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (_r5.errors == null ? null : _r5.errors.minlength) || (_r5.errors == null ? null : _r5.errors.maxlength));
} }
function NbLoginComponent_nb_checkbox_24_Template(rf, ctx) { if (rf & 1) {
    var _r18 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "nb-checkbox", 30);
    ɵngcc0.ɵɵlistener("ngModelChange", function NbLoginComponent_nb_checkbox_24_Template_nb_checkbox_ngModelChange_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r18); var ctx_r17 = ɵngcc0.ɵɵnextContext(); return ctx_r17.user.rememberMe = $event; });
    ɵngcc0.ɵɵtext(1, "Remember me");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r7 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngModel", ctx_r7.user.rememberMe);
} }
function NbLoginComponent_section_27_ng_container_3_a_1_nb_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "nb-icon", 39);
} if (rf & 2) {
    var socialLink_r20 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵproperty("icon", socialLink_r20.icon);
} }
function NbLoginComponent_section_27_ng_container_3_a_1_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
} if (rf & 2) {
    var socialLink_r20 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵtextInterpolate(socialLink_r20.title);
} }
function NbLoginComponent_section_27_ng_container_3_a_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 36);
    ɵngcc0.ɵɵtemplate(1, NbLoginComponent_section_27_ng_container_3_a_1_nb_icon_1_Template, 1, 1, "nb-icon", 37);
    ɵngcc0.ɵɵtemplate(2, NbLoginComponent_section_27_ng_container_3_a_1_ng_template_2_Template, 1, 1, "ng-template", null, 38, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var _r24 = ɵngcc0.ɵɵreference(3);
    var socialLink_r20 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵclassProp("with-icon", socialLink_r20.icon);
    ɵngcc0.ɵɵproperty("routerLink", socialLink_r20.link);
    ɵngcc0.ɵɵattribute("target", socialLink_r20.target)("class", socialLink_r20.icon);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r20.icon)("ngIfElse", _r24);
} }
function NbLoginComponent_section_27_ng_container_3_a_2_nb_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "nb-icon", 39);
} if (rf & 2) {
    var socialLink_r20 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵproperty("icon", socialLink_r20.icon);
} }
function NbLoginComponent_section_27_ng_container_3_a_2_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
} if (rf & 2) {
    var socialLink_r20 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵtextInterpolate(socialLink_r20.title);
} }
function NbLoginComponent_section_27_ng_container_3_a_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a");
    ɵngcc0.ɵɵtemplate(1, NbLoginComponent_section_27_ng_container_3_a_2_nb_icon_1_Template, 1, 1, "nb-icon", 37);
    ɵngcc0.ɵɵtemplate(2, NbLoginComponent_section_27_ng_container_3_a_2_ng_template_2_Template, 1, 1, "ng-template", null, 38, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var _r30 = ɵngcc0.ɵɵreference(3);
    var socialLink_r20 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵclassProp("with-icon", socialLink_r20.icon);
    ɵngcc0.ɵɵattribute("href", socialLink_r20.url, ɵngcc0.ɵɵsanitizeUrl)("target", socialLink_r20.target)("class", socialLink_r20.icon);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r20.icon)("ngIfElse", _r30);
} }
function NbLoginComponent_section_27_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbLoginComponent_section_27_ng_container_3_a_1_Template, 4, 7, "a", 34);
    ɵngcc0.ɵɵtemplate(2, NbLoginComponent_section_27_ng_container_3_a_2_Template, 4, 7, "a", 35);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    var socialLink_r20 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r20.link);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r20.url);
} }
function NbLoginComponent_section_27_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 31);
    ɵngcc0.ɵɵtext(1, " or enter with: ");
    ɵngcc0.ɵɵelementStart(2, "div", 32);
    ɵngcc0.ɵɵtemplate(3, NbLoginComponent_section_27_ng_container_3_Template, 3, 2, "ng-container", 33);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r8 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r8.socialLinks);
} }
function NbRegisterComponent_nb_alert_2_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 28);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var error_r14 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(error_r14);
} }
function NbRegisterComponent_nb_alert_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 24);
    ɵngcc0.ɵɵelementStart(1, "p", 25);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Oh snap!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 26);
    ɵngcc0.ɵɵtemplate(5, NbRegisterComponent_nb_alert_2_li_5_Template, 2, 1, "li", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.errors);
} }
function NbRegisterComponent_nb_alert_3_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 28);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var message_r16 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(message_r16);
} }
function NbRegisterComponent_nb_alert_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 29);
    ɵngcc0.ɵɵelementStart(1, "p", 25);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Hooray!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 26);
    ɵngcc0.ɵɵtemplate(5, NbRegisterComponent_nb_alert_3_li_5_Template, 2, 1, "li", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.messages);
} }
function NbRegisterComponent_ng_container_11_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Full name is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_11_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r18 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" Full name should contains from ", ctx_r18.getConfigValue("forms.validation.fullName.minLength"), " to ", ctx_r18.getConfigValue("forms.validation.fullName.maxLength"), " characters ");
} }
function NbRegisterComponent_ng_container_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_ng_container_11_p_1_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_ng_container_11_p_2_Template, 2, 2, "p", 30);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r3 = ɵngcc0.ɵɵreference(10);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (_r3.errors == null ? null : _r3.errors.minlength) || (_r3.errors == null ? null : _r3.errors.maxlength));
} }
function NbRegisterComponent_ng_container_17_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Email is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_17_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Email should be the real one! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_17_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_ng_container_17_p_1_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_ng_container_17_p_2_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r5 = ɵngcc0.ɵɵreference(16);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r5.errors == null ? null : _r5.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r5.errors == null ? null : _r5.errors.pattern);
} }
function NbRegisterComponent_ng_container_23_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Password is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_23_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r22 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" Password should contain from ", ctx_r22.getConfigValue("forms.validation.password.minLength"), " to ", ctx_r22.getConfigValue("forms.validation.password.maxLength"), " characters ");
} }
function NbRegisterComponent_ng_container_23_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_ng_container_23_p_1_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_ng_container_23_p_2_Template, 2, 2, "p", 30);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r7 = ɵngcc0.ɵɵreference(22);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r7.errors == null ? null : _r7.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (_r7.errors == null ? null : _r7.errors.minlength) || (_r7.errors == null ? null : _r7.errors.maxlength));
} }
function NbRegisterComponent_ng_container_29_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Password confirmation is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_29_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 31);
    ɵngcc0.ɵɵtext(1, " Password does not match the confirm password. ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRegisterComponent_ng_container_29_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_ng_container_29_p_1_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_ng_container_29_p_2_Template, 2, 0, "p", 30);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r9 = ɵngcc0.ɵɵreference(28);
    var _r7 = ɵngcc0.ɵɵreference(22);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r9.errors == null ? null : _r9.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r7.value != _r9.value && !(_r9.errors == null ? null : _r9.errors.required));
} }
function NbRegisterComponent_div_30_Template(rf, ctx) { if (rf & 1) {
    var _r26 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 32);
    ɵngcc0.ɵɵelementStart(1, "nb-checkbox", 33);
    ɵngcc0.ɵɵlistener("ngModelChange", function NbRegisterComponent_div_30_Template_nb_checkbox_ngModelChange_1_listener($event) { ɵngcc0.ɵɵrestoreView(_r26); var ctx_r25 = ɵngcc0.ɵɵnextContext(); return ctx_r25.user.terms = $event; });
    ɵngcc0.ɵɵtext(2, " Agree to ");
    ɵngcc0.ɵɵelementStart(3, "a", 34);
    ɵngcc0.ɵɵelementStart(4, "strong");
    ɵngcc0.ɵɵtext(5, "Terms & Conditions");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r11 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngModel", ctx_r11.user.terms)("required", ctx_r11.getConfigValue("forms.register.terms"));
} }
function NbRegisterComponent_section_33_ng_container_3_a_1_nb_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "nb-icon", 43);
} if (rf & 2) {
    var socialLink_r28 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵproperty("icon", socialLink_r28.icon);
} }
function NbRegisterComponent_section_33_ng_container_3_a_1_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
} if (rf & 2) {
    var socialLink_r28 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵtextInterpolate(socialLink_r28.title);
} }
function NbRegisterComponent_section_33_ng_container_3_a_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 40);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_section_33_ng_container_3_a_1_nb_icon_1_Template, 1, 1, "nb-icon", 41);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_section_33_ng_container_3_a_1_ng_template_2_Template, 1, 1, "ng-template", null, 42, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var _r32 = ɵngcc0.ɵɵreference(3);
    var socialLink_r28 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵclassProp("with-icon", socialLink_r28.icon);
    ɵngcc0.ɵɵproperty("routerLink", socialLink_r28.link);
    ɵngcc0.ɵɵattribute("target", socialLink_r28.target)("class", socialLink_r28.icon);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r28.icon)("ngIfElse", _r32);
} }
function NbRegisterComponent_section_33_ng_container_3_a_2_nb_icon_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "nb-icon", 43);
} if (rf & 2) {
    var socialLink_r28 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵproperty("icon", socialLink_r28.icon);
} }
function NbRegisterComponent_section_33_ng_container_3_a_2_ng_template_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtext(0);
} if (rf & 2) {
    var socialLink_r28 = ɵngcc0.ɵɵnextContext(2).$implicit;
    ɵngcc0.ɵɵtextInterpolate(socialLink_r28.title);
} }
function NbRegisterComponent_section_33_ng_container_3_a_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a");
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_section_33_ng_container_3_a_2_nb_icon_1_Template, 1, 1, "nb-icon", 41);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_section_33_ng_container_3_a_2_ng_template_2_Template, 1, 1, "ng-template", null, 42, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var _r38 = ɵngcc0.ɵɵreference(3);
    var socialLink_r28 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵclassProp("with-icon", socialLink_r28.icon);
    ɵngcc0.ɵɵattribute("href", socialLink_r28.url, ɵngcc0.ɵɵsanitizeUrl)("target", socialLink_r28.target)("class", socialLink_r28.icon);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r28.icon)("ngIfElse", _r38);
} }
function NbRegisterComponent_section_33_ng_container_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRegisterComponent_section_33_ng_container_3_a_1_Template, 4, 7, "a", 38);
    ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_section_33_ng_container_3_a_2_Template, 4, 7, "a", 39);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    var socialLink_r28 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r28.link);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", socialLink_r28.url);
} }
function NbRegisterComponent_section_33_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "section", 35);
    ɵngcc0.ɵɵtext(1, " or enter with: ");
    ɵngcc0.ɵɵelementStart(2, "div", 36);
    ɵngcc0.ɵɵtemplate(3, NbRegisterComponent_section_33_ng_container_3_Template, 3, 2, "ng-container", 37);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r12 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r12.socialLinks);
} }
function NbRequestPasswordComponent_nb_alert_4_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 19);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var error_r6 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(error_r6);
} }
function NbRequestPasswordComponent_nb_alert_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 15);
    ɵngcc0.ɵɵelementStart(1, "p", 16);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Oh snap!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 17);
    ɵngcc0.ɵɵtemplate(5, NbRequestPasswordComponent_nb_alert_4_li_5_Template, 2, 1, "li", 18);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.errors);
} }
function NbRequestPasswordComponent_nb_alert_5_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 19);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var message_r8 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(message_r8);
} }
function NbRequestPasswordComponent_nb_alert_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 20);
    ɵngcc0.ɵɵelementStart(1, "p", 16);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Hooray!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 17);
    ɵngcc0.ɵɵtemplate(5, NbRequestPasswordComponent_nb_alert_5_li_5_Template, 2, 1, "li", 18);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.messages);
} }
function NbRequestPasswordComponent_ng_container_13_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 22);
    ɵngcc0.ɵɵtext(1, " Email is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRequestPasswordComponent_ng_container_13_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 22);
    ɵngcc0.ɵɵtext(1, " Email should be the real one! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbRequestPasswordComponent_ng_container_13_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbRequestPasswordComponent_ng_container_13_p_1_Template, 2, 0, "p", 21);
    ɵngcc0.ɵɵtemplate(2, NbRequestPasswordComponent_ng_container_13_p_2_Template, 2, 0, "p", 21);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r3 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.pattern);
} }
function NbResetPasswordComponent_nb_alert_4_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 23);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var error_r8 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(error_r8);
} }
function NbResetPasswordComponent_nb_alert_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 19);
    ɵngcc0.ɵɵelementStart(1, "p", 20);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Oh snap!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 21);
    ɵngcc0.ɵɵtemplate(5, NbResetPasswordComponent_nb_alert_4_li_5_Template, 2, 1, "li", 22);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.errors);
} }
function NbResetPasswordComponent_nb_alert_5_li_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 23);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var message_r10 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(message_r10);
} }
function NbResetPasswordComponent_nb_alert_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "nb-alert", 24);
    ɵngcc0.ɵɵelementStart(1, "p", 20);
    ɵngcc0.ɵɵelementStart(2, "b");
    ɵngcc0.ɵɵtext(3, "Hooray!");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "ul", 21);
    ɵngcc0.ɵɵtemplate(5, NbResetPasswordComponent_nb_alert_5_li_5_Template, 2, 1, "li", 22);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r1.messages);
} }
function NbResetPasswordComponent_ng_container_13_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 26);
    ɵngcc0.ɵɵtext(1, " Password is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbResetPasswordComponent_ng_container_13_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 26);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r12 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2(" Password should contains from ", ctx_r12.getConfigValue("forms.validation.password.minLength"), " to ", ctx_r12.getConfigValue("forms.validation.password.maxLength"), " characters ");
} }
function NbResetPasswordComponent_ng_container_13_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbResetPasswordComponent_ng_container_13_p_1_Template, 2, 0, "p", 25);
    ɵngcc0.ɵɵtemplate(2, NbResetPasswordComponent_ng_container_13_p_2_Template, 2, 2, "p", 25);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r3 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.errors == null ? null : _r3.errors.required);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (_r3.errors == null ? null : _r3.errors.minlength) || (_r3.errors == null ? null : _r3.errors.maxlength));
} }
function NbResetPasswordComponent_ng_container_19_p_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 26);
    ɵngcc0.ɵɵtext(1, " Password confirmation is required! ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbResetPasswordComponent_ng_container_19_p_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 26);
    ɵngcc0.ɵɵtext(1, " Password does not match the confirm password. ");
    ɵngcc0.ɵɵelementEnd();
} }
function NbResetPasswordComponent_ng_container_19_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵtemplate(1, NbResetPasswordComponent_ng_container_19_p_1_Template, 2, 0, "p", 25);
    ɵngcc0.ɵɵtemplate(2, NbResetPasswordComponent_ng_container_19_p_2_Template, 2, 0, "p", 25);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵnextContext();
    var _r5 = ɵngcc0.ɵɵreference(18);
    var _r3 = ɵngcc0.ɵɵreference(12);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r5.invalid && (_r5.errors == null ? null : _r5.errors.required));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", _r3.value != _r5.value && !(_r5.errors == null ? null : _r5.errors.required));
} }
var socialLinks = [];
var defaultAuthOptions = {
    strategies: [],
    forms: {
        login: {
            redirectDelay: 500,
            strategy: 'email',
            rememberMe: true,
            showMessages: {
                success: true,
                error: true,
            },
            socialLinks: socialLinks,
        },
        register: {
            redirectDelay: 500,
            strategy: 'email',
            showMessages: {
                success: true,
                error: true,
            },
            terms: true,
            socialLinks: socialLinks,
        },
        requestPassword: {
            redirectDelay: 500,
            strategy: 'email',
            showMessages: {
                success: true,
                error: true,
            },
            socialLinks: socialLinks,
        },
        resetPassword: {
            redirectDelay: 500,
            strategy: 'email',
            showMessages: {
                success: true,
                error: true,
            },
            socialLinks: socialLinks,
        },
        logout: {
            redirectDelay: 500,
            strategy: 'email',
        },
        validation: {
            password: {
                required: true,
                minLength: 4,
                maxLength: 50,
            },
            email: {
                required: true,
            },
            fullName: {
                required: false,
                minLength: 4,
                maxLength: 50,
            },
        },
    },
};
var NB_AUTH_OPTIONS = new InjectionToken('Nebular Auth Options');
var NB_AUTH_USER_OPTIONS = new InjectionToken('Nebular User Auth Options');
var NB_AUTH_STRATEGIES = new InjectionToken('Nebular Auth Strategies');
var NB_AUTH_TOKENS = new InjectionToken('Nebular Auth Tokens');
var NB_AUTH_INTERCEPTOR_HEADER = new InjectionToken('Nebular Simple Interceptor Header');
var NB_AUTH_TOKEN_INTERCEPTOR_FILTER = new InjectionToken('Nebular Interceptor Filter');

/**
 * Extending object that entered in first argument.
 *
 * Returns extended object or false if have no target object or incorrect type.
 *
 * If you wish to clone source object (without modify it), just use empty new
 * object as first argument, like this:
 *   deepExtend({}, yourObj_1, [yourObj_N]);
 */
var deepExtend = function () {
    var objects = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        objects[_i] = arguments[_i];
    }
    if (arguments.length < 1 || typeof arguments[0] !== 'object') {
        return false;
    }
    if (arguments.length < 2) {
        return arguments[0];
    }
    var target = arguments[0];
    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);
    var val, src;
    args.forEach(function (obj) {
        // skip argument if it is array or isn't object
        if (typeof obj !== 'object' || Array.isArray(obj)) {
            return;
        }
        Object.keys(obj).forEach(function (key) {
            src = target[key]; // source value
            val = obj[key]; // new value
            // recursion prevention
            if (val === target) {
                return;
                /**
                 * if new value isn't object then just overwrite by new value
                 * instead of extending.
                 */
            }
            else if (typeof val !== 'object' || val === null) {
                target[key] = val;
                return;
                // just clone arrays (and recursive clone objects inside)
            }
            else if (Array.isArray(val)) {
                target[key] = deepCloneArray(val);
                return;
                // custom cloning and overwrite for specific objects
            }
            else if (isSpecificValue(val)) {
                target[key] = cloneSpecificValue(val);
                return;
                // overwrite by new value if source isn't object or array
            }
            else if (typeof src !== 'object' || src === null || Array.isArray(src)) {
                target[key] = deepExtend({}, val);
                return;
                // source value and new value is objects both, extending...
            }
            else {
                target[key] = deepExtend(src, val);
                return;
            }
        });
    });
    return target;
};
function isSpecificValue(val) {
    return (val instanceof Date
        || val instanceof RegExp) ? true : false;
}
function cloneSpecificValue(val) {
    if (val instanceof Date) {
        return new Date(val.getTime());
    }
    else if (val instanceof RegExp) {
        return new RegExp(val);
    }
    else {
        throw new Error('cloneSpecificValue: Unexpected situation');
    }
}
/**
 * Recursive cloning array.
 */
function deepCloneArray(arr) {
    var clone = [];
    arr.forEach(function (item, index) {
        if (typeof item === 'object' && item !== null) {
            if (Array.isArray(item)) {
                clone[index] = deepCloneArray(item);
            }
            else if (isSpecificValue(item)) {
                clone[index] = cloneSpecificValue(item);
            }
            else {
                clone[index] = deepExtend({}, item);
            }
        }
        else {
            clone[index] = item;
        }
    });
    return clone;
}
// getDeepFromObject({result: {data: 1}}, 'result.data', 2); // returns 1
function getDeepFromObject(object, name, defaultValue) {
    if (object === void 0) { object = {}; }
    var keys = name.split('.');
    // clone the object
    var level = deepExtend({}, object || {});
    keys.forEach(function (k) {
        if (level && typeof level[k] !== 'undefined') {
            level = level[k];
        }
        else {
            level = undefined;
        }
    });
    return typeof level === 'undefined' ? defaultValue : level;
}
function urlBase64Decode(str) {
    var output = str.replace(/-/g, '+').replace(/_/g, '/');
    switch (output.length % 4) {
        case 0: {
            break;
        }
        case 2: {
            output += '==';
            break;
        }
        case 3: {
            output += '=';
            break;
        }
        default: {
            throw new Error('Illegal base64url string!');
        }
    }
    return b64DecodeUnicode(output);
}
function b64decode(str) {
    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    var output = '';
    str = String(str).replace(/=+$/, '');
    if (str.length % 4 === 1) {
        throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");
    }
    for (
    // initialize result and counters
    var bc = 0, bs = void 0, buffer = void 0, idx = 0; 
    // get next character
    buffer = str.charAt(idx++); 
    // character found in table? initialize bit storage and add its ascii value;
    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,
        // and if not first of each 4 characters,
        // convert the first 8 bits to one ascii character
        bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0) {
        // try to find character in table (0-63, not found => -1)
        buffer = chars.indexOf(buffer);
    }
    return output;
}
// https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem
function b64DecodeUnicode(str) {
    return decodeURIComponent(Array.prototype.map.call(b64decode(str), function (c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
}

var NbAuthToken = /** @class */ (function () {
    function NbAuthToken() {
        this.payload = null;
    }
    NbAuthToken.prototype.getName = function () {
        return this.constructor.NAME;
    };
    NbAuthToken.prototype.getPayload = function () {
        return this.payload;
    };
    return NbAuthToken;
}());
var NbAuthTokenNotFoundError = /** @class */ (function (_super) {
    __extends(NbAuthTokenNotFoundError, _super);
    function NbAuthTokenNotFoundError(message) {
        var _newTarget = this.constructor;
        var _this = _super.call(this, message) || this;
        Object.setPrototypeOf(_this, _newTarget.prototype);
        return _this;
    }
    return NbAuthTokenNotFoundError;
}(Error));
var NbAuthIllegalTokenError = /** @class */ (function (_super) {
    __extends(NbAuthIllegalTokenError, _super);
    function NbAuthIllegalTokenError(message) {
        var _newTarget = this.constructor;
        var _this = _super.call(this, message) || this;
        Object.setPrototypeOf(_this, _newTarget.prototype);
        return _this;
    }
    return NbAuthIllegalTokenError;
}(Error));
var NbAuthEmptyTokenError = /** @class */ (function (_super) {
    __extends(NbAuthEmptyTokenError, _super);
    function NbAuthEmptyTokenError(message) {
        var _newTarget = this.constructor;
        var _this = _super.call(this, message) || this;
        Object.setPrototypeOf(_this, _newTarget.prototype);
        return _this;
    }
    return NbAuthEmptyTokenError;
}(NbAuthIllegalTokenError));
var NbAuthIllegalJWTTokenError = /** @class */ (function (_super) {
    __extends(NbAuthIllegalJWTTokenError, _super);
    function NbAuthIllegalJWTTokenError(message) {
        var _newTarget = this.constructor;
        var _this = _super.call(this, message) || this;
        Object.setPrototypeOf(_this, _newTarget.prototype);
        return _this;
    }
    return NbAuthIllegalJWTTokenError;
}(NbAuthIllegalTokenError));
function nbAuthCreateToken(tokenClass, token, ownerStrategyName, createdAt) {
    return new tokenClass(token, ownerStrategyName, createdAt);
}
function decodeJwtPayload(payload) {
    if (payload.length === 0) {
        throw new NbAuthEmptyTokenError('Cannot extract from an empty payload.');
    }
    var parts = payload.split('.');
    if (parts.length !== 3) {
        throw new NbAuthIllegalJWTTokenError("The payload " + payload + " is not valid JWT payload and must consist of three parts.");
    }
    var decoded;
    try {
        decoded = urlBase64Decode(parts[1]);
    }
    catch (e) {
        throw new NbAuthIllegalJWTTokenError("The payload " + payload + " is not valid JWT payload and cannot be parsed.");
    }
    if (!decoded) {
        throw new NbAuthIllegalJWTTokenError("The payload " + payload + " is not valid JWT payload and cannot be decoded.");
    }
    return JSON.parse(decoded);
}
/**
 * Wrapper for simple (text) token
 */
var NbAuthSimpleToken = /** @class */ (function (_super) {
    __extends(NbAuthSimpleToken, _super);
    function NbAuthSimpleToken(token, ownerStrategyName, createdAt) {
        var _this = _super.call(this) || this;
        _this.token = token;
        _this.ownerStrategyName = ownerStrategyName;
        _this.createdAt = createdAt;
        try {
            _this.parsePayload();
        }
        catch (err) {
            if (!(err instanceof NbAuthTokenNotFoundError)) {
                // token is present but has got a problem, including illegal
                throw err;
            }
        }
        _this.createdAt = _this.prepareCreatedAt(createdAt);
        return _this;
    }
    NbAuthSimpleToken.prototype.parsePayload = function () {
        this.payload = null;
    };
    NbAuthSimpleToken.prototype.prepareCreatedAt = function (date) {
        return date ? date : new Date();
    };
    /**
     * Returns the token's creation date
     * @returns {Date}
     */
    NbAuthSimpleToken.prototype.getCreatedAt = function () {
        return this.createdAt;
    };
    /**
     * Returns the token value
     * @returns string
     */
    NbAuthSimpleToken.prototype.getValue = function () {
        return this.token;
    };
    NbAuthSimpleToken.prototype.getOwnerStrategyName = function () {
        return this.ownerStrategyName;
    };
    /**
     * Is non empty and valid
     * @returns {boolean}
     */
    NbAuthSimpleToken.prototype.isValid = function () {
        return !!this.getValue();
    };
    /**
     * Validate value and convert to string, if value is not valid return empty string
     * @returns {string}
     */
    NbAuthSimpleToken.prototype.toString = function () {
        return !!this.token ? this.token : '';
    };
    NbAuthSimpleToken.NAME = 'nb:auth:simple:token';
    return NbAuthSimpleToken;
}(NbAuthToken));
/**
 * Wrapper for JWT token with additional methods.
 */
var NbAuthJWTToken = /** @class */ (function (_super) {
    __extends(NbAuthJWTToken, _super);
    function NbAuthJWTToken() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * for JWT token, the iat (issued at) field of the token payload contains the creation Date
     */
    NbAuthJWTToken.prototype.prepareCreatedAt = function (date) {
        var decoded = this.getPayload();
        return decoded && decoded.iat ? new Date(Number(decoded.iat) * 1000) : _super.prototype.prepareCreatedAt.call(this, date);
    };
    /**
     * Returns payload object
     * @returns any
     */
    NbAuthJWTToken.prototype.parsePayload = function () {
        if (!this.token) {
            throw new NbAuthTokenNotFoundError('Token not found. ');
        }
        this.payload = decodeJwtPayload(this.token);
    };
    /**
     * Returns expiration date
     * @returns Date
     */
    NbAuthJWTToken.prototype.getTokenExpDate = function () {
        var decoded = this.getPayload();
        if (decoded && !decoded.hasOwnProperty('exp')) {
            return null;
        }
        var date = new Date(0);
        date.setUTCSeconds(decoded.exp); // 'cause jwt token are set in seconds
        return date;
    };
    /**
     * Is data expired
     * @returns {boolean}
     */
    NbAuthJWTToken.prototype.isValid = function () {
        return _super.prototype.isValid.call(this) && (!this.getTokenExpDate() || new Date() < this.getTokenExpDate());
    };
    NbAuthJWTToken.NAME = 'nb:auth:jwt:token';
    return NbAuthJWTToken;
}(NbAuthSimpleToken));
var prepareOAuth2Token = function (data) {
    if (typeof data === 'string') {
        try {
            return JSON.parse(data);
        }
        catch (e) { }
    }
    return data;
};
var ɵ0 = prepareOAuth2Token;
/**
 * Wrapper for OAuth2 token whose access_token is a JWT Token
 */
var NbAuthOAuth2Token = /** @class */ (function (_super) {
    __extends(NbAuthOAuth2Token, _super);
    function NbAuthOAuth2Token(data, ownerStrategyName, createdAt) {
        if (data === void 0) { data = {}; }
        // we may get it as string when retrieving from a storage
        return _super.call(this, prepareOAuth2Token(data), ownerStrategyName, createdAt) || this;
    }
    /**
     * Returns the token value
     * @returns string
     */
    NbAuthOAuth2Token.prototype.getValue = function () {
        return this.token.access_token;
    };
    /**
     * Returns the refresh token
     * @returns string
     */
    NbAuthOAuth2Token.prototype.getRefreshToken = function () {
        return this.token.refresh_token;
    };
    /**
     *  put refreshToken in the token payload
      * @param refreshToken
     */
    NbAuthOAuth2Token.prototype.setRefreshToken = function (refreshToken) {
        this.token.refresh_token = refreshToken;
    };
    /**
     * Parses token payload
     * @returns any
     */
    NbAuthOAuth2Token.prototype.parsePayload = function () {
        if (!this.token) {
            throw new NbAuthTokenNotFoundError('Token not found.');
        }
        else {
            if (!Object.keys(this.token).length) {
                throw new NbAuthEmptyTokenError('Cannot extract payload from an empty token.');
            }
        }
        this.payload = this.token;
    };
    /**
     * Returns the token type
     * @returns string
     */
    NbAuthOAuth2Token.prototype.getType = function () {
        return this.token.token_type;
    };
    /**
     * Is data expired
     * @returns {boolean}
     */
    NbAuthOAuth2Token.prototype.isValid = function () {
        return _super.prototype.isValid.call(this) && (!this.getTokenExpDate() || new Date() < this.getTokenExpDate());
    };
    /**
     * Returns expiration date
     * @returns Date
     */
    NbAuthOAuth2Token.prototype.getTokenExpDate = function () {
        if (!this.token.hasOwnProperty('expires_in')) {
            return null;
        }
        return new Date(this.createdAt.getTime() + Number(this.token.expires_in) * 1000);
    };
    /**
     * Convert to string
     * @returns {string}
     */
    NbAuthOAuth2Token.prototype.toString = function () {
        return JSON.stringify(this.token);
    };
    NbAuthOAuth2Token.NAME = 'nb:auth:oauth2:token';
    return NbAuthOAuth2Token;
}(NbAuthSimpleToken));
/**
 * Wrapper for OAuth2 token embedding JWT tokens
 */
var NbAuthOAuth2JWTToken = /** @class */ (function (_super) {
    __extends(NbAuthOAuth2JWTToken, _super);
    function NbAuthOAuth2JWTToken() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NbAuthOAuth2JWTToken.prototype.parsePayload = function () {
        _super.prototype.parsePayload.call(this);
        this.parseAccessTokenPayload();
    };
    NbAuthOAuth2JWTToken.prototype.parseAccessTokenPayload = function () {
        var accessToken = this.getValue();
        if (!accessToken) {
            throw new NbAuthTokenNotFoundError('access_token key not found.');
        }
        this.accessTokenPayload = decodeJwtPayload(accessToken);
    };
    /**
     * Returns access token payload
     * @returns any
     */
    NbAuthOAuth2JWTToken.prototype.getAccessTokenPayload = function () {
        return this.accessTokenPayload;
    };
    /**
     * for Oauth2 JWT token, the iat (issued at) field of the access_token payload
     */
    NbAuthOAuth2JWTToken.prototype.prepareCreatedAt = function (date) {
        var payload = this.accessTokenPayload;
        return payload && payload.iat ? new Date(Number(payload.iat) * 1000) : _super.prototype.prepareCreatedAt.call(this, date);
    };
    /**
     * Is token valid
     * @returns {boolean}
     */
    NbAuthOAuth2JWTToken.prototype.isValid = function () {
        return this.accessTokenPayload && _super.prototype.isValid.call(this);
    };
    /**
     * Returns expiration date :
     * - exp if set,
     * - super.getExpDate() otherwise
     * @returns Date
     */
    NbAuthOAuth2JWTToken.prototype.getTokenExpDate = function () {
        if (this.accessTokenPayload && this.accessTokenPayload.hasOwnProperty('exp')) {
            var date = new Date(0);
            date.setUTCSeconds(this.accessTokenPayload.exp);
            return date;
        }
        else {
            return _super.prototype.getTokenExpDate.call(this);
        }
    };
    NbAuthOAuth2JWTToken.NAME = 'nb:auth:oauth2:jwt:token';
    return NbAuthOAuth2JWTToken;
}(NbAuthOAuth2Token));

var NB_AUTH_FALLBACK_TOKEN = new InjectionToken('Nebular Auth Options');
/**
 * Creates a token parcel which could be stored/restored
 */
var NbAuthTokenParceler = /** @class */ (function () {
    function NbAuthTokenParceler(fallbackClass, tokenClasses) {
        this.fallbackClass = fallbackClass;
        this.tokenClasses = tokenClasses;
    }
    NbAuthTokenParceler.prototype.wrap = function (token) {
        return JSON.stringify({
            name: token.getName(),
            ownerStrategyName: token.getOwnerStrategyName(),
            createdAt: token.getCreatedAt().getTime(),
            value: token.toString(),
        });
    };
    NbAuthTokenParceler.prototype.unwrap = function (value) {
        var tokenClass = this.fallbackClass;
        var tokenValue = '';
        var tokenOwnerStrategyName = '';
        var tokenCreatedAt = null;
        var tokenPack = this.parseTokenPack(value);
        if (tokenPack) {
            tokenClass = this.getClassByName(tokenPack.name) || this.fallbackClass;
            tokenValue = tokenPack.value;
            tokenOwnerStrategyName = tokenPack.ownerStrategyName;
            tokenCreatedAt = new Date(Number(tokenPack.createdAt));
        }
        return nbAuthCreateToken(tokenClass, tokenValue, tokenOwnerStrategyName, tokenCreatedAt);
    };
    // TODO: this could be moved to a separate token registry
    NbAuthTokenParceler.prototype.getClassByName = function (name) {
        return this.tokenClasses.find(function (tokenClass) { return tokenClass.NAME === name; });
    };
    NbAuthTokenParceler.prototype.parseTokenPack = function (value) {
        try {
            return JSON.parse(value);
        }
        catch (e) { }
        return null;
    };
    NbAuthTokenParceler = __decorate([ __param(0, Inject(NB_AUTH_FALLBACK_TOKEN)),
        __param(1, Inject(NB_AUTH_TOKENS)),
        __metadata("design:paramtypes", [Object, Array])
    ], NbAuthTokenParceler);
NbAuthTokenParceler.ɵfac = function NbAuthTokenParceler_Factory(t) { return new (t || NbAuthTokenParceler)(ɵngcc0.ɵɵinject(NB_AUTH_FALLBACK_TOKEN), ɵngcc0.ɵɵinject(NB_AUTH_TOKENS)); };
NbAuthTokenParceler.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbAuthTokenParceler, factory: function (t) { return NbAuthTokenParceler.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthTokenParceler, [{
        type: Injectable
    }], function () { return [{ type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_FALLBACK_TOKEN]
            }] }, { type: Array, decorators: [{
                type: Inject,
                args: [NB_AUTH_TOKENS]
            }] }]; }, null); })();
    return NbAuthTokenParceler;
}());

var NbTokenStorage = /** @class */ (function () {
    function NbTokenStorage() {
    }
    return NbTokenStorage;
}());
/**
 * Service that uses browser localStorage as a storage.
 *
 * The token storage is provided into auth module the following way:
 * ```ts
 * { provide: NbTokenStorage, useClass: NbTokenLocalStorage },
 * ```
 *
 * If you need to change the storage behaviour or provide your own - just extend your class from basic `NbTokenStorage`
 * or `NbTokenLocalStorage` and provide in your `app.module`:
 * ```ts
 * { provide: NbTokenStorage, useClass: NbTokenCustomStorage },
 * ```
 *
 */
var NbTokenLocalStorage = /** @class */ (function (_super) {
    __extends(NbTokenLocalStorage, _super);
    function NbTokenLocalStorage(parceler) {
        var _this = _super.call(this) || this;
        _this.parceler = parceler;
        _this.key = 'auth_app_token';
        return _this;
    }
    /**
     * Returns token from localStorage
     * @returns {NbAuthToken}
     */
    NbTokenLocalStorage.prototype.get = function () {
        var raw = localStorage.getItem(this.key);
        return this.parceler.unwrap(raw);
    };
    /**
     * Sets token to localStorage
     * @param {NbAuthToken} token
     */
    NbTokenLocalStorage.prototype.set = function (token) {
        var raw = this.parceler.wrap(token);
        localStorage.setItem(this.key, raw);
    };
    /**
     * Clears token from localStorage
     */
    NbTokenLocalStorage.prototype.clear = function () {
        localStorage.removeItem(this.key);
    };
    NbTokenLocalStorage = __decorate([ __metadata("design:paramtypes", [NbAuthTokenParceler])
    ], NbTokenLocalStorage);
NbTokenLocalStorage.ɵfac = function NbTokenLocalStorage_Factory(t) { return new (t || NbTokenLocalStorage)(ɵngcc0.ɵɵinject(NbAuthTokenParceler)); };
NbTokenLocalStorage.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbTokenLocalStorage, factory: function (t) { return NbTokenLocalStorage.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbTokenLocalStorage, [{
        type: Injectable
    }], function () { return [{ type: NbAuthTokenParceler }]; }, null); })();
    return NbTokenLocalStorage;
}(NbTokenStorage));

/**
 * Service that allows you to manage authentication token - get, set, clear and also listen to token changes over time.
 */
var NbTokenService = /** @class */ (function () {
    function NbTokenService(tokenStorage) {
        this.tokenStorage = tokenStorage;
        this.token$ = new BehaviorSubject(null);
        this.publishStoredToken();
    }
    /**
     * Publishes token when it changes.
     * @returns {Observable<NbAuthToken>}
     */
    NbTokenService.prototype.tokenChange = function () {
        return this.token$
            .pipe(filter(function (value) { return !!value; }), share());
    };
    /**
     * Sets a token into the storage. This method is used by the NbAuthService automatically.
     *
     * @param {NbAuthToken} token
     * @returns {Observable<any>}
     */
    NbTokenService.prototype.set = function (token) {
        this.tokenStorage.set(token);
        this.publishStoredToken();
        return of(null);
    };
    /**
     * Returns observable of current token
     * @returns {Observable<NbAuthToken>}
     */
    NbTokenService.prototype.get = function () {
        var token = this.tokenStorage.get();
        return of(token);
    };
    /**
     * Removes the token and published token value
     *
     * @returns {Observable<any>}
     */
    NbTokenService.prototype.clear = function () {
        this.tokenStorage.clear();
        this.publishStoredToken();
        return of(null);
    };
    NbTokenService.prototype.publishStoredToken = function () {
        this.token$.next(this.tokenStorage.get());
    };
    NbTokenService = __decorate([ __metadata("design:paramtypes", [NbTokenStorage])
    ], NbTokenService);
NbTokenService.ɵfac = function NbTokenService_Factory(t) { return new (t || NbTokenService)(ɵngcc0.ɵɵinject(NbTokenStorage)); };
NbTokenService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbTokenService, factory: function (t) { return NbTokenService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbTokenService, [{
        type: Injectable
    }], function () { return [{ type: NbTokenStorage }]; }, null); })();
    return NbTokenService;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
/**
 * Common authentication service.
 * Should be used to as an interlayer between UI Components and Auth Strategy.
 */
var NbAuthService = /** @class */ (function () {
    function NbAuthService(tokenService, strategies) {
        this.tokenService = tokenService;
        this.strategies = strategies;
    }
    /**
     * Retrieves current authenticated token stored
     * @returns {Observable<any>}
     */
    NbAuthService.prototype.getToken = function () {
        return this.tokenService.get();
    };
    /**
     * Returns true if auth token is present in the token storage
     * @returns {Observable<boolean>}
     */
    NbAuthService.prototype.isAuthenticated = function () {
        return this.getToken()
            .pipe(map(function (token) { return token.isValid(); }));
    };
    /**
     * Returns true if valid auth token is present in the token storage.
     * If not, calls the strategy refreshToken, and returns isAuthenticated() if success, false otherwise
     * @returns {Observable<boolean>}
     */
    NbAuthService.prototype.isAuthenticatedOrRefresh = function () {
        var _this = this;
        return this.getToken()
            .pipe(switchMap(function (token) {
            if (token.getValue() && !token.isValid()) {
                return _this.refreshToken(token.getOwnerStrategyName(), token)
                    .pipe(switchMap(function (res) {
                    if (res.isSuccess()) {
                        return _this.isAuthenticated();
                    }
                    else {
                        return of(false);
                    }
                }));
            }
            else {
                return of(token.isValid());
            }
        }));
    };
    /**
     * Returns tokens stream
     * @returns {Observable<NbAuthSimpleToken>}
     */
    NbAuthService.prototype.onTokenChange = function () {
        return this.tokenService.tokenChange();
    };
    /**
     * Returns authentication status stream
     * @returns {Observable<boolean>}
     */
    NbAuthService.prototype.onAuthenticationChange = function () {
        return this.onTokenChange()
            .pipe(map(function (token) { return token.isValid(); }));
    };
    /**
     * Authenticates with the selected strategy
     * Stores received token in the token storage
     *
     * Example:
     * authenticate('email', {email: 'email@example.com', password: 'test'})
     *
     * @param strategyName
     * @param data
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.authenticate = function (strategyName, data) {
        var _this = this;
        return this.getStrategy(strategyName).authenticate(data)
            .pipe(switchMap(function (result) {
            return _this.processResultToken(result);
        }));
    };
    /**
     * Registers with the selected strategy
     * Stores received token in the token storage
     *
     * Example:
     * register('email', {email: 'email@example.com', name: 'Some Name', password: 'test'})
     *
     * @param strategyName
     * @param data
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.register = function (strategyName, data) {
        var _this = this;
        return this.getStrategy(strategyName).register(data)
            .pipe(switchMap(function (result) {
            return _this.processResultToken(result);
        }));
    };
    /**
     * Sign outs with the selected strategy
     * Removes token from the token storage
     *
     * Example:
     * logout('email')
     *
     * @param strategyName
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.logout = function (strategyName) {
        var _this = this;
        return this.getStrategy(strategyName).logout()
            .pipe(switchMap(function (result) {
            if (result.isSuccess()) {
                _this.tokenService.clear()
                    .pipe(map(function () { return result; }));
            }
            return of(result);
        }));
    };
    /**
     * Sends forgot password request to the selected strategy
     *
     * Example:
     * requestPassword('email', {email: 'email@example.com'})
     *
     * @param strategyName
     * @param data
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.requestPassword = function (strategyName, data) {
        return this.getStrategy(strategyName).requestPassword(data);
    };
    /**
     * Tries to reset password with the selected strategy
     *
     * Example:
     * resetPassword('email', {newPassword: 'test'})
     *
     * @param strategyName
     * @param data
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.resetPassword = function (strategyName, data) {
        return this.getStrategy(strategyName).resetPassword(data);
    };
    /**
     * Sends a refresh token request
     * Stores received token in the token storage
     *
     * Example:
     * refreshToken('email', {token: token})
     *
     * @param {string} strategyName
     * @param data
     * @returns {Observable<NbAuthResult>}
     */
    NbAuthService.prototype.refreshToken = function (strategyName, data) {
        var _this = this;
        return this.getStrategy(strategyName).refreshToken(data)
            .pipe(switchMap(function (result) {
            return _this.processResultToken(result);
        }));
    };
    /**
     * Get registered strategy by name
     *
     * Example:
     * getStrategy('email')
     *
     * @param {string} provider
     * @returns {NbAbstractAuthProvider}
     */
    NbAuthService.prototype.getStrategy = function (strategyName) {
        var found = this.strategies.find(function (strategy) { return strategy.getName() === strategyName; });
        if (!found) {
            throw new TypeError("There is no Auth Strategy registered under '" + strategyName + "' name");
        }
        return found;
    };
    NbAuthService.prototype.processResultToken = function (result) {
        if (result.isSuccess() && result.getToken()) {
            return this.tokenService.set(result.getToken())
                .pipe(map(function (token) {
                return result;
            }));
        }
        return of(result);
    };
    NbAuthService = __decorate([ __param(1, Inject(NB_AUTH_STRATEGIES)),
        __metadata("design:paramtypes", [NbTokenService, Object])
    ], NbAuthService);
NbAuthService.ɵfac = function NbAuthService_Factory(t) { return new (t || NbAuthService)(ɵngcc0.ɵɵinject(NbTokenService), ɵngcc0.ɵɵinject(NB_AUTH_STRATEGIES)); };
NbAuthService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbAuthService, factory: function (t) { return NbAuthService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthService, [{
        type: Injectable
    }], function () { return [{ type: NbTokenService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_STRATEGIES]
            }] }]; }, null); })();
    return NbAuthService;
}());

var NbAuthStrategy = /** @class */ (function () {
    function NbAuthStrategy() {
    }
    // we should keep this any and validation should be done in `register` method instead
    // otherwise it won't be possible to pass an empty object
    NbAuthStrategy.prototype.setOptions = function (options) {
        this.options = deepExtend({}, this.defaultOptions, options);
    };
    NbAuthStrategy.prototype.getOption = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbAuthStrategy.prototype.createToken = function (value, failWhenInvalidToken) {
        var token = nbAuthCreateToken(this.getOption('token.class'), value, this.getName());
        // At this point, nbAuthCreateToken failed with NbAuthIllegalTokenError which MUST be intercepted by strategies
        // Or token is created. It MAY be created even if backend did not return any token, in this case it is !Valid
        if (failWhenInvalidToken && !token.isValid()) {
            // If we require a valid token (i.e. isValid), then we MUST throw NbAuthIllegalTokenError so that the strategies
            // intercept it
            throw new NbAuthIllegalTokenError('Token is empty or invalid.');
        }
        return token;
    };
    NbAuthStrategy.prototype.getName = function () {
        return this.getOption('name');
    };
    NbAuthStrategy.prototype.createFailResponse = function (data) {
        return new HttpResponse({ body: {}, status: 401 });
    };
    NbAuthStrategy.prototype.createSuccessResponse = function (data) {
        return new HttpResponse({ body: {}, status: 200 });
    };
    NbAuthStrategy.prototype.getActionEndpoint = function (action) {
        var actionEndpoint = this.getOption(action + ".endpoint");
        var baseEndpoint = this.getOption('baseEndpoint');
        return actionEndpoint ? baseEndpoint + actionEndpoint : '';
    };
    return NbAuthStrategy;
}());

var NbAuthResult = /** @class */ (function () {
    // TODO: better pass object
    function NbAuthResult(success, response, redirect, errors, messages, token) {
        if (token === void 0) { token = null; }
        this.success = success;
        this.response = response;
        this.redirect = redirect;
        this.errors = [];
        this.messages = [];
        this.errors = this.errors.concat([errors]);
        if (errors instanceof Array) {
            this.errors = errors;
        }
        this.messages = this.messages.concat([messages]);
        if (messages instanceof Array) {
            this.messages = messages;
        }
        this.token = token;
    }
    NbAuthResult.prototype.getResponse = function () {
        return this.response;
    };
    NbAuthResult.prototype.getToken = function () {
        return this.token;
    };
    NbAuthResult.prototype.getRedirect = function () {
        return this.redirect;
    };
    NbAuthResult.prototype.getErrors = function () {
        return this.errors.filter(function (val) { return !!val; });
    };
    NbAuthResult.prototype.getMessages = function () {
        return this.messages.filter(function (val) { return !!val; });
    };
    NbAuthResult.prototype.isSuccess = function () {
        return this.success;
    };
    NbAuthResult.prototype.isFailure = function () {
        return !this.success;
    };
    return NbAuthResult;
}());

var NbAuthStrategyOptions = /** @class */ (function () {
    function NbAuthStrategyOptions() {
    }
    return NbAuthStrategyOptions;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbDummyAuthStrategyOptions = /** @class */ (function (_super) {
    __extends(NbDummyAuthStrategyOptions, _super);
    function NbDummyAuthStrategyOptions() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.token = {
            class: NbAuthSimpleToken,
        };
        _this.delay = 1000;
        _this.alwaysFail = false;
        return _this;
    }
    return NbDummyAuthStrategyOptions;
}(NbAuthStrategyOptions));
var dummyStrategyOptions = new NbDummyAuthStrategyOptions();

/**
 * Dummy auth strategy. Could be useful for auth setup when backend is not available yet.
 *
 *
 * Strategy settings.
 *
 * ```ts
 * export class NbDummyAuthStrategyOptions extends NbAuthStrategyOptions {
 *   name = 'dummy';
 *   token = {
 *     class: NbAuthSimpleToken,
 *   };
 *   delay? = 1000;
 *   alwaysFail? = false;
 * }
 * ```
 */
var NbDummyAuthStrategy = /** @class */ (function (_super) {
    __extends(NbDummyAuthStrategy, _super);
    function NbDummyAuthStrategy() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.defaultOptions = dummyStrategyOptions;
        return _this;
    }
    NbDummyAuthStrategy_1 = NbDummyAuthStrategy;
    NbDummyAuthStrategy.setup = function (options) {
        return [NbDummyAuthStrategy_1, options];
    };
    NbDummyAuthStrategy.prototype.authenticate = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.register = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.requestPassword = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.resetPassword = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.logout = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.refreshToken = function (data) {
        return of(this.createDummyResult(data))
            .pipe(delay(this.getOption('delay')));
    };
    NbDummyAuthStrategy.prototype.createDummyResult = function (data) {
        if (this.getOption('alwaysFail')) {
            return new NbAuthResult(false, this.createFailResponse(data), null, ['Something went wrong.']);
        }
        try {
            var token = this.createToken('test token', true);
            return new NbAuthResult(true, this.createSuccessResponse(data), '/', [], ['Successfully logged in.'], token);
        }
        catch (err) {
            return new NbAuthResult(false, this.createFailResponse(data), null, [err.message]);
        }
    };
    var NbDummyAuthStrategy_1;
NbDummyAuthStrategy.ɵfac = function NbDummyAuthStrategy_Factory(t) { return ɵNbDummyAuthStrategy_BaseFactory(t || NbDummyAuthStrategy); };
NbDummyAuthStrategy.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbDummyAuthStrategy, factory: function (t) { return NbDummyAuthStrategy.ɵfac(t); } });
var ɵNbDummyAuthStrategy_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(NbDummyAuthStrategy);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbDummyAuthStrategy, [{
        type: Injectable
    }], null, null); })();
    return NbDummyAuthStrategy;
}(NbAuthStrategy));

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbOAuth2ResponseType;
(function (NbOAuth2ResponseType) {
    NbOAuth2ResponseType["CODE"] = "code";
    NbOAuth2ResponseType["TOKEN"] = "token";
})(NbOAuth2ResponseType || (NbOAuth2ResponseType = {}));
// TODO: client_credentials
var NbOAuth2GrantType;
(function (NbOAuth2GrantType) {
    NbOAuth2GrantType["AUTHORIZATION_CODE"] = "authorization_code";
    NbOAuth2GrantType["PASSWORD"] = "password";
    NbOAuth2GrantType["REFRESH_TOKEN"] = "refresh_token";
})(NbOAuth2GrantType || (NbOAuth2GrantType = {}));
var NbOAuth2ClientAuthMethod;
(function (NbOAuth2ClientAuthMethod) {
    NbOAuth2ClientAuthMethod["NONE"] = "none";
    NbOAuth2ClientAuthMethod["BASIC"] = "basic";
    NbOAuth2ClientAuthMethod["REQUEST_BODY"] = "request-body";
})(NbOAuth2ClientAuthMethod || (NbOAuth2ClientAuthMethod = {}));
var NbOAuth2AuthStrategyOptions = /** @class */ (function (_super) {
    __extends(NbOAuth2AuthStrategyOptions, _super);
    function NbOAuth2AuthStrategyOptions() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.baseEndpoint = '';
        _this.clientId = '';
        _this.clientSecret = '';
        _this.clientAuthMethod = NbOAuth2ClientAuthMethod.NONE;
        _this.redirect = {
            success: '/',
            failure: null,
        };
        _this.defaultErrors = ['Something went wrong, please try again.'];
        _this.defaultMessages = ['You have been successfully authenticated.'];
        _this.authorize = {
            endpoint: 'authorize',
            responseType: NbOAuth2ResponseType.CODE,
            requireValidToken: true,
        };
        _this.token = {
            endpoint: 'token',
            grantType: NbOAuth2GrantType.AUTHORIZATION_CODE,
            requireValidToken: true,
            class: NbAuthOAuth2Token,
        };
        _this.refresh = {
            endpoint: 'token',
            grantType: NbOAuth2GrantType.REFRESH_TOKEN,
            requireValidToken: true,
        };
        return _this;
    }
    return NbOAuth2AuthStrategyOptions;
}(NbAuthStrategyOptions));
var auth2StrategyOptions = new NbOAuth2AuthStrategyOptions();

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
/**
 * OAuth2 authentication strategy.
 *
 * Strategy settings:
 *
 * ```ts
 * export enum NbOAuth2ResponseType {
 *   CODE = 'code',
 *   TOKEN = 'token',
 * }
 *
 * export enum NbOAuth2GrantType {
 *   AUTHORIZATION_CODE = 'authorization_code',
 *   PASSWORD = 'password',
 *   REFRESH_TOKEN = 'refresh_token',
 * }
 *
 * export class NbOAuth2AuthStrategyOptions {
 *   name: string;
 *   baseEndpoint?: string = '';
 *   clientId: string = '';
 *   clientSecret: string = '';
 *   clientAuthMethod: string = NbOAuth2ClientAuthMethod.NONE;
 *   redirect?: { success?: string; failure?: string } = {
 *     success: '/',
 *     failure: null,
 *   };
 *   defaultErrors?: any[] = ['Something went wrong, please try again.'];
 *   defaultMessages?: any[] = ['You have been successfully authenticated.'];
 *   authorize?: {
 *     endpoint?: string;
 *     redirectUri?: string;
 *     responseType?: string;
 *     requireValidToken: true,
 *     scope?: string;
 *     state?: string;
 *     params?: { [key: string]: string };
 *   } = {
 *     endpoint: 'authorize',
 *     responseType: NbOAuth2ResponseType.CODE,
 *   };
 *   token?: {
 *     endpoint?: string;
 *     grantType?: string;
 *     requireValidToken: true,
 *     redirectUri?: string;
 *     scope?: string;
 *     class: NbAuthTokenClass,
 *   } = {
 *     endpoint: 'token',
 *     grantType: NbOAuth2GrantType.AUTHORIZATION_CODE,
 *     class: NbAuthOAuth2Token,
 *   };
 *   refresh?: {
 *     endpoint?: string;
 *     grantType?: string;
 *     scope?: string;
 *     requireValidToken: true,
 *   } = {
 *     endpoint: 'token',
 *     grantType: NbOAuth2GrantType.REFRESH_TOKEN,
 *   };
 * }
 * ```
 *
 */
var NbOAuth2AuthStrategy = /** @class */ (function (_super) {
    __extends(NbOAuth2AuthStrategy, _super);
    function NbOAuth2AuthStrategy(http, route, window) {
        var _a, _b;
        var _this = _super.call(this) || this;
        _this.http = http;
        _this.route = route;
        _this.window = window;
        _this.redirectResultHandlers = (_a = {},
            _a[NbOAuth2ResponseType.CODE] = function () {
                return of(_this.route.snapshot.queryParams).pipe(switchMap(function (params) {
                    if (params.code) {
                        return _this.requestToken(params.code);
                    }
                    return of(new NbAuthResult(false, params, _this.getOption('redirect.failure'), _this.getOption('defaultErrors'), []));
                }));
            },
            _a[NbOAuth2ResponseType.TOKEN] = function () {
                var module = 'authorize';
                var requireValidToken = _this.getOption(module + ".requireValidToken");
                return of(_this.route.snapshot.fragment).pipe(map(function (fragment) { return _this.parseHashAsQueryParams(fragment); }), map(function (params) {
                    if (!params.error) {
                        return new NbAuthResult(true, params, _this.getOption('redirect.success'), [], _this.getOption('defaultMessages'), _this.createToken(params, requireValidToken));
                    }
                    return new NbAuthResult(false, params, _this.getOption('redirect.failure'), _this.getOption('defaultErrors'), []);
                }), catchError(function (err) {
                    var errors = [];
                    if (err instanceof NbAuthIllegalTokenError) {
                        errors.push(err.message);
                    }
                    else {
                        errors.push('Something went wrong.');
                    }
                    return of(new NbAuthResult(false, err, _this.getOption('redirect.failure'), errors));
                }));
            },
            _a);
        _this.redirectResults = (_b = {},
            _b[NbOAuth2ResponseType.CODE] = function () {
                return of(_this.route.snapshot.queryParams).pipe(map(function (params) { return !!(params && (params.code || params.error)); }));
            },
            _b[NbOAuth2ResponseType.TOKEN] = function () {
                return of(_this.route.snapshot.fragment).pipe(map(function (fragment) { return _this.parseHashAsQueryParams(fragment); }), map(function (params) { return !!(params && (params.access_token || params.error)); }));
            },
            _b);
        _this.defaultOptions = auth2StrategyOptions;
        return _this;
    }
    NbOAuth2AuthStrategy_1 = NbOAuth2AuthStrategy;
    NbOAuth2AuthStrategy.setup = function (options) {
        return [NbOAuth2AuthStrategy_1, options];
    };
    Object.defineProperty(NbOAuth2AuthStrategy.prototype, "responseType", {
        get: function () {
            return this.getOption('authorize.responseType');
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NbOAuth2AuthStrategy.prototype, "clientAuthMethod", {
        get: function () {
            return this.getOption('clientAuthMethod');
        },
        enumerable: true,
        configurable: true
    });
    NbOAuth2AuthStrategy.prototype.authenticate = function (data) {
        var _this = this;
        if (this.getOption('token.grantType') === NbOAuth2GrantType.PASSWORD) {
            return this.passwordToken(data.email, data.password);
        }
        else {
            return this.isRedirectResult()
                .pipe(switchMap(function (result) {
                if (!result) {
                    _this.authorizeRedirect();
                    return of(new NbAuthResult(true));
                }
                return _this.getAuthorizationResult();
            }));
        }
    };
    NbOAuth2AuthStrategy.prototype.getAuthorizationResult = function () {
        var redirectResultHandler = this.redirectResultHandlers[this.responseType];
        if (redirectResultHandler) {
            return redirectResultHandler.call(this);
        }
        throw new Error("'" + this.responseType + "' responseType is not supported,\n                      only 'token' and 'code' are supported now");
    };
    NbOAuth2AuthStrategy.prototype.refreshToken = function (token) {
        var _this = this;
        var module = 'refresh';
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        var headers = this.buildAuthHeader() || new HttpHeaders();
        headers = headers.append('Content-Type', 'application/x-www-form-urlencoded');
        return this.http.post(url, this.buildRefreshRequestData(token), { headers: headers })
            .pipe(map(function (res) {
            return new NbAuthResult(true, res, _this.getOption('redirect.success'), [], _this.getOption('defaultMessages'), _this.createRefreshedToken(res, token, requireValidToken));
        }), catchError(function (res) { return _this.handleResponseError(res); }));
    };
    NbOAuth2AuthStrategy.prototype.passwordToken = function (username, password) {
        var _this = this;
        var module = 'token';
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        var headers = this.buildAuthHeader() || new HttpHeaders();
        headers = headers.append('Content-Type', 'application/x-www-form-urlencoded');
        return this.http.post(url, this.buildPasswordRequestData(username, password), { headers: headers })
            .pipe(map(function (res) {
            return new NbAuthResult(true, res, _this.getOption('redirect.success'), [], _this.getOption('defaultMessages'), _this.createToken(res, requireValidToken));
        }), catchError(function (res) { return _this.handleResponseError(res); }));
    };
    NbOAuth2AuthStrategy.prototype.authorizeRedirect = function () {
        this.window.location.href = this.buildRedirectUrl();
    };
    NbOAuth2AuthStrategy.prototype.isRedirectResult = function () {
        return this.redirectResults[this.responseType].call(this);
    };
    NbOAuth2AuthStrategy.prototype.requestToken = function (code) {
        var _this = this;
        var module = 'token';
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        var headers = this.buildAuthHeader() || new HttpHeaders();
        headers = headers.append('Content-Type', 'application/x-www-form-urlencoded');
        return this.http.post(url, this.buildCodeRequestData(code), { headers: headers })
            .pipe(map(function (res) {
            return new NbAuthResult(true, res, _this.getOption('redirect.success'), [], _this.getOption('defaultMessages'), _this.createToken(res, requireValidToken));
        }), catchError(function (res) { return _this.handleResponseError(res); }));
    };
    NbOAuth2AuthStrategy.prototype.buildCodeRequestData = function (code) {
        var params = {
            grant_type: this.getOption('token.grantType'),
            code: code,
            redirect_uri: this.getOption('token.redirectUri'),
            client_id: this.getOption('clientId'),
        };
        return this.urlEncodeParameters(this.cleanParams(this.addCredentialsToParams(params)));
    };
    NbOAuth2AuthStrategy.prototype.buildRefreshRequestData = function (token) {
        var params = {
            grant_type: this.getOption('refresh.grantType'),
            refresh_token: token.getRefreshToken(),
            scope: this.getOption('refresh.scope'),
        };
        return this.urlEncodeParameters(this.cleanParams(this.addCredentialsToParams(params)));
    };
    NbOAuth2AuthStrategy.prototype.buildPasswordRequestData = function (username, password) {
        var params = {
            grant_type: this.getOption('token.grantType'),
            username: username,
            password: password,
            scope: this.getOption('token.scope'),
        };
        return this.urlEncodeParameters(this.cleanParams(this.addCredentialsToParams(params)));
    };
    NbOAuth2AuthStrategy.prototype.buildAuthHeader = function () {
        if (this.clientAuthMethod === NbOAuth2ClientAuthMethod.BASIC) {
            if (this.getOption('clientId') && this.getOption('clientSecret')) {
                return new HttpHeaders({
                    'Authorization': 'Basic ' + btoa(this.getOption('clientId') + ':' + this.getOption('clientSecret')),
                });
            }
            else {
                throw Error('For basic client authentication method, please provide both clientId & clientSecret.');
            }
        }
    };
    NbOAuth2AuthStrategy.prototype.cleanParams = function (params) {
        Object.entries(params)
            .forEach(function (_a) {
            var key = _a[0], val = _a[1];
            return !val && delete params[key];
        });
        return params;
    };
    NbOAuth2AuthStrategy.prototype.addCredentialsToParams = function (params) {
        if (this.clientAuthMethod === NbOAuth2ClientAuthMethod.REQUEST_BODY) {
            if (this.getOption('clientId') && this.getOption('clientSecret')) {
                return __assign(__assign({}, params), { client_id: this.getOption('clientId'), client_secret: this.getOption('clientSecret') });
            }
            else {
                throw Error('For request body client authentication method, please provide both clientId & clientSecret.');
            }
        }
        return params;
    };
    NbOAuth2AuthStrategy.prototype.handleResponseError = function (res) {
        var errors = [];
        if (res instanceof HttpErrorResponse) {
            if (res.error.error_description) {
                errors.push(res.error.error_description);
            }
            else {
                errors = this.getOption('defaultErrors');
            }
        }
        else if (res instanceof NbAuthIllegalTokenError) {
            errors.push(res.message);
        }
        else {
            errors.push('Something went wrong.');
        }
        
        return of(new NbAuthResult(false, res, this.getOption('redirect.failure'), errors, []));
    };
    NbOAuth2AuthStrategy.prototype.buildRedirectUrl = function () {
        var params = __assign({ response_type: this.getOption('authorize.responseType'), client_id: this.getOption('clientId'), redirect_uri: this.getOption('authorize.redirectUri'), scope: this.getOption('authorize.scope'), state: this.getOption('authorize.state') }, this.getOption('authorize.params'));
        var endpoint = this.getActionEndpoint('authorize');
        var query = this.urlEncodeParameters(this.cleanParams(params));
        return endpoint + "?" + query;
    };
    NbOAuth2AuthStrategy.prototype.parseHashAsQueryParams = function (hash) {
        return hash ? hash.split('&').reduce(function (acc, part) {
            var item = part.split('=');
            acc[item[0]] = decodeURIComponent(item[1]);
            return acc;
        }, {}) : {};
    };
    NbOAuth2AuthStrategy.prototype.urlEncodeParameters = function (params) {
        return Object.keys(params).map(function (k) {
            return encodeURIComponent(k) + "=" + encodeURIComponent(params[k]);
        }).join('&');
    };
    NbOAuth2AuthStrategy.prototype.createRefreshedToken = function (res, existingToken, requireValidToken) {
        var refreshedToken = this.createToken(res, requireValidToken);
        if (!refreshedToken.getRefreshToken() && existingToken.getRefreshToken()) {
            refreshedToken.setRefreshToken(existingToken.getRefreshToken());
        }
        return refreshedToken;
    };
    NbOAuth2AuthStrategy.prototype.register = function (data) {
        throw new Error('`register` is not supported by `NbOAuth2AuthStrategy`, use `authenticate`.');
    };
    NbOAuth2AuthStrategy.prototype.requestPassword = function (data) {
        throw new Error('`requestPassword` is not supported by `NbOAuth2AuthStrategy`, use `authenticate`.');
    };
    NbOAuth2AuthStrategy.prototype.resetPassword = function (data) {
        if (data === void 0) { data = {}; }
        throw new Error('`resetPassword` is not supported by `NbOAuth2AuthStrategy`, use `authenticate`.');
    };
    NbOAuth2AuthStrategy.prototype.logout = function () {
        return of(new NbAuthResult(true));
    };
    var NbOAuth2AuthStrategy_1;
    NbOAuth2AuthStrategy = NbOAuth2AuthStrategy_1 = __decorate([ __param(2, Inject(NB_WINDOW)),
        __metadata("design:paramtypes", [HttpClient,
            ActivatedRoute, Object])
    ], NbOAuth2AuthStrategy);
NbOAuth2AuthStrategy.ɵfac = function NbOAuth2AuthStrategy_Factory(t) { return new (t || NbOAuth2AuthStrategy)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient), ɵngcc0.ɵɵinject(ɵngcc2.ActivatedRoute), ɵngcc0.ɵɵinject(NB_WINDOW)); };
NbOAuth2AuthStrategy.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbOAuth2AuthStrategy, factory: function (t) { return NbOAuth2AuthStrategy.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbOAuth2AuthStrategy, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.HttpClient }, { type: ɵngcc2.ActivatedRoute }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_WINDOW]
            }] }]; }, null); })();
    return NbOAuth2AuthStrategy;
}(NbAuthStrategy));

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbPasswordAuthStrategyOptions = /** @class */ (function (_super) {
    __extends(NbPasswordAuthStrategyOptions, _super);
    function NbPasswordAuthStrategyOptions() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.baseEndpoint = '/api/auth/';
        _this.login = {
            alwaysFail: false,
            endpoint: 'login',
            method: 'post',
            requireValidToken: true,
            redirect: {
                success: '/',
                failure: null,
            },
            defaultErrors: ['Login/Email combination is not correct, please try again.'],
            defaultMessages: ['You have been successfully logged in.'],
        };
        _this.register = {
            alwaysFail: false,
            endpoint: 'register',
            method: 'post',
            requireValidToken: true,
            redirect: {
                success: '/',
                failure: null,
            },
            defaultErrors: ['Something went wrong, please try again.'],
            defaultMessages: ['You have been successfully registered.'],
        };
        _this.requestPass = {
            endpoint: 'request-pass',
            method: 'post',
            redirect: {
                success: '/',
                failure: null,
            },
            defaultErrors: ['Something went wrong, please try again.'],
            defaultMessages: ['Reset password instructions have been sent to your email.'],
        };
        _this.resetPass = {
            endpoint: 'reset-pass',
            method: 'put',
            redirect: {
                success: '/',
                failure: null,
            },
            resetPasswordTokenKey: 'reset_password_token',
            defaultErrors: ['Something went wrong, please try again.'],
            defaultMessages: ['Your password has been successfully changed.'],
        };
        _this.logout = {
            alwaysFail: false,
            endpoint: 'logout',
            method: 'delete',
            redirect: {
                success: '/',
                failure: null,
            },
            defaultErrors: ['Something went wrong, please try again.'],
            defaultMessages: ['You have been successfully logged out.'],
        };
        _this.refreshToken = {
            endpoint: 'refresh-token',
            method: 'post',
            requireValidToken: true,
            redirect: {
                success: null,
                failure: null,
            },
            defaultErrors: ['Something went wrong, please try again.'],
            defaultMessages: ['Your token has been successfully refreshed.'],
        };
        _this.token = {
            class: NbAuthSimpleToken,
            key: 'data.token',
            getter: function (module, res, options) { return getDeepFromObject(res.body, options.token.key); },
        };
        _this.errors = {
            key: 'data.errors',
            getter: function (module, res, options) { return getDeepFromObject(res.error, options.errors.key, options[module].defaultErrors); },
        };
        _this.messages = {
            key: 'data.messages',
            getter: function (module, res, options) { return getDeepFromObject(res.body, options.messages.key, options[module].defaultMessages); },
        };
        return _this;
    }
    return NbPasswordAuthStrategyOptions;
}(NbAuthStrategyOptions));
var passwordStrategyOptions = new NbPasswordAuthStrategyOptions();

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
/**
 * The most common authentication provider for email/password strategy.
 *
 * Strategy settings. Note, there is no need to copy over the whole object to change the settings you need.
 * Also, this.getOption call won't work outside of the default options declaration
 * (which is inside of the `NbPasswordAuthStrategy` class), so you have to replace it with a custom helper function
 * if you need it.
 *
 * ```ts
 *export class NbPasswordAuthStrategyOptions extends NbAuthStrategyOptions {
 *  name: string;
 *  baseEndpoint? = '/api/auth/';
 *  login?: boolean | NbPasswordStrategyModule = {
 *    alwaysFail: false,
 *    endpoint: 'login',
 *    method: 'post',
 *    requireValidToken: true,
 *    redirect: {
 *      success: '/',
 *      failure: null,
 *    },
 *    defaultErrors: ['Login/Email combination is not correct, please try again.'],
 *    defaultMessages: ['You have been successfully logged in.'],
 *  };
 *  register?: boolean | NbPasswordStrategyModule = {
 *    alwaysFail: false,
 *    endpoint: 'register',
 *    method: 'post',
 *    requireValidToken: true,
 *    redirect: {
 *      success: '/',
 *      failure: null,
 *    },
 *    defaultErrors: ['Something went wrong, please try again.'],
 *    defaultMessages: ['You have been successfully registered.'],
 *  };
 *  requestPass?: boolean | NbPasswordStrategyModule = {
 *    endpoint: 'request-pass',
 *    method: 'post',
 *    redirect: {
 *      success: '/',
 *      failure: null,
 *    },
 *    defaultErrors: ['Something went wrong, please try again.'],
 *    defaultMessages: ['Reset password instructions have been sent to your email.'],
 *  };
 *  resetPass?: boolean | NbPasswordStrategyReset = {
 *    endpoint: 'reset-pass',
 *    method: 'put',
 *    redirect: {
 *      success: '/',
 *      failure: null,
 *    },
 *    resetPasswordTokenKey: 'reset_password_token',
 *    defaultErrors: ['Something went wrong, please try again.'],
 *    defaultMessages: ['Your password has been successfully changed.'],
 *  };
 *  logout?: boolean | NbPasswordStrategyReset = {
 *    alwaysFail: false,
 *    endpoint: 'logout',
 *    method: 'delete',
 *    redirect: {
 *      success: '/',
 *      failure: null,
 *    },
 *    defaultErrors: ['Something went wrong, please try again.'],
 *    defaultMessages: ['You have been successfully logged out.'],
 *  };
 *  refreshToken?: boolean | NbPasswordStrategyModule = {
 *    endpoint: 'refresh-token',
 *    method: 'post',
 *    requireValidToken: true,
 *    redirect: {
 *      success: null,
 *      failure: null,
 *    },
 *    defaultErrors: ['Something went wrong, please try again.'],
 *    defaultMessages: ['Your token has been successfully refreshed.'],
 *  };
 *  token?: NbPasswordStrategyToken = {
 *    class: NbAuthSimpleToken,
 *    key: 'data.token',
 *    getter: (module: string, res: HttpResponse<Object>, options: NbPasswordAuthStrategyOptions) => getDeepFromObject(
 *      res.body,
 *      options.token.key,
 *    ),
 *  };
 *  errors?: NbPasswordStrategyMessage = {
 *    key: 'data.errors',
 *    getter: (module: string, res: HttpErrorResponse, options: NbPasswordAuthStrategyOptions) => getDeepFromObject(
 *      res.error,
 *      options.errors.key,
 *      options[module].defaultErrors,
 *    ),
 *  };
 *  messages?: NbPasswordStrategyMessage = {
 *    key: 'data.messages',
 *    getter: (module: string, res: HttpResponse<Object>, options: NbPasswordAuthStrategyOptions) => getDeepFromObject(
 *      res.body,
 *      options.messages.key,
 *      options[module].defaultMessages,
 *    ),
 *  };
 *  validation?: {
 *    password?: {
 *      required?: boolean;
 *      minLength?: number | null;
 *      maxLength?: number | null;
 *      regexp?: string | null;
 *    };
 *    email?: {
 *      required?: boolean;
 *      regexp?: string | null;
 *    };
 *    fullName?: {
 *      required?: boolean;
 *      minLength?: number | null;
 *      maxLength?: number | null;
 *      regexp?: string | null;
 *    };
 *  };
 *}
 * ```
 */
var NbPasswordAuthStrategy = /** @class */ (function (_super) {
    __extends(NbPasswordAuthStrategy, _super);
    function NbPasswordAuthStrategy(http, route) {
        var _this = _super.call(this) || this;
        _this.http = http;
        _this.route = route;
        _this.defaultOptions = passwordStrategyOptions;
        return _this;
    }
    NbPasswordAuthStrategy_1 = NbPasswordAuthStrategy;
    NbPasswordAuthStrategy.setup = function (options) {
        return [NbPasswordAuthStrategy_1, options];
    };
    NbPasswordAuthStrategy.prototype.authenticate = function (data) {
        var _this = this;
        var module = 'login';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        return this.http.request(method, url, { body: data, observe: 'response' })
            .pipe(map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse(data);
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options), _this.createToken(_this.getOption('token.getter')(module, res, _this.options), requireValidToken));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.register = function (data) {
        var _this = this;
        var module = 'register';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        return this.http.request(method, url, { body: data, observe: 'response' })
            .pipe(map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse(data);
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options), _this.createToken(_this.getOption('token.getter')('login', res, _this.options), requireValidToken));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.requestPassword = function (data) {
        var _this = this;
        var module = 'requestPass';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        return this.http.request(method, url, { body: data, observe: 'response' })
            .pipe(map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse();
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.resetPassword = function (data) {
        var _this = this;
        if (data === void 0) { data = {}; }
        var module = 'resetPass';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        var tokenKey = this.getOption(module + ".resetPasswordTokenKey");
        data[tokenKey] = this.route.snapshot.queryParams[tokenKey];
        return this.http.request(method, url, { body: data, observe: 'response' })
            .pipe(map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse();
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.logout = function () {
        var _this = this;
        var module = 'logout';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        return of({})
            .pipe(switchMap(function (res) {
            if (!url) {
                return of(res);
            }
            return _this.http.request(method, url, { observe: 'response' });
        }), map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse();
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.refreshToken = function (data) {
        var _this = this;
        var module = 'refreshToken';
        var method = this.getOption(module + ".method");
        var url = this.getActionEndpoint(module);
        var requireValidToken = this.getOption(module + ".requireValidToken");
        return this.http.request(method, url, { body: data, observe: 'response' })
            .pipe(map(function (res) {
            if (_this.getOption(module + ".alwaysFail")) {
                throw _this.createFailResponse(data);
            }
            return res;
        }), map(function (res) {
            return new NbAuthResult(true, res, _this.getOption(module + ".redirect.success"), [], _this.getOption('messages.getter')(module, res, _this.options), _this.createToken(_this.getOption('token.getter')(module, res, _this.options), requireValidToken));
        }), catchError(function (res) {
            return _this.handleResponseError(res, module);
        }));
    };
    NbPasswordAuthStrategy.prototype.handleResponseError = function (res, module) {
        var errors = [];
        if (res instanceof HttpErrorResponse) {
            errors = this.getOption('errors.getter')(module, res, this.options);
        }
        else if (res instanceof NbAuthIllegalTokenError) {
            errors.push(res.message);
        }
        else {
            errors.push('Something went wrong.');
        }
        return of(new NbAuthResult(false, res, this.getOption(module + ".redirect.failure"), errors));
    };
    var NbPasswordAuthStrategy_1;
    NbPasswordAuthStrategy = NbPasswordAuthStrategy_1 = __decorate([ __metadata("design:paramtypes", [HttpClient, ActivatedRoute])
    ], NbPasswordAuthStrategy);
NbPasswordAuthStrategy.ɵfac = function NbPasswordAuthStrategy_Factory(t) { return new (t || NbPasswordAuthStrategy)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient), ɵngcc0.ɵɵinject(ɵngcc2.ActivatedRoute)); };
NbPasswordAuthStrategy.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbPasswordAuthStrategy, factory: function (t) { return NbPasswordAuthStrategy.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbPasswordAuthStrategy, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.HttpClient }, { type: ɵngcc2.ActivatedRoute }]; }, null); })();
    return NbPasswordAuthStrategy;
}(NbAuthStrategy));

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbAuthComponent = /** @class */ (function () {
    // showcase of how to use the onAuthenticationChange method
    function NbAuthComponent(auth, location) {
        var _this = this;
        this.auth = auth;
        this.location = location;
        this.destroy$ = new Subject();
        this.authenticated = false;
        this.token = '';
        this.subscription = auth.onAuthenticationChange()
            .pipe(takeUntil(this.destroy$))
            .subscribe(function (authenticated) {
            _this.authenticated = authenticated;
        });
    }
    NbAuthComponent.prototype.back = function () {
        this.location.back();
        return false;
    };
    NbAuthComponent.prototype.ngOnDestroy = function () {
        this.destroy$.next();
        this.destroy$.complete();
    };
    NbAuthComponent = __decorate([ __metadata("design:paramtypes", [NbAuthService, Location])
    ], NbAuthComponent);
NbAuthComponent.ɵfac = function NbAuthComponent_Factory(t) { return new (t || NbAuthComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.Location)); };
NbAuthComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbAuthComponent, selectors: [["nb-auth"]], decls: 10, vars: 0, consts: [[1, "navigation"], ["href", "#", "aria-label", "Back", 1, "link", "back-link", 3, "click"], ["icon", "arrow-back"]], template: function NbAuthComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "nb-layout");
        ɵngcc0.ɵɵelementStart(1, "nb-layout-column");
        ɵngcc0.ɵɵelementStart(2, "nb-card");
        ɵngcc0.ɵɵelementStart(3, "nb-card-header");
        ɵngcc0.ɵɵelementStart(4, "nav", 0);
        ɵngcc0.ɵɵelementStart(5, "a", 1);
        ɵngcc0.ɵɵlistener("click", function NbAuthComponent_Template_a_click_5_listener() { return ctx.back(); });
        ɵngcc0.ɵɵelement(6, "nb-icon", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "nb-card-body");
        ɵngcc0.ɵɵelementStart(8, "nb-auth-block");
        ɵngcc0.ɵɵelement(9, "router-outlet");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } }, directives: function () { return [ɵngcc4.NbLayoutComponent, ɵngcc4.NbLayoutColumnComponent, ɵngcc4.NbCardComponent, ɵngcc4.NbCardHeaderComponent, ɵngcc4.NbIconComponent, ɵngcc4.NbCardBodyComponent, NbAuthBlockComponent, ɵngcc2.RouterOutlet]; }, styles: ["[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{margin:0;height:calc(100vh - 2 * 2.5rem)}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{display:inline-block;text-decoration:none}[_nghost-%COMP%]   .navigation[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   nb-icon[_ngcontent-%COMP%]{font-size:2rem;vertical-align:middle}[_nghost-%COMP%]   .links[_ngcontent-%COMP%]   nb-icon[_ngcontent-%COMP%]{font-size:2.5rem}[_nghost-%COMP%]   nb-card-body[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   nb-auth-block[_ngcontent-%COMP%]{margin:auto}@media (max-width: 767.98px){[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{border-radius:0;height:100vh}}[_nghost-%COMP%]     nb-layout .layout .layout-container .content .columns nb-layout-column{padding:2.5rem}@media (max-width: 767.98px){[_nghost-%COMP%]     nb-layout .layout .layout-container .content .columns nb-layout-column{padding:0}}"] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthComponent, [{
        type: Component,
        args: [{
                selector: 'nb-auth',
                template: "\n    <nb-layout>\n      <nb-layout-column>\n        <nb-card>\n          <nb-card-header>\n            <nav class=\"navigation\">\n              <a href=\"#\" (click)=\"back()\" class=\"link back-link\" aria-label=\"Back\">\n                <nb-icon icon=\"arrow-back\"></nb-icon>\n              </a>\n            </nav>\n          </nb-card-header>\n          <nb-card-body>\n            <nb-auth-block>\n              <router-outlet></router-outlet>\n            </nb-auth-block>\n          </nb-card-body>\n        </nb-card>\n      </nb-layout-column>\n    </nb-layout>\n  ",
                styles: ["/*!\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */:host nb-card{margin:0;height:calc(100vh - 2 * 2.5rem)}:host .navigation .link{display:inline-block;text-decoration:none}:host .navigation .link nb-icon{font-size:2rem;vertical-align:middle}:host .links nb-icon{font-size:2.5rem}:host nb-card-body{display:flex;width:100%}:host nb-auth-block{margin:auto}@media (max-width: 767.98px){:host nb-card{border-radius:0;height:100vh}}:host ::ng-deep nb-layout .layout .layout-container .content .columns nb-layout-column{padding:2.5rem}@media (max-width: 767.98px){:host ::ng-deep nb-layout .layout .layout-container .content .columns nb-layout-column{padding:0}}\n"]
            }]
    }], function () { return [{ type: NbAuthService }, { type: ɵngcc3.Location }]; }, null); })();
    return NbAuthComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbAuthBlockComponent = /** @class */ (function () {
    function NbAuthBlockComponent() {
    }
NbAuthBlockComponent.ɵfac = function NbAuthBlockComponent_Factory(t) { return new (t || NbAuthBlockComponent)(); };
NbAuthBlockComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbAuthBlockComponent, selectors: [["nb-auth-block"]], ngContentSelectors: _c0, decls: 1, vars: 0, template: function NbAuthBlockComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
    } }, styles: ["[_nghost-%COMP%]{display:block;width:100%;max-width:35rem}[_nghost-%COMP%]     form{width:100%}[_nghost-%COMP%]     .label{display:block;margin-bottom:0.5rem}[_nghost-%COMP%]     .forgot-password{text-decoration:none;margin-bottom:0.5rem}[_nghost-%COMP%]     .caption{margin-top:0.5rem}[_nghost-%COMP%]     .alert{text-align:center}[_nghost-%COMP%]     .title{margin-top:0;margin-bottom:0.75rem;text-align:center}[_nghost-%COMP%]     .sub-title{margin-bottom:2rem;text-align:center}[_nghost-%COMP%]     .form-control-group{margin-bottom:2rem}[_nghost-%COMP%]     .form-control-group.accept-group{display:flex;justify-content:space-between;margin:2rem 0}[_nghost-%COMP%]     .label-with-link{display:flex;justify-content:space-between}[_nghost-%COMP%]     .links{text-align:center;margin-top:1.75rem}[_nghost-%COMP%]     .links .socials{margin-top:1.5rem}[_nghost-%COMP%]     .links .socials a{margin:0 1rem;text-decoration:none;vertical-align:middle}[_nghost-%COMP%]     .links .socials a.with-icon{font-size:2rem}[_nghost-%COMP%]     .another-action{margin-top:2rem;text-align:center}[_nghost-%COMP%]     .sign-in-or-up{margin-top:2rem;display:flex;justify-content:space-between}[_nghost-%COMP%]     nb-alert .alert-title, [_nghost-%COMP%]     nb-alert .alert-message{margin:0 0 0.5rem}[_nghost-%COMP%]     nb-alert .alert-message-list{list-style-type:none;padding:0;margin:0}"] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthBlockComponent, [{
        type: Component,
        args: [{
                selector: 'nb-auth-block',
                template: "\n    <ng-content></ng-content>\n  ",
                styles: [":host{display:block;width:100%;max-width:35rem}:host ::ng-deep form{width:100%}:host ::ng-deep .label{display:block;margin-bottom:0.5rem}:host ::ng-deep .forgot-password{text-decoration:none;margin-bottom:0.5rem}:host ::ng-deep .caption{margin-top:0.5rem}:host ::ng-deep .alert{text-align:center}:host ::ng-deep .title{margin-top:0;margin-bottom:0.75rem;text-align:center}:host ::ng-deep .sub-title{margin-bottom:2rem;text-align:center}:host ::ng-deep .form-control-group{margin-bottom:2rem}:host ::ng-deep .form-control-group.accept-group{display:flex;justify-content:space-between;margin:2rem 0}:host ::ng-deep .label-with-link{display:flex;justify-content:space-between}:host ::ng-deep .links{text-align:center;margin-top:1.75rem}:host ::ng-deep .links .socials{margin-top:1.5rem}:host ::ng-deep .links .socials a{margin:0 1rem;text-decoration:none;vertical-align:middle}:host ::ng-deep .links .socials a.with-icon{font-size:2rem}:host ::ng-deep .another-action{margin-top:2rem;text-align:center}:host ::ng-deep .sign-in-or-up{margin-top:2rem;display:flex;justify-content:space-between}:host ::ng-deep nb-alert .alert-title,:host ::ng-deep nb-alert .alert-message{margin:0 0 0.5rem}:host ::ng-deep nb-alert .alert-message-list{list-style-type:none;padding:0;margin:0}\n"]
            }]
    }], function () { return []; }, null); })();
    return NbAuthBlockComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbLoginComponent = /** @class */ (function () {
    function NbLoginComponent(service, options, cd, router) {
        if (options === void 0) { options = {}; }
        this.service = service;
        this.options = options;
        this.cd = cd;
        this.router = router;
        this.redirectDelay = 0;
        this.showMessages = {};
        this.strategy = '';
        this.errors = [];
        this.messages = [];
        this.user = {};
        this.submitted = false;
        this.socialLinks = [];
        this.rememberMe = false;
        this.redirectDelay = this.getConfigValue('forms.login.redirectDelay');
        this.showMessages = this.getConfigValue('forms.login.showMessages');
        this.strategy = this.getConfigValue('forms.login.strategy');
        this.socialLinks = this.getConfigValue('forms.login.socialLinks');
        this.rememberMe = this.getConfigValue('forms.login.rememberMe');
    }
    NbLoginComponent.prototype.login = function () {
        var _this = this;
        this.errors = [];
        this.messages = [];
        this.submitted = true;
        this.service.authenticate(this.strategy, this.user).subscribe(function (result) {
            _this.submitted = false;
            if (result.isSuccess()) {
                _this.messages = result.getMessages();
            }
            else {
                _this.errors = result.getErrors();
            }
            var redirect = result.getRedirect();
            if (redirect) {
                setTimeout(function () {
                    return _this.router.navigateByUrl(redirect);
                }, _this.redirectDelay);
            }
            _this.cd.detectChanges();
        });
    };
    NbLoginComponent.prototype.getConfigValue = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbLoginComponent = __decorate([ __param(1, Inject(NB_AUTH_OPTIONS)),
        __metadata("design:paramtypes", [NbAuthService, Object, ChangeDetectorRef,
            Router])
    ], NbLoginComponent);
NbLoginComponent.ɵfac = function NbLoginComponent_Factory(t) { return new (t || NbLoginComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(NB_AUTH_OPTIONS), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
NbLoginComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbLoginComponent, selectors: [["nb-login"]], decls: 32, vars: 19, consts: [["id", "title", 1, "title"], [1, "sub-title"], ["outline", "danger", "role", "alert", 4, "ngIf"], ["outline", "success", "role", "alert", 4, "ngIf"], ["aria-labelledby", "title", 3, "ngSubmit"], ["form", "ngForm"], [1, "form-control-group"], ["for", "input-email", 1, "label"], ["nbInput", "", "fullWidth", "", "name", "email", "id", "input-email", "pattern", ".+@.+\\..+", "placeholder", "Email address", "fieldSize", "large", "autofocus", "", 3, "ngModel", "status", "required", "ngModelChange"], ["email", "ngModel"], [4, "ngIf"], [1, "label-with-link"], ["for", "input-password", 1, "label"], ["routerLink", "../request-password", 1, "forgot-password", "caption-2"], ["nbInput", "", "fullWidth", "", "name", "password", "type", "password", "id", "input-password", "placeholder", "Password", "fieldSize", "large", 3, "ngModel", "status", "required", "minlength", "maxlength", "ngModelChange"], ["password", "ngModel"], [1, "form-control-group", "accept-group"], ["name", "rememberMe", 3, "ngModel", "ngModelChange", 4, "ngIf"], ["nbButton", "", "fullWidth", "", "status", "primary", "size", "large", 3, "disabled"], ["class", "links", "aria-label", "Social sign in", 4, "ngIf"], ["aria-label", "Register", 1, "another-action"], ["routerLink", "../register", 1, "text-link"], ["outline", "danger", "role", "alert"], [1, "alert-title"], [1, "alert-message-list"], ["class", "alert-message", 4, "ngFor", "ngForOf"], [1, "alert-message"], ["outline", "success", "role", "alert"], ["class", "caption status-danger", 4, "ngIf"], [1, "caption", "status-danger"], ["name", "rememberMe", 3, "ngModel", "ngModelChange"], ["aria-label", "Social sign in", 1, "links"], [1, "socials"], [4, "ngFor", "ngForOf"], [3, "routerLink", "with-icon", 4, "ngIf"], [3, "with-icon", 4, "ngIf"], [3, "routerLink"], [3, "icon", 4, "ngIf", "ngIfElse"], ["title", ""], [3, "icon"]], template: function NbLoginComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "h1", 0);
        ɵngcc0.ɵɵtext(1, "Login");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "p", 1);
        ɵngcc0.ɵɵtext(3, "Hello! Log in with your email.");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, NbLoginComponent_nb_alert_4_Template, 6, 1, "nb-alert", 2);
        ɵngcc0.ɵɵtemplate(5, NbLoginComponent_nb_alert_5_Template, 6, 1, "nb-alert", 3);
        ɵngcc0.ɵɵelementStart(6, "form", 4, 5);
        ɵngcc0.ɵɵlistener("ngSubmit", function NbLoginComponent_Template_form_ngSubmit_6_listener() { return ctx.login(); });
        ɵngcc0.ɵɵelementStart(8, "div", 6);
        ɵngcc0.ɵɵelementStart(9, "label", 7);
        ɵngcc0.ɵɵtext(10, "Email address:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "input", 8, 9);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbLoginComponent_Template_input_ngModelChange_11_listener($event) { return ctx.user.email = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(13, NbLoginComponent_ng_container_13_Template, 3, 2, "ng-container", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "div", 6);
        ɵngcc0.ɵɵelementStart(15, "span", 11);
        ɵngcc0.ɵɵelementStart(16, "label", 12);
        ɵngcc0.ɵɵtext(17, "Password:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(18, "a", 13);
        ɵngcc0.ɵɵtext(19, "Forgot Password?");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "input", 14, 15);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbLoginComponent_Template_input_ngModelChange_20_listener($event) { return ctx.user.password = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(22, NbLoginComponent_ng_container_22_Template, 3, 2, "ng-container", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(23, "div", 16);
        ɵngcc0.ɵɵtemplate(24, NbLoginComponent_nb_checkbox_24_Template, 2, 1, "nb-checkbox", 17);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(25, "button", 18);
        ɵngcc0.ɵɵtext(26, " Log In ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(27, NbLoginComponent_section_27_Template, 4, 1, "section", 19);
        ɵngcc0.ɵɵelementStart(28, "section", 20);
        ɵngcc0.ɵɵtext(29, " Don't have an account? ");
        ɵngcc0.ɵɵelementStart(30, "a", 21);
        ɵngcc0.ɵɵtext(31, "Register");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        var _r2 = ɵngcc0.ɵɵreference(7);
        var _r3 = ɵngcc0.ɵɵreference(12);
        var _r5 = ɵngcc0.ɵɵreference(21);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.error && (ctx.errors == null ? null : ctx.errors.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.success && (ctx.messages == null ? null : ctx.messages.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.email)("status", _r3.dirty ? _r3.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.email.required"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r3.invalid && _r3.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r3.invalid && _r3.touched);
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.password)("status", _r5.dirty ? _r5.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.password.required"))("minlength", ctx.getConfigValue("forms.validation.password.minLength"))("maxlength", ctx.getConfigValue("forms.validation.password.maxLength"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r5.invalid && _r5.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r5.invalid && _r5.touched);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.rememberMe);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("btn-pulse", ctx.submitted);
        ɵngcc0.ɵɵproperty("disabled", ctx.submitted || !_r2.valid);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.socialLinks && ctx.socialLinks.length > 0);
    } }, directives: [ɵngcc3.NgIf, ɵngcc5.ɵangular_packages_forms_forms_y, ɵngcc5.NgControlStatusGroup, ɵngcc5.NgForm, ɵngcc4.NbInputDirective, ɵngcc5.DefaultValueAccessor, ɵngcc5.PatternValidator, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc5.RequiredValidator, ɵngcc2.RouterLinkWithHref, ɵngcc5.MinLengthValidator, ɵngcc5.MaxLengthValidator, ɵngcc4.NbButtonComponent, ɵngcc4.NbAlertComponent, ɵngcc3.NgForOf, ɵngcc4.NbCheckboxComponent, ɵngcc4.NbIconComponent], encapsulation: 2, changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbLoginComponent, [{
        type: Component,
        args: [{
                selector: 'nb-login',
                template: "<h1 id=\"title\" class=\"title\">Login</h1>\n<p class=\"sub-title\">Hello! Log in with your email.</p>\n\n<nb-alert *ngIf=\"showMessages.error && errors?.length && !submitted\" outline=\"danger\" role=\"alert\">\n  <p class=\"alert-title\"><b>Oh snap!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let error of errors\" class=\"alert-message\">{{ error }}</li>\n  </ul>\n</nb-alert>\n\n<nb-alert *ngIf=\"showMessages.success && messages?.length && !submitted\" outline=\"success\" role=\"alert\">\n  <p class=\"alert-title\"><b>Hooray!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let message of messages\" class=\"alert-message\">{{ message }}</li>\n  </ul>\n</nb-alert>\n\n<form (ngSubmit)=\"login()\" #form=\"ngForm\" aria-labelledby=\"title\">\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-email\">Email address:</label>\n    <input nbInput\n           fullWidth\n           [(ngModel)]=\"user.email\"\n           #email=\"ngModel\"\n           name=\"email\"\n           id=\"input-email\"\n           pattern=\".+@.+\\..+\"\n           placeholder=\"Email address\"\n           fieldSize=\"large\"\n           autofocus\n           [status]=\"email.dirty ? (email.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.email.required')\"\n           [attr.aria-invalid]=\"email.invalid && email.touched ? true : null\">\n    <ng-container *ngIf=\"email.invalid && email.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.required\">\n        Email is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.pattern\">\n        Email should be the real one!\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group\">\n    <span class=\"label-with-link\">\n      <label class=\"label\" for=\"input-password\">Password:</label>\n      <a class=\"forgot-password caption-2\" routerLink=\"../request-password\">Forgot Password?</a>\n    </span>\n    <input nbInput\n           fullWidth\n           [(ngModel)]=\"user.password\"\n           #password=\"ngModel\"\n           name=\"password\"\n           type=\"password\"\n           id=\"input-password\"\n           placeholder=\"Password\"\n           fieldSize=\"large\"\n           [status]=\"password.dirty ? (password.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.password.required')\"\n           [minlength]=\"getConfigValue('forms.validation.password.minLength')\"\n           [maxlength]=\"getConfigValue('forms.validation.password.maxLength')\"\n           [attr.aria-invalid]=\"password.invalid && password.touched ? true : null\">\n    <ng-container *ngIf=\"password.invalid && password.touched \">\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.required\">\n        Password is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.minlength || password.errors?.maxlength\">\n        Password should contain\n        from {{ getConfigValue('forms.validation.password.minLength') }}\n        to {{ getConfigValue('forms.validation.password.maxLength') }}\n        characters\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group accept-group\">\n    <nb-checkbox name=\"rememberMe\" [(ngModel)]=\"user.rememberMe\" *ngIf=\"rememberMe\">Remember me</nb-checkbox>\n  </div>\n\n  <button nbButton\n          fullWidth\n          status=\"primary\"\n          size=\"large\"\n          [disabled]=\"submitted || !form.valid\"\n          [class.btn-pulse]=\"submitted\">\n    Log In\n  </button>\n</form>\n\n<section *ngIf=\"socialLinks && socialLinks.length > 0\" class=\"links\" aria-label=\"Social sign in\">\n  or enter with:\n  <div class=\"socials\">\n    <ng-container *ngFor=\"let socialLink of socialLinks\">\n      <a *ngIf=\"socialLink.link\"\n         [routerLink]=\"socialLink.link\"\n         [attr.target]=\"socialLink.target\"\n         [attr.class]=\"socialLink.icon\"\n         [class.with-icon]=\"socialLink.icon\">\n        <nb-icon *ngIf=\"socialLink.icon; else title\" [icon]=\"socialLink.icon\"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n      <a *ngIf=\"socialLink.url\"\n         [attr.href]=\"socialLink.url\"\n         [attr.target]=\"socialLink.target\"\n         [attr.class]=\"socialLink.icon\"\n         [class.with-icon]=\"socialLink.icon\">\n        <nb-icon *ngIf=\"socialLink.icon; else title\" [icon]=\"socialLink.icon\"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n    </ng-container>\n  </div>\n</section>\n\n<section class=\"another-action\" aria-label=\"Register\">\n  Don't have an account? <a class=\"text-link\" routerLink=\"../register\">Register</a>\n</section>\n",
                changeDetection: ChangeDetectionStrategy.OnPush
            }]
    }], function () { return [{ type: NbAuthService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_OPTIONS]
            }] }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.Router }]; }, null); })();
    return NbLoginComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbRegisterComponent = /** @class */ (function () {
    function NbRegisterComponent(service, options, cd, router) {
        if (options === void 0) { options = {}; }
        this.service = service;
        this.options = options;
        this.cd = cd;
        this.router = router;
        this.redirectDelay = 0;
        this.showMessages = {};
        this.strategy = '';
        this.submitted = false;
        this.errors = [];
        this.messages = [];
        this.user = {};
        this.socialLinks = [];
        this.redirectDelay = this.getConfigValue('forms.register.redirectDelay');
        this.showMessages = this.getConfigValue('forms.register.showMessages');
        this.strategy = this.getConfigValue('forms.register.strategy');
        this.socialLinks = this.getConfigValue('forms.login.socialLinks');
    }
    NbRegisterComponent.prototype.register = function () {
        var _this = this;
        this.errors = this.messages = [];
        this.submitted = true;
        this.service.register(this.strategy, this.user).subscribe(function (result) {
            _this.submitted = false;
            if (result.isSuccess()) {
                _this.messages = result.getMessages();
            }
            else {
                _this.errors = result.getErrors();
            }
            var redirect = result.getRedirect();
            if (redirect) {
                setTimeout(function () {
                    return _this.router.navigateByUrl(redirect);
                }, _this.redirectDelay);
            }
            _this.cd.detectChanges();
        });
    };
    NbRegisterComponent.prototype.getConfigValue = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbRegisterComponent = __decorate([ __param(1, Inject(NB_AUTH_OPTIONS)),
        __metadata("design:paramtypes", [NbAuthService, Object, ChangeDetectorRef,
            Router])
    ], NbRegisterComponent);
NbRegisterComponent.ɵfac = function NbRegisterComponent_Factory(t) { return new (t || NbRegisterComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(NB_AUTH_OPTIONS), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
NbRegisterComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbRegisterComponent, selectors: [["nb-register"]], decls: 38, vars: 31, consts: [["id", "title", 1, "title"], ["outline", "danger", "role", "alert", 4, "ngIf"], ["outline", "success", "role", "alert", 4, "ngIf"], ["aria-labelledby", "title", 3, "ngSubmit"], ["form", "ngForm"], [1, "form-control-group"], ["for", "input-name", 1, "label"], ["nbInput", "", "id", "input-name", "name", "fullName", "placeholder", "Full name", "autofocus", "", "fullWidth", "", "fieldSize", "large", 3, "ngModel", "status", "required", "minlength", "maxlength", "ngModelChange"], ["fullName", "ngModel"], [4, "ngIf"], ["for", "input-email", 1, "label"], ["nbInput", "", "id", "input-email", "name", "email", "pattern", ".+@.+..+", "placeholder", "Email address", "fullWidth", "", "fieldSize", "large", 3, "ngModel", "status", "required", "ngModelChange"], ["email", "ngModel"], ["for", "input-password", 1, "label"], ["nbInput", "", "type", "password", "id", "input-password", "name", "password", "placeholder", "Password", "fullWidth", "", "fieldSize", "large", 3, "ngModel", "status", "required", "minlength", "maxlength", "ngModelChange"], ["password", "ngModel"], ["for", "input-re-password", 1, "label"], ["nbInput", "", "type", "password", "id", "input-re-password", "name", "rePass", "placeholder", "Confirm Password", "fullWidth", "", "fieldSize", "large", 3, "ngModel", "status", "required", "ngModelChange"], ["rePass", "ngModel"], ["class", "form-control-group accept-group", 4, "ngIf"], ["nbButton", "", "fullWidth", "", "status", "primary", "size", "large", 3, "disabled"], ["class", "links", "aria-label", "Social sign in", 4, "ngIf"], ["aria-label", "Sign in", 1, "another-action"], ["routerLink", "../login", 1, "text-link"], ["outline", "danger", "role", "alert"], [1, "alert-title"], [1, "alert-message-list"], ["class", "alert-message", 4, "ngFor", "ngForOf"], [1, "alert-message"], ["outline", "success", "role", "alert"], ["class", "caption status-danger", 4, "ngIf"], [1, "caption", "status-danger"], [1, "form-control-group", "accept-group"], ["name", "terms", 3, "ngModel", "required", "ngModelChange"], ["href", "#", "target", "_blank"], ["aria-label", "Social sign in", 1, "links"], [1, "socials"], [4, "ngFor", "ngForOf"], [3, "routerLink", "with-icon", 4, "ngIf"], [3, "with-icon", 4, "ngIf"], [3, "routerLink"], [3, "icon", 4, "ngIf", "ngIfElse"], ["title", ""], [3, "icon"]], template: function NbRegisterComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "h1", 0);
        ɵngcc0.ɵɵtext(1, "Register");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(2, NbRegisterComponent_nb_alert_2_Template, 6, 1, "nb-alert", 1);
        ɵngcc0.ɵɵtemplate(3, NbRegisterComponent_nb_alert_3_Template, 6, 1, "nb-alert", 2);
        ɵngcc0.ɵɵelementStart(4, "form", 3, 4);
        ɵngcc0.ɵɵlistener("ngSubmit", function NbRegisterComponent_Template_form_ngSubmit_4_listener() { return ctx.register(); });
        ɵngcc0.ɵɵelementStart(6, "div", 5);
        ɵngcc0.ɵɵelementStart(7, "label", 6);
        ɵngcc0.ɵɵtext(8, "Full name:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "input", 7, 8);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbRegisterComponent_Template_input_ngModelChange_9_listener($event) { return ctx.user.fullName = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(11, NbRegisterComponent_ng_container_11_Template, 3, 2, "ng-container", 9);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(12, "div", 5);
        ɵngcc0.ɵɵelementStart(13, "label", 10);
        ɵngcc0.ɵɵtext(14, "Email address:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(15, "input", 11, 12);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbRegisterComponent_Template_input_ngModelChange_15_listener($event) { return ctx.user.email = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(17, NbRegisterComponent_ng_container_17_Template, 3, 2, "ng-container", 9);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(18, "div", 5);
        ɵngcc0.ɵɵelementStart(19, "label", 13);
        ɵngcc0.ɵɵtext(20, "Password:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(21, "input", 14, 15);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbRegisterComponent_Template_input_ngModelChange_21_listener($event) { return ctx.user.password = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(23, NbRegisterComponent_ng_container_23_Template, 3, 2, "ng-container", 9);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(24, "div", 5);
        ɵngcc0.ɵɵelementStart(25, "label", 16);
        ɵngcc0.ɵɵtext(26, "Repeat password:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(27, "input", 17, 18);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbRegisterComponent_Template_input_ngModelChange_27_listener($event) { return ctx.user.confirmPassword = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(29, NbRegisterComponent_ng_container_29_Template, 3, 2, "ng-container", 9);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(30, NbRegisterComponent_div_30_Template, 6, 2, "div", 19);
        ɵngcc0.ɵɵelementStart(31, "button", 20);
        ɵngcc0.ɵɵtext(32, " Register ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(33, NbRegisterComponent_section_33_Template, 4, 1, "section", 21);
        ɵngcc0.ɵɵelementStart(34, "section", 22);
        ɵngcc0.ɵɵtext(35, " Already have an account? ");
        ɵngcc0.ɵɵelementStart(36, "a", 23);
        ɵngcc0.ɵɵtext(37, "Log in");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        var _r2 = ɵngcc0.ɵɵreference(5);
        var _r3 = ɵngcc0.ɵɵreference(10);
        var _r5 = ɵngcc0.ɵɵreference(16);
        var _r7 = ɵngcc0.ɵɵreference(22);
        var _r9 = ɵngcc0.ɵɵreference(28);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.error && (ctx.errors == null ? null : ctx.errors.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.success && (ctx.messages == null ? null : ctx.messages.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.fullName)("status", _r3.dirty ? _r3.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.fullName.required"))("minlength", ctx.getConfigValue("forms.validation.fullName.minLength"))("maxlength", ctx.getConfigValue("forms.validation.fullName.maxLength"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r3.invalid && _r3.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r3.invalid && _r3.touched);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.email)("status", _r5.dirty ? _r5.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.email.required"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r5.invalid && _r5.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r5.invalid && _r5.touched);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.password)("status", _r7.dirty ? _r7.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.password.required"))("minlength", ctx.getConfigValue("forms.validation.password.minLength"))("maxlength", ctx.getConfigValue("forms.validation.password.maxLength"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r7.invalid && _r7.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r7.invalid && _r7.touched);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.confirmPassword)("status", _r9.dirty ? _r9.invalid || _r7.value != _r9.value ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.password.required"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r9.invalid && _r9.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r9.invalid && _r9.touched);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.getConfigValue("forms.register.terms"));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("btn-pulse", ctx.submitted);
        ɵngcc0.ɵɵproperty("disabled", ctx.submitted || !_r2.valid);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.socialLinks && ctx.socialLinks.length > 0);
    } }, directives: [ɵngcc3.NgIf, ɵngcc5.ɵangular_packages_forms_forms_y, ɵngcc5.NgControlStatusGroup, ɵngcc5.NgForm, ɵngcc4.NbInputDirective, ɵngcc5.DefaultValueAccessor, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc5.RequiredValidator, ɵngcc5.MinLengthValidator, ɵngcc5.MaxLengthValidator, ɵngcc5.PatternValidator, ɵngcc4.NbButtonComponent, ɵngcc2.RouterLinkWithHref, ɵngcc4.NbAlertComponent, ɵngcc3.NgForOf, ɵngcc4.NbCheckboxComponent, ɵngcc4.NbIconComponent], styles: ["[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-bottom:2rem}"], changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbRegisterComponent, [{
        type: Component,
        args: [{
                selector: 'nb-register',
                template: "<h1 id=\"title\" class=\"title\">Register</h1>\n\n<nb-alert *ngIf=\"showMessages.error && errors?.length && !submitted\" outline=\"danger\" role=\"alert\">\n  <p class=\"alert-title\"><b>Oh snap!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let error of errors\" class=\"alert-message\">{{ error }}</li>\n  </ul>\n</nb-alert>\n\n<nb-alert *ngIf=\"showMessages.success && messages?.length && !submitted\" outline=\"success\" role=\"alert\">\n  <p class=\"alert-title\"><b>Hooray!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let message of messages\" class=\"alert-message\">{{ message }}</li>\n  </ul>\n</nb-alert>\n\n<form (ngSubmit)=\"register()\" #form=\"ngForm\" aria-labelledby=\"title\">\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-name\">Full name:</label>\n    <input nbInput\n           [(ngModel)]=\"user.fullName\"\n           #fullName=\"ngModel\"\n           id=\"input-name\"\n           name=\"fullName\"\n           placeholder=\"Full name\"\n           autofocus\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"fullName.dirty ? (fullName.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.fullName.required')\"\n           [minlength]=\"getConfigValue('forms.validation.fullName.minLength')\"\n           [maxlength]=\"getConfigValue('forms.validation.fullName.maxLength')\"\n           [attr.aria-invalid]=\"fullName.invalid && fullName.touched ? true : null\">\n    <ng-container *ngIf=\"fullName.invalid && fullName.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"fullName.errors?.required\">\n        Full name is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"fullName.errors?.minlength || fullName.errors?.maxlength\">\n        Full name should contains\n        from {{getConfigValue('forms.validation.fullName.minLength')}}\n        to {{getConfigValue('forms.validation.fullName.maxLength')}}\n        characters\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-email\">Email address:</label>\n    <input nbInput\n           [(ngModel)]=\"user.email\"\n           #email=\"ngModel\"\n           id=\"input-email\"\n           name=\"email\"\n           pattern=\".+@.+..+\"\n           placeholder=\"Email address\"\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"email.dirty ? (email.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.email.required')\"\n           [attr.aria-invalid]=\"email.invalid && email.touched ? true : null\">\n    <ng-container *ngIf=\"email.invalid && email.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.required\">\n        Email is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.pattern\">\n        Email should be the real one!\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-password\">Password:</label>\n    <input nbInput\n           [(ngModel)]=\"user.password\"\n           #password=\"ngModel\"\n           type=\"password\"\n           id=\"input-password\"\n           name=\"password\"\n           placeholder=\"Password\"\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"password.dirty ? (password.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.password.required')\"\n           [minlength]=\"getConfigValue('forms.validation.password.minLength')\"\n           [maxlength]=\"getConfigValue('forms.validation.password.maxLength')\"\n           [attr.aria-invalid]=\"password.invalid && password.touched ? true : null\">\n    <ng-container *ngIf=\"password.invalid && password.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.required\">\n        Password is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.minlength || password.errors?.maxlength\">\n        Password should contain\n        from {{ getConfigValue('forms.validation.password.minLength') }}\n        to {{ getConfigValue('forms.validation.password.maxLength') }}\n        characters\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-re-password\">Repeat password:</label>\n    <input nbInput\n           [(ngModel)]=\"user.confirmPassword\"\n           #rePass=\"ngModel\"\n           type=\"password\"\n           id=\"input-re-password\"\n           name=\"rePass\"\n           placeholder=\"Confirm Password\"\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"rePass.dirty ? (rePass.invalid || password.value != rePass.value  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.password.required')\"\n           [attr.aria-invalid]=\"rePass.invalid && rePass.touched ? true : null\">\n    <ng-container *ngIf=\"rePass.invalid && rePass.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"rePass.errors?.required\">\n        Password confirmation is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"password.value != rePass.value && !rePass.errors?.required\">\n        Password does not match the confirm password.\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-control-group accept-group\" *ngIf=\"getConfigValue('forms.register.terms')\">\n    <nb-checkbox name=\"terms\" [(ngModel)]=\"user.terms\" [required]=\"getConfigValue('forms.register.terms')\">\n      Agree to <a href=\"#\" target=\"_blank\"><strong>Terms & Conditions</strong></a>\n    </nb-checkbox>\n  </div>\n\n  <button nbButton\n          fullWidth\n          status=\"primary\"\n          size=\"large\"\n          [disabled]=\"submitted || !form.valid\"\n          [class.btn-pulse]=\"submitted\">\n    Register\n  </button>\n</form>\n\n<section *ngIf=\"socialLinks && socialLinks.length > 0\" class=\"links\" aria-label=\"Social sign in\">\n  or enter with:\n  <div class=\"socials\">\n    <ng-container *ngFor=\"let socialLink of socialLinks\">\n      <a *ngIf=\"socialLink.link\"\n         [routerLink]=\"socialLink.link\"\n         [attr.target]=\"socialLink.target\"\n         [attr.class]=\"socialLink.icon\"\n         [class.with-icon]=\"socialLink.icon\">\n        <nb-icon *ngIf=\"socialLink.icon; else title\" [icon]=\"socialLink.icon\"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n      <a *ngIf=\"socialLink.url\"\n         [attr.href]=\"socialLink.url\"\n         [attr.target]=\"socialLink.target\"\n         [attr.class]=\"socialLink.icon\"\n         [class.with-icon]=\"socialLink.icon\">\n        <nb-icon *ngIf=\"socialLink.icon; else title\" [icon]=\"socialLink.icon\"></nb-icon>\n        <ng-template #title>{{ socialLink.title }}</ng-template>\n      </a>\n    </ng-container>\n  </div>\n</section>\n\n<section class=\"another-action\" aria-label=\"Sign in\">\n  Already have an account? <a class=\"text-link\" routerLink=\"../login\">Log in</a>\n</section>\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host .title{margin-bottom:2rem}\n"]
            }]
    }], function () { return [{ type: NbAuthService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_OPTIONS]
            }] }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.Router }]; }, null); })();
    return NbRegisterComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbLogoutComponent = /** @class */ (function () {
    function NbLogoutComponent(service, options, router) {
        if (options === void 0) { options = {}; }
        this.service = service;
        this.options = options;
        this.router = router;
        this.redirectDelay = 0;
        this.strategy = '';
        this.redirectDelay = this.getConfigValue('forms.logout.redirectDelay');
        this.strategy = this.getConfigValue('forms.logout.strategy');
    }
    NbLogoutComponent.prototype.ngOnInit = function () {
        this.logout(this.strategy);
    };
    NbLogoutComponent.prototype.logout = function (strategy) {
        var _this = this;
        this.service.logout(strategy).subscribe(function (result) {
            var redirect = result.getRedirect();
            if (redirect) {
                setTimeout(function () {
                    return _this.router.navigateByUrl(redirect);
                }, _this.redirectDelay);
            }
        });
    };
    NbLogoutComponent.prototype.getConfigValue = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbLogoutComponent = __decorate([ __param(1, Inject(NB_AUTH_OPTIONS)),
        __metadata("design:paramtypes", [NbAuthService, Object, Router])
    ], NbLogoutComponent);
NbLogoutComponent.ɵfac = function NbLogoutComponent_Factory(t) { return new (t || NbLogoutComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(NB_AUTH_OPTIONS), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
NbLogoutComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbLogoutComponent, selectors: [["nb-logout"]], decls: 2, vars: 0, template: function NbLogoutComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div");
        ɵngcc0.ɵɵtext(1, "Logging out, please wait...");
        ɵngcc0.ɵɵelementEnd();
    } }, encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbLogoutComponent, [{
        type: Component,
        args: [{
                selector: 'nb-logout',
                template: "<div>Logging out, please wait...</div>\n"
            }]
    }], function () { return [{ type: NbAuthService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_OPTIONS]
            }] }, { type: ɵngcc2.Router }]; }, null); })();
    return NbLogoutComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbRequestPasswordComponent = /** @class */ (function () {
    function NbRequestPasswordComponent(service, options, cd, router) {
        if (options === void 0) { options = {}; }
        this.service = service;
        this.options = options;
        this.cd = cd;
        this.router = router;
        this.redirectDelay = 0;
        this.showMessages = {};
        this.strategy = '';
        this.submitted = false;
        this.errors = [];
        this.messages = [];
        this.user = {};
        this.redirectDelay = this.getConfigValue('forms.requestPassword.redirectDelay');
        this.showMessages = this.getConfigValue('forms.requestPassword.showMessages');
        this.strategy = this.getConfigValue('forms.requestPassword.strategy');
    }
    NbRequestPasswordComponent.prototype.requestPass = function () {
        var _this = this;
        this.errors = this.messages = [];
        this.submitted = true;
        this.service.requestPassword(this.strategy, this.user).subscribe(function (result) {
            _this.submitted = false;
            if (result.isSuccess()) {
                _this.messages = result.getMessages();
            }
            else {
                _this.errors = result.getErrors();
            }
            var redirect = result.getRedirect();
            if (redirect) {
                setTimeout(function () {
                    return _this.router.navigateByUrl(redirect);
                }, _this.redirectDelay);
            }
            _this.cd.detectChanges();
        });
    };
    NbRequestPasswordComponent.prototype.getConfigValue = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbRequestPasswordComponent = __decorate([ __param(1, Inject(NB_AUTH_OPTIONS)),
        __metadata("design:paramtypes", [NbAuthService, Object, ChangeDetectorRef,
            Router])
    ], NbRequestPasswordComponent);
NbRequestPasswordComponent.ɵfac = function NbRequestPasswordComponent_Factory(t) { return new (t || NbRequestPasswordComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(NB_AUTH_OPTIONS), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
NbRequestPasswordComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbRequestPasswordComponent, selectors: [["nb-request-password-page"]], decls: 23, vars: 10, consts: [["id", "title", 1, "title"], [1, "sub-title"], ["outline", "danger", "role", "alert", 4, "ngIf"], ["outline", "success", "role", "alert", 4, "ngIf"], ["aria-labelledby", "title", 3, "ngSubmit"], ["requestPassForm", "ngForm"], [1, "form-control-group"], ["for", "input-email", 1, "label"], ["nbInput", "", "id", "input-email", "name", "email", "pattern", ".+@.+\\..+", "placeholder", "Email address", "autofocus", "", "fullWidth", "", "fieldSize", "large", 3, "ngModel", "status", "required", "ngModelChange"], ["email", "ngModel"], [4, "ngIf"], ["nbButton", "", "fullWidth", "", "status", "primary", "size", "large", 3, "disabled"], ["aria-label", "Sign in or sign up", 1, "sign-in-or-up"], ["routerLink", "../login", 1, "text-link"], ["routerLink", "../register", 1, "text-link"], ["outline", "danger", "role", "alert"], [1, "alert-title"], [1, "alert-message-list"], ["class", "alert-message", 4, "ngFor", "ngForOf"], [1, "alert-message"], ["outline", "success", "role", "alert"], ["class", "caption status-danger", 4, "ngIf"], [1, "caption", "status-danger"]], template: function NbRequestPasswordComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "h1", 0);
        ɵngcc0.ɵɵtext(1, "Forgot Password");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "p", 1);
        ɵngcc0.ɵɵtext(3, "Enter your email address and we\u2019ll send a link to reset your password");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, NbRequestPasswordComponent_nb_alert_4_Template, 6, 1, "nb-alert", 2);
        ɵngcc0.ɵɵtemplate(5, NbRequestPasswordComponent_nb_alert_5_Template, 6, 1, "nb-alert", 3);
        ɵngcc0.ɵɵelementStart(6, "form", 4, 5);
        ɵngcc0.ɵɵlistener("ngSubmit", function NbRequestPasswordComponent_Template_form_ngSubmit_6_listener() { return ctx.requestPass(); });
        ɵngcc0.ɵɵelementStart(8, "div", 6);
        ɵngcc0.ɵɵelementStart(9, "label", 7);
        ɵngcc0.ɵɵtext(10, "Enter your email address:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "input", 8, 9);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbRequestPasswordComponent_Template_input_ngModelChange_11_listener($event) { return ctx.user.email = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(13, NbRequestPasswordComponent_ng_container_13_Template, 3, 2, "ng-container", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "button", 11);
        ɵngcc0.ɵɵtext(15, " Request password ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(16, "section", 12);
        ɵngcc0.ɵɵelementStart(17, "p");
        ɵngcc0.ɵɵelementStart(18, "a", 13);
        ɵngcc0.ɵɵtext(19, "Back to Log In");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "p");
        ɵngcc0.ɵɵelementStart(21, "a", 14);
        ɵngcc0.ɵɵtext(22, "Register");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        var _r2 = ɵngcc0.ɵɵreference(7);
        var _r3 = ɵngcc0.ɵɵreference(12);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.error && (ctx.errors == null ? null : ctx.errors.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.success && (ctx.messages == null ? null : ctx.messages.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.email)("status", _r3.dirty ? _r3.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.email.required"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r3.invalid && _r3.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r3.invalid && _r3.touched);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("btn-pulse", ctx.submitted);
        ɵngcc0.ɵɵproperty("disabled", ctx.submitted || !_r2.valid);
    } }, directives: [ɵngcc3.NgIf, ɵngcc5.ɵangular_packages_forms_forms_y, ɵngcc5.NgControlStatusGroup, ɵngcc5.NgForm, ɵngcc4.NbInputDirective, ɵngcc5.DefaultValueAccessor, ɵngcc5.PatternValidator, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc5.RequiredValidator, ɵngcc4.NbButtonComponent, ɵngcc2.RouterLinkWithHref, ɵngcc4.NbAlertComponent, ɵngcc3.NgForOf], styles: ["[_nghost-%COMP%]   .form-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:3rem}"], changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbRequestPasswordComponent, [{
        type: Component,
        args: [{
                selector: 'nb-request-password-page',
                template: "<h1 id=\"title\" class=\"title\">Forgot Password</h1>\n<p class=\"sub-title\">Enter your email address and we\u2019ll send a link to reset your password</p>\n\n<nb-alert *ngIf=\"showMessages.error && errors?.length && !submitted\" outline=\"danger\" role=\"alert\">\n  <p class=\"alert-title\"><b>Oh snap!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let error of errors\" class=\"alert-message\">{{ error }}</li>\n  </ul>\n</nb-alert>\n\n<nb-alert *ngIf=\"showMessages.success && messages?.length && !submitted\" outline=\"success\" role=\"alert\">\n  <p class=\"alert-title\"><b>Hooray!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let message of messages\" class=\"alert-message\">{{ message }}</li>\n  </ul>\n</nb-alert>\n\n<form (ngSubmit)=\"requestPass()\" #requestPassForm=\"ngForm\" aria-labelledby=\"title\">\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-email\">Enter your email address:</label>\n    <input nbInput\n           [(ngModel)]=\"user.email\"\n           #email=\"ngModel\"\n           id=\"input-email\"\n           name=\"email\"\n           pattern=\".+@.+\\..+\"\n           placeholder=\"Email address\"\n           autofocus\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"email.dirty ? (email.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.email.required')\"\n           [attr.aria-invalid]=\"email.invalid && email.touched ? true : null\">\n    <ng-container *ngIf=\"email.invalid && email.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.required\">\n        Email is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"email.errors?.pattern\">\n        Email should be the real one!\n      </p>\n    </ng-container>\n  </div>\n\n  <button nbButton\n          fullWidth\n          status=\"primary\"\n          size=\"large\"\n          [disabled]=\"submitted || !requestPassForm.valid\"\n          [class.btn-pulse]=\"submitted\">\n    Request password\n  </button>\n</form>\n\n<section class=\"sign-in-or-up\" aria-label=\"Sign in or sign up\">\n  <p><a class=\"text-link\" routerLink=\"../login\">Back to Log In</a></p>\n  <p><a routerLink=\"../register\" class=\"text-link\">Register</a></p>\n</section>\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host .form-group:last-of-type{margin-bottom:3rem}\n"]
            }]
    }], function () { return [{ type: NbAuthService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_OPTIONS]
            }] }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.Router }]; }, null); })();
    return NbRequestPasswordComponent;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */
var NbResetPasswordComponent = /** @class */ (function () {
    function NbResetPasswordComponent(service, options, cd, router) {
        if (options === void 0) { options = {}; }
        this.service = service;
        this.options = options;
        this.cd = cd;
        this.router = router;
        this.redirectDelay = 0;
        this.showMessages = {};
        this.strategy = '';
        this.submitted = false;
        this.errors = [];
        this.messages = [];
        this.user = {};
        this.redirectDelay = this.getConfigValue('forms.resetPassword.redirectDelay');
        this.showMessages = this.getConfigValue('forms.resetPassword.showMessages');
        this.strategy = this.getConfigValue('forms.resetPassword.strategy');
    }
    NbResetPasswordComponent.prototype.resetPass = function () {
        var _this = this;
        this.errors = this.messages = [];
        this.submitted = true;
        this.service.resetPassword(this.strategy, this.user).subscribe(function (result) {
            _this.submitted = false;
            if (result.isSuccess()) {
                _this.messages = result.getMessages();
            }
            else {
                _this.errors = result.getErrors();
            }
            var redirect = result.getRedirect();
            if (redirect) {
                setTimeout(function () {
                    return _this.router.navigateByUrl(redirect);
                }, _this.redirectDelay);
            }
            _this.cd.detectChanges();
        });
    };
    NbResetPasswordComponent.prototype.getConfigValue = function (key) {
        return getDeepFromObject(this.options, key, null);
    };
    NbResetPasswordComponent = __decorate([ __param(1, Inject(NB_AUTH_OPTIONS)),
        __metadata("design:paramtypes", [NbAuthService, Object, ChangeDetectorRef,
            Router])
    ], NbResetPasswordComponent);
NbResetPasswordComponent.ɵfac = function NbResetPasswordComponent_Factory(t) { return new (t || NbResetPasswordComponent)(ɵngcc0.ɵɵdirectiveInject(NbAuthService), ɵngcc0.ɵɵdirectiveInject(NB_AUTH_OPTIONS), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router)); };
NbResetPasswordComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: NbResetPasswordComponent, selectors: [["nb-reset-password-page"]], decls: 29, vars: 17, consts: [["id", "title", 1, "title"], [1, "sub-title"], ["outline", "danger", "role", "alert", 4, "ngIf"], ["outline", "success", "role", "alert", 4, "ngIf"], ["aria-labelledby", "title", 3, "ngSubmit"], ["resetPassForm", "ngForm"], [1, "form-control-group"], ["for", "input-password", 1, "label"], ["nbInput", "", "type", "password", "id", "input-password", "name", "password", "placeholder", "New Password", "autofocus", "", "fullWidth", "", "fieldSize", "large", 1, "first", 3, "ngModel", "status", "required", "minlength", "maxlength", "ngModelChange"], ["password", "ngModel"], [4, "ngIf"], [1, "form-group"], ["for", "input-re-password", 1, "label"], ["nbInput", "", "id", "input-re-password", "name", "rePass", "type", "password", "placeholder", "Confirm Password", "fullWidth", "", "fieldSize", "large", 1, "last", 3, "ngModel", "status", "required", "ngModelChange"], ["rePass", "ngModel"], ["nbButton", "", "status", "primary", "fullWidth", "", "size", "large", 3, "disabled"], ["aria-label", "Sign in or sign up", 1, "sign-in-or-up"], ["routerLink", "../login", 1, "text-link"], ["routerLink", "../register", 1, "text-link"], ["outline", "danger", "role", "alert"], [1, "alert-title"], [1, "alert-message-list"], ["class", "alert-message", 4, "ngFor", "ngForOf"], [1, "alert-message"], ["outline", "success", "role", "alert"], ["class", "caption status-danger", 4, "ngIf"], [1, "caption", "status-danger"]], template: function NbResetPasswordComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "h1", 0);
        ɵngcc0.ɵɵtext(1, "Change password");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "p", 1);
        ɵngcc0.ɵɵtext(3, "Please set a new password");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, NbResetPasswordComponent_nb_alert_4_Template, 6, 1, "nb-alert", 2);
        ɵngcc0.ɵɵtemplate(5, NbResetPasswordComponent_nb_alert_5_Template, 6, 1, "nb-alert", 3);
        ɵngcc0.ɵɵelementStart(6, "form", 4, 5);
        ɵngcc0.ɵɵlistener("ngSubmit", function NbResetPasswordComponent_Template_form_ngSubmit_6_listener() { return ctx.resetPass(); });
        ɵngcc0.ɵɵelementStart(8, "div", 6);
        ɵngcc0.ɵɵelementStart(9, "label", 7);
        ɵngcc0.ɵɵtext(10, "New Password:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(11, "input", 8, 9);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbResetPasswordComponent_Template_input_ngModelChange_11_listener($event) { return ctx.user.password = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(13, NbResetPasswordComponent_ng_container_13_Template, 3, 2, "ng-container", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(14, "div", 11);
        ɵngcc0.ɵɵelementStart(15, "label", 12);
        ɵngcc0.ɵɵtext(16, "Confirm Password:");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(17, "input", 13, 14);
        ɵngcc0.ɵɵlistener("ngModelChange", function NbResetPasswordComponent_Template_input_ngModelChange_17_listener($event) { return ctx.user.confirmPassword = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(19, NbResetPasswordComponent_ng_container_19_Template, 3, 2, "ng-container", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "button", 15);
        ɵngcc0.ɵɵtext(21, " Change password ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(22, "section", 16);
        ɵngcc0.ɵɵelementStart(23, "p");
        ɵngcc0.ɵɵelementStart(24, "a", 17);
        ɵngcc0.ɵɵtext(25, "Back to Log In");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(26, "p");
        ɵngcc0.ɵɵelementStart(27, "a", 18);
        ɵngcc0.ɵɵtext(28, "Register");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        var _r2 = ɵngcc0.ɵɵreference(7);
        var _r3 = ɵngcc0.ɵɵreference(12);
        var _r5 = ɵngcc0.ɵɵreference(18);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.error && (ctx.errors == null ? null : ctx.errors.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showMessages.success && (ctx.messages == null ? null : ctx.messages.length) && !ctx.submitted);
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.password)("status", _r3.dirty ? _r3.invalid ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.password.required"))("minlength", ctx.getConfigValue("forms.validation.password.minLength"))("maxlength", ctx.getConfigValue("forms.validation.password.maxLength"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r3.invalid && _r3.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r3.invalid && _r3.touched);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngModel", ctx.user.confirmPassword)("status", _r5.touched ? _r5.invalid || _r3.value != _r5.value ? "danger" : "success" : "basic")("required", ctx.getConfigValue("forms.validation.password.required"));
        ɵngcc0.ɵɵattribute("aria-invalid", _r5.invalid && _r5.touched ? true : null);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", _r5.touched);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("btn-pulse", ctx.submitted);
        ɵngcc0.ɵɵproperty("disabled", ctx.submitted || !_r2.valid);
    } }, directives: [ɵngcc3.NgIf, ɵngcc5.ɵangular_packages_forms_forms_y, ɵngcc5.NgControlStatusGroup, ɵngcc5.NgForm, ɵngcc4.NbInputDirective, ɵngcc5.DefaultValueAccessor, ɵngcc5.NgControlStatus, ɵngcc5.NgModel, ɵngcc5.RequiredValidator, ɵngcc5.MinLengthValidator, ɵngcc5.MaxLengthValidator, ɵngcc4.NbButtonComponent, ɵngcc2.RouterLinkWithHref, ɵngcc4.NbAlertComponent, ɵngcc3.NgForOf], styles: ["[_nghost-%COMP%]   .form-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:3rem}"], changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbResetPasswordComponent, [{
        type: Component,
        args: [{
                selector: 'nb-reset-password-page',
                template: "<h1 id=\"title\" class=\"title\">Change password</h1>\n<p class=\"sub-title\">Please set a new password</p>\n\n<nb-alert *ngIf=\"showMessages.error && errors?.length && !submitted\" outline=\"danger\" role=\"alert\">\n  <p class=\"alert-title\"><b>Oh snap!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let error of errors\" class=\"alert-message\">{{ error }}</li>\n  </ul>\n</nb-alert>\n\n<nb-alert *ngIf=\"showMessages.success && messages?.length && !submitted\" outline=\"success\" role=\"alert\">\n  <p class=\"alert-title\"><b>Hooray!</b></p>\n  <ul class=\"alert-message-list\">\n    <li *ngFor=\"let message of messages\" class=\"alert-message\">{{ message }}</li>\n  </ul>\n</nb-alert>\n\n<form (ngSubmit)=\"resetPass()\" #resetPassForm=\"ngForm\" aria-labelledby=\"title\">\n\n  <div class=\"form-control-group\">\n    <label class=\"label\" for=\"input-password\">New Password:</label>\n    <input nbInput\n           [(ngModel)]=\"user.password\"\n           #password=\"ngModel\"\n           type=\"password\"\n           id=\"input-password\"\n           name=\"password\"\n           class=\"first\"\n           placeholder=\"New Password\"\n           autofocus\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"password.dirty ? (password.invalid  ? 'danger' : 'success') : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.password.required')\"\n           [minlength]=\"getConfigValue('forms.validation.password.minLength')\"\n           [maxlength]=\"getConfigValue('forms.validation.password.maxLength')\"\n           [attr.aria-invalid]=\"password.invalid && password.touched ? true : null\">\n    <ng-container *ngIf=\"password.invalid && password.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.required\">\n        Password is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"password.errors?.minlength || password.errors?.maxlength\">\n        Password should contains\n        from {{getConfigValue('forms.validation.password.minLength')}}\n        to {{getConfigValue('forms.validation.password.maxLength')}}\n        characters\n      </p>\n    </ng-container>\n  </div>\n\n  <div class=\"form-group\">\n    <label class=\"label\" for=\"input-re-password\">Confirm Password:</label>\n    <input nbInput\n           [(ngModel)]=\"user.confirmPassword\"\n           #rePass=\"ngModel\"\n           id=\"input-re-password\"\n           name=\"rePass\"\n           type=\"password\"\n           class=\"last\"\n           placeholder=\"Confirm Password\"\n           fullWidth\n           fieldSize=\"large\"\n           [status]=\"rePass.touched\n               ? (rePass.invalid || password.value != rePass.value ? 'danger' : 'success')\n               : 'basic'\"\n           [required]=\"getConfigValue('forms.validation.password.required')\"\n           [attr.aria-invalid]=\"rePass.invalid && rePass.touched ? true : null\">\n    <ng-container *ngIf=\"rePass.touched\">\n      <p class=\"caption status-danger\" *ngIf=\"rePass.invalid && rePass.errors?.required\">\n        Password confirmation is required!\n      </p>\n      <p class=\"caption status-danger\" *ngIf=\"password.value != rePass.value && !rePass.errors?.required\">\n        Password does not match the confirm password.\n      </p>\n    </ng-container>\n  </div>\n\n  <button nbButton\n          status=\"primary\"\n          fullWidth\n          size=\"large\"\n          [disabled]=\"submitted || !resetPassForm.valid\"\n          [class.btn-pulse]=\"submitted\">\n    Change password\n  </button>\n</form>\n\n<section class=\"sign-in-or-up\" aria-label=\"Sign in or sign up\">\n  <p><a class=\"text-link\" routerLink=\"../login\">Back to Log In</a></p>\n  <p><a class=\"text-link\" routerLink=\"../register\">Register</a></p>\n</section>\n",
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [":host .form-group:last-of-type{margin-bottom:3rem}\n"]
            }]
    }], function () { return [{ type: NbAuthService }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_OPTIONS]
            }] }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc2.Router }]; }, null); })();
    return NbResetPasswordComponent;
}());

function nbStrategiesFactory(options, injector) {
    var strategies = [];
    options.strategies
        .forEach(function (_a) {
        var strategyClass = _a[0], strategyOptions = _a[1];
        var strategy = injector.get(strategyClass);
        strategy.setOptions(strategyOptions);
        strategies.push(strategy);
    });
    return strategies;
}
function nbTokensFactory(strategies) {
    var tokens = [];
    strategies
        .forEach(function (strategy) {
        tokens.push(strategy.getOption('token.class'));
    });
    return tokens;
}
function nbOptionsFactory(options) {
    return deepExtend(defaultAuthOptions, options);
}
function nbNoOpInterceptorFilter(req) {
    return true;
}
var NbAuthModule = /** @class */ (function () {
    function NbAuthModule() {
    }
    NbAuthModule_1 = NbAuthModule;
    NbAuthModule.forRoot = function (nbAuthOptions) {
        return {
            ngModule: NbAuthModule_1,
            providers: [
                { provide: NB_AUTH_USER_OPTIONS, useValue: nbAuthOptions },
                { provide: NB_AUTH_OPTIONS, useFactory: nbOptionsFactory, deps: [NB_AUTH_USER_OPTIONS] },
                { provide: NB_AUTH_STRATEGIES, useFactory: nbStrategiesFactory, deps: [NB_AUTH_OPTIONS, Injector] },
                { provide: NB_AUTH_TOKENS, useFactory: nbTokensFactory, deps: [NB_AUTH_STRATEGIES] },
                { provide: NB_AUTH_FALLBACK_TOKEN, useValue: NbAuthSimpleToken },
                { provide: NB_AUTH_INTERCEPTOR_HEADER, useValue: 'Authorization' },
                { provide: NB_AUTH_TOKEN_INTERCEPTOR_FILTER, useValue: nbNoOpInterceptorFilter },
                { provide: NbTokenStorage, useClass: NbTokenLocalStorage },
                NbAuthTokenParceler,
                NbAuthService,
                NbTokenService,
                NbDummyAuthStrategy,
                NbPasswordAuthStrategy,
                NbOAuth2AuthStrategy,
            ],
        };
    };
    var NbAuthModule_1;
NbAuthModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NbAuthModule });
NbAuthModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NbAuthModule_Factory(t) { return new (t || NbAuthModule)(); }, imports: [[
            CommonModule,
            NbLayoutModule,
            NbCardModule,
            NbCheckboxModule,
            NbAlertModule,
            NbInputModule,
            NbButtonModule,
            RouterModule,
            FormsModule,
            NbIconModule,
        ]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(NbAuthModule, { declarations: function () { return [NbAuthComponent,
        NbAuthBlockComponent,
        NbLoginComponent,
        NbRegisterComponent,
        NbRequestPasswordComponent,
        NbResetPasswordComponent,
        NbLogoutComponent]; }, imports: function () { return [CommonModule,
        NbLayoutModule,
        NbCardModule,
        NbCheckboxModule,
        NbAlertModule,
        NbInputModule,
        NbButtonModule,
        RouterModule,
        FormsModule,
        NbIconModule]; }, exports: function () { return [NbAuthComponent,
        NbAuthBlockComponent,
        NbLoginComponent,
        NbRegisterComponent,
        NbRequestPasswordComponent,
        NbResetPasswordComponent,
        NbLogoutComponent]; } }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthModule, [{
        type: NgModule,
        args: [{
                imports: [
                    CommonModule,
                    NbLayoutModule,
                    NbCardModule,
                    NbCheckboxModule,
                    NbAlertModule,
                    NbInputModule,
                    NbButtonModule,
                    RouterModule,
                    FormsModule,
                    NbIconModule,
                ],
                declarations: [
                    NbAuthComponent,
                    NbAuthBlockComponent,
                    NbLoginComponent,
                    NbRegisterComponent,
                    NbRequestPasswordComponent,
                    NbResetPasswordComponent,
                    NbLogoutComponent,
                ],
                exports: [
                    NbAuthComponent,
                    NbAuthBlockComponent,
                    NbLoginComponent,
                    NbRegisterComponent,
                    NbRequestPasswordComponent,
                    NbResetPasswordComponent,
                    NbLogoutComponent,
                ]
            }]
    }], function () { return []; }, null); })();
    return NbAuthModule;
}());

var routes = [
    {
        path: 'auth',
        component: NbAuthComponent,
        children: [
            {
                path: '',
                component: NbLoginComponent,
            },
            {
                path: 'login',
                component: NbLoginComponent,
            },
            {
                path: 'register',
                component: NbRegisterComponent,
            },
            {
                path: 'logout',
                component: NbLogoutComponent,
            },
            {
                path: 'request-password',
                component: NbRequestPasswordComponent,
            },
            {
                path: 'reset-password',
                component: NbResetPasswordComponent,
            },
        ],
    },
];

var NbAuthJWTInterceptor = /** @class */ (function () {
    function NbAuthJWTInterceptor(injector, filter$$1) {
        this.injector = injector;
        this.filter = filter$$1;
    }
    NbAuthJWTInterceptor.prototype.intercept = function (req, next) {
        var _this = this;
        // do not intercept request whose urls are filtered by the injected filter
        if (!this.filter(req)) {
            return this.authService.isAuthenticatedOrRefresh()
                .pipe(switchMap(function (authenticated) {
                if (authenticated) {
                    return _this.authService.getToken().pipe(switchMap(function (token) {
                        var JWT = "Bearer " + token.getValue();
                        req = req.clone({
                            setHeaders: {
                                Authorization: JWT,
                            },
                        });
                        return next.handle(req);
                    }));
                }
                else {
                    // Request is sent to server without authentication so that the client code
                    // receives the 401/403 error and can act as desired ('session expired', redirect to login, aso)
                    return next.handle(req);
                }
            }));
        }
        else {
            return next.handle(req);
        }
    };
    Object.defineProperty(NbAuthJWTInterceptor.prototype, "authService", {
        get: function () {
            return this.injector.get(NbAuthService);
        },
        enumerable: true,
        configurable: true
    });
    NbAuthJWTInterceptor = __decorate([ __param(1, Inject(NB_AUTH_TOKEN_INTERCEPTOR_FILTER)),
        __metadata("design:paramtypes", [Injector, Object])
    ], NbAuthJWTInterceptor);
NbAuthJWTInterceptor.ɵfac = function NbAuthJWTInterceptor_Factory(t) { return new (t || NbAuthJWTInterceptor)(ɵngcc0.ɵɵinject(ɵngcc0.Injector), ɵngcc0.ɵɵinject(NB_AUTH_TOKEN_INTERCEPTOR_FILTER)); };
NbAuthJWTInterceptor.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbAuthJWTInterceptor, factory: function (t) { return NbAuthJWTInterceptor.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthJWTInterceptor, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.Injector }, { type: Object, decorators: [{
                type: Inject,
                args: [NB_AUTH_TOKEN_INTERCEPTOR_FILTER]
            }] }]; }, null); })();
    return NbAuthJWTInterceptor;
}());

var NbAuthSimpleInterceptor = /** @class */ (function () {
    function NbAuthSimpleInterceptor(injector, headerName) {
        if (headerName === void 0) { headerName = 'Authorization'; }
        this.injector = injector;
        this.headerName = headerName;
    }
    NbAuthSimpleInterceptor.prototype.intercept = function (req, next) {
        var _this = this;
        return this.authService.getToken()
            .pipe(switchMap(function (token) {
            var _a;
            if (token && token.getValue()) {
                req = req.clone({
                    setHeaders: (_a = {},
                        _a[_this.headerName] = token.getValue(),
                        _a),
                });
            }
            return next.handle(req);
        }));
    };
    Object.defineProperty(NbAuthSimpleInterceptor.prototype, "authService", {
        get: function () {
            return this.injector.get(NbAuthService);
        },
        enumerable: true,
        configurable: true
    });
    NbAuthSimpleInterceptor = __decorate([ __param(1, Inject(NB_AUTH_INTERCEPTOR_HEADER)),
        __metadata("design:paramtypes", [Injector, String])
    ], NbAuthSimpleInterceptor);
NbAuthSimpleInterceptor.ɵfac = function NbAuthSimpleInterceptor_Factory(t) { return new (t || NbAuthSimpleInterceptor)(ɵngcc0.ɵɵinject(ɵngcc0.Injector), ɵngcc0.ɵɵinject(NB_AUTH_INTERCEPTOR_HEADER)); };
NbAuthSimpleInterceptor.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NbAuthSimpleInterceptor, factory: function (t) { return NbAuthSimpleInterceptor.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NbAuthSimpleInterceptor, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc0.Injector }, { type: String, decorators: [{
                type: Inject,
                args: [NB_AUTH_INTERCEPTOR_HEADER]
            }] }]; }, null); })();
    return NbAuthSimpleInterceptor;
}());

var NbUser = /** @class */ (function () {
    function NbUser(id, email, password, rememberMe, terms, confirmPassword, fullName) {
        this.id = id;
        this.email = email;
        this.password = password;
        this.rememberMe = rememberMe;
        this.terms = terms;
        this.confirmPassword = confirmPassword;
        this.fullName = fullName;
    }
    return NbUser;
}());

/**
 * @license
 * Copyright Akveo. All Rights Reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 */

/**
 * Generated bundle index. Do not edit.
 */

export { defaultAuthOptions, NB_AUTH_OPTIONS, NB_AUTH_USER_OPTIONS, NB_AUTH_STRATEGIES, NB_AUTH_TOKENS, NB_AUTH_INTERCEPTOR_HEADER, NB_AUTH_TOKEN_INTERCEPTOR_FILTER, nbStrategiesFactory, nbTokensFactory, nbOptionsFactory, nbNoOpInterceptorFilter, NbAuthModule, routes, NbAuthComponent, NbAuthBlockComponent, NbLoginComponent, NbLogoutComponent, NbRegisterComponent, NbRequestPasswordComponent, NbResetPasswordComponent, NbAuthService, NbAuthResult, NbAuthJWTInterceptor, NbAuthSimpleInterceptor, NbAuthToken, NbAuthTokenNotFoundError, NbAuthIllegalTokenError, NbAuthEmptyTokenError, NbAuthIllegalJWTTokenError, nbAuthCreateToken, decodeJwtPayload, NbAuthSimpleToken, NbAuthJWTToken, NbAuthOAuth2Token, NbAuthOAuth2JWTToken, ɵ0, NbTokenStorage, NbTokenLocalStorage, NbTokenService, NB_AUTH_FALLBACK_TOKEN, NbAuthTokenParceler, NbAuthStrategy, NbAuthStrategyOptions, NbDummyAuthStrategy, NbDummyAuthStrategyOptions, dummyStrategyOptions, NbPasswordAuthStrategy, NbPasswordAuthStrategyOptions, passwordStrategyOptions, NbOAuth2AuthStrategy, NbOAuth2ResponseType, NbOAuth2GrantType, NbOAuth2ClientAuthMethod, NbOAuth2AuthStrategyOptions, auth2StrategyOptions, NbUser, deepExtend, getDeepFromObject, urlBase64Decode, b64decode, b64DecodeUnicode };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FFTztBQUNQO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7a0NBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FFTztBQUNQOzs7Ozs2RUFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FFTztBQUNQOzs7Ozt3RUFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBRU87QUFDUDtBQUNBOzs7Ozs7OztrQ0FBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OzBCQUc0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUVPO0FBQ1A7QUFDQTtBQUNBOzs7Ozs7OztrQ0FBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9FQUVPO0FBQ1A7Ozs7OzRHQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQU1PO0FBQ1A7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztrR0FBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztnREFPNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FNTztBQUNQO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7K0ZBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBT087QUFDUDtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OytGQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FLTztBQUNQO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7MkRBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FPTztBQUNQO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7K0ZBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FPTztBQUNQO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7K0ZBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztnREFrQ3FCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBRU87QUFDUDtBQUNBOzs7Ozs7OztrQ0FBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FFTztBQUNQO0FBQ0E7Ozs7Ozs7O2tDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiwgSW5qZWN0b3IsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBfX2Fzc2lnbiwgX19kZWNvcmF0ZSwgX19leHRlbmRzLCBfX21ldGFkYXRhLCBfX3BhcmFtIH0gZnJvbSAndHNsaWInO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlLCBMb2NhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyLCBSb3V0ZXJNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBOQl9XSU5ET1csIE5iQWxlcnRNb2R1bGUsIE5iQnV0dG9uTW9kdWxlLCBOYkNhcmRNb2R1bGUsIE5iQ2hlY2tib3hNb2R1bGUsIE5iSWNvbk1vZHVsZSwgTmJJbnB1dE1vZHVsZSwgTmJMYXlvdXRNb2R1bGUgfSBmcm9tICdAbmVidWxhci90aGVtZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBkZWxheSwgZmlsdGVyLCBtYXAsIHNoYXJlLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwSGVhZGVycywgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG52YXIgc29jaWFsTGlua3MgPSBbXTtcbnZhciBkZWZhdWx0QXV0aE9wdGlvbnMgPSB7XG4gICAgc3RyYXRlZ2llczogW10sXG4gICAgZm9ybXM6IHtcbiAgICAgICAgbG9naW46IHtcbiAgICAgICAgICAgIHJlZGlyZWN0RGVsYXk6IDUwMCxcbiAgICAgICAgICAgIHN0cmF0ZWd5OiAnZW1haWwnLFxuICAgICAgICAgICAgcmVtZW1iZXJNZTogdHJ1ZSxcbiAgICAgICAgICAgIHNob3dNZXNzYWdlczoge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc29jaWFsTGlua3M6IHNvY2lhbExpbmtzLFxuICAgICAgICB9LFxuICAgICAgICByZWdpc3Rlcjoge1xuICAgICAgICAgICAgcmVkaXJlY3REZWxheTogNTAwLFxuICAgICAgICAgICAgc3RyYXRlZ3k6ICdlbWFpbCcsXG4gICAgICAgICAgICBzaG93TWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVycm9yOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRlcm1zOiB0cnVlLFxuICAgICAgICAgICAgc29jaWFsTGlua3M6IHNvY2lhbExpbmtzLFxuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0UGFzc3dvcmQ6IHtcbiAgICAgICAgICAgIHJlZGlyZWN0RGVsYXk6IDUwMCxcbiAgICAgICAgICAgIHN0cmF0ZWd5OiAnZW1haWwnLFxuICAgICAgICAgICAgc2hvd01lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzb2NpYWxMaW5rczogc29jaWFsTGlua3MsXG4gICAgICAgIH0sXG4gICAgICAgIHJlc2V0UGFzc3dvcmQ6IHtcbiAgICAgICAgICAgIHJlZGlyZWN0RGVsYXk6IDUwMCxcbiAgICAgICAgICAgIHN0cmF0ZWd5OiAnZW1haWwnLFxuICAgICAgICAgICAgc2hvd01lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzb2NpYWxMaW5rczogc29jaWFsTGlua3MsXG4gICAgICAgIH0sXG4gICAgICAgIGxvZ291dDoge1xuICAgICAgICAgICAgcmVkaXJlY3REZWxheTogNTAwLFxuICAgICAgICAgICAgc3RyYXRlZ3k6ICdlbWFpbCcsXG4gICAgICAgIH0sXG4gICAgICAgIHZhbGlkYXRpb246IHtcbiAgICAgICAgICAgIHBhc3N3b3JkOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbWluTGVuZ3RoOiA0LFxuICAgICAgICAgICAgICAgIG1heExlbmd0aDogNTAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdWxsTmFtZToge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtaW5MZW5ndGg6IDQsXG4gICAgICAgICAgICAgICAgbWF4TGVuZ3RoOiA1MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgfSxcbn07XG52YXIgTkJfQVVUSF9PUFRJT05TID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIEF1dGggT3B0aW9ucycpO1xudmFyIE5CX0FVVEhfVVNFUl9PUFRJT05TID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIFVzZXIgQXV0aCBPcHRpb25zJyk7XG52YXIgTkJfQVVUSF9TVFJBVEVHSUVTID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIEF1dGggU3RyYXRlZ2llcycpO1xudmFyIE5CX0FVVEhfVE9LRU5TID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIEF1dGggVG9rZW5zJyk7XG52YXIgTkJfQVVUSF9JTlRFUkNFUFRPUl9IRUFERVIgPSBuZXcgSW5qZWN0aW9uVG9rZW4oJ05lYnVsYXIgU2ltcGxlIEludGVyY2VwdG9yIEhlYWRlcicpO1xudmFyIE5CX0FVVEhfVE9LRU5fSU5URVJDRVBUT1JfRklMVEVSID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIEludGVyY2VwdG9yIEZpbHRlcicpO1xuXG4vKipcbiAqIEV4dGVuZGluZyBvYmplY3QgdGhhdCBlbnRlcmVkIGluIGZpcnN0IGFyZ3VtZW50LlxuICpcbiAqIFJldHVybnMgZXh0ZW5kZWQgb2JqZWN0IG9yIGZhbHNlIGlmIGhhdmUgbm8gdGFyZ2V0IG9iamVjdCBvciBpbmNvcnJlY3QgdHlwZS5cbiAqXG4gKiBJZiB5b3Ugd2lzaCB0byBjbG9uZSBzb3VyY2Ugb2JqZWN0ICh3aXRob3V0IG1vZGlmeSBpdCksIGp1c3QgdXNlIGVtcHR5IG5ld1xuICogb2JqZWN0IGFzIGZpcnN0IGFyZ3VtZW50LCBsaWtlIHRoaXM6XG4gKiAgIGRlZXBFeHRlbmQoe30sIHlvdXJPYmpfMSwgW3lvdXJPYmpfTl0pO1xuICovXG52YXIgZGVlcEV4dGVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgb2JqZWN0cyA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIG9iamVjdHNbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxIHx8IHR5cGVvZiBhcmd1bWVudHNbMF0gIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICAgIHJldHVybiBhcmd1bWVudHNbMF07XG4gICAgfVxuICAgIHZhciB0YXJnZXQgPSBhcmd1bWVudHNbMF07XG4gICAgLy8gY29udmVydCBhcmd1bWVudHMgdG8gYXJyYXkgYW5kIGN1dCBvZmYgdGFyZ2V0IG9iamVjdFxuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICB2YXIgdmFsLCBzcmM7XG4gICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgLy8gc2tpcCBhcmd1bWVudCBpZiBpdCBpcyBhcnJheSBvciBpc24ndCBvYmplY3RcbiAgICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IEFycmF5LmlzQXJyYXkob2JqKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5rZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBzcmMgPSB0YXJnZXRba2V5XTsgLy8gc291cmNlIHZhbHVlXG4gICAgICAgICAgICB2YWwgPSBvYmpba2V5XTsgLy8gbmV3IHZhbHVlXG4gICAgICAgICAgICAvLyByZWN1cnNpb24gcHJldmVudGlvblxuICAgICAgICAgICAgaWYgKHZhbCA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGlmIG5ldyB2YWx1ZSBpc24ndCBvYmplY3QgdGhlbiBqdXN0IG92ZXJ3cml0ZSBieSBuZXcgdmFsdWVcbiAgICAgICAgICAgICAgICAgKiBpbnN0ZWFkIG9mIGV4dGVuZGluZy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWwgIT09ICdvYmplY3QnIHx8IHZhbCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBqdXN0IGNsb25lIGFycmF5cyAoYW5kIHJlY3Vyc2l2ZSBjbG9uZSBvYmplY3RzIGluc2lkZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gZGVlcENsb25lQXJyYXkodmFsKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgLy8gY3VzdG9tIGNsb25pbmcgYW5kIG92ZXJ3cml0ZSBmb3Igc3BlY2lmaWMgb2JqZWN0c1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXNTcGVjaWZpY1ZhbHVlKHZhbCkpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IGNsb25lU3BlY2lmaWNWYWx1ZSh2YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAvLyBvdmVyd3JpdGUgYnkgbmV3IHZhbHVlIGlmIHNvdXJjZSBpc24ndCBvYmplY3Qgb3IgYXJyYXlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBzcmMgIT09ICdvYmplY3QnIHx8IHNyYyA9PT0gbnVsbCB8fCBBcnJheS5pc0FycmF5KHNyYykpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IGRlZXBFeHRlbmQoe30sIHZhbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8vIHNvdXJjZSB2YWx1ZSBhbmQgbmV3IHZhbHVlIGlzIG9iamVjdHMgYm90aCwgZXh0ZW5kaW5nLi4uXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IGRlZXBFeHRlbmQoc3JjLCB2YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhcmdldDtcbn07XG5mdW5jdGlvbiBpc1NwZWNpZmljVmFsdWUodmFsKSB7XG4gICAgcmV0dXJuICh2YWwgaW5zdGFuY2VvZiBEYXRlXG4gICAgICAgIHx8IHZhbCBpbnN0YW5jZW9mIFJlZ0V4cCkgPyB0cnVlIDogZmFsc2U7XG59XG5mdW5jdGlvbiBjbG9uZVNwZWNpZmljVmFsdWUodmFsKSB7XG4gICAgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbC5nZXRUaW1lKCkpO1xuICAgIH1cbiAgICBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodmFsKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2xvbmVTcGVjaWZpY1ZhbHVlOiBVbmV4cGVjdGVkIHNpdHVhdGlvbicpO1xuICAgIH1cbn1cbi8qKlxuICogUmVjdXJzaXZlIGNsb25pbmcgYXJyYXkuXG4gKi9cbmZ1bmN0aW9uIGRlZXBDbG9uZUFycmF5KGFycikge1xuICAgIHZhciBjbG9uZSA9IFtdO1xuICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnICYmIGl0ZW0gIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgY2xvbmVbaW5kZXhdID0gZGVlcENsb25lQXJyYXkoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpc1NwZWNpZmljVmFsdWUoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICBjbG9uZVtpbmRleF0gPSBjbG9uZVNwZWNpZmljVmFsdWUoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjbG9uZVtpbmRleF0gPSBkZWVwRXh0ZW5kKHt9LCBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNsb25lW2luZGV4XSA9IGl0ZW07XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2xvbmU7XG59XG4vLyBnZXREZWVwRnJvbU9iamVjdCh7cmVzdWx0OiB7ZGF0YTogMX19LCAncmVzdWx0LmRhdGEnLCAyKTsgLy8gcmV0dXJucyAxXG5mdW5jdGlvbiBnZXREZWVwRnJvbU9iamVjdChvYmplY3QsIG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xuICAgIGlmIChvYmplY3QgPT09IHZvaWQgMCkgeyBvYmplY3QgPSB7fTsgfVxuICAgIHZhciBrZXlzID0gbmFtZS5zcGxpdCgnLicpO1xuICAgIC8vIGNsb25lIHRoZSBvYmplY3RcbiAgICB2YXIgbGV2ZWwgPSBkZWVwRXh0ZW5kKHt9LCBvYmplY3QgfHwge30pO1xuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoaykge1xuICAgICAgICBpZiAobGV2ZWwgJiYgdHlwZW9mIGxldmVsW2tdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgbGV2ZWwgPSBsZXZlbFtrXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxldmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHR5cGVvZiBsZXZlbCA9PT0gJ3VuZGVmaW5lZCcgPyBkZWZhdWx0VmFsdWUgOiBsZXZlbDtcbn1cbmZ1bmN0aW9uIHVybEJhc2U2NERlY29kZShzdHIpIHtcbiAgICB2YXIgb3V0cHV0ID0gc3RyLnJlcGxhY2UoLy0vZywgJysnKS5yZXBsYWNlKC9fL2csICcvJyk7XG4gICAgc3dpdGNoIChvdXRwdXQubGVuZ3RoICUgNCkge1xuICAgICAgICBjYXNlIDA6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgMjoge1xuICAgICAgICAgICAgb3V0cHV0ICs9ICc9PSc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIDM6IHtcbiAgICAgICAgICAgIG91dHB1dCArPSAnPSc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lsbGVnYWwgYmFzZTY0dXJsIHN0cmluZyEnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYjY0RGVjb2RlVW5pY29kZShvdXRwdXQpO1xufVxuZnVuY3Rpb24gYjY0ZGVjb2RlKHN0cikge1xuICAgIHZhciBjaGFycyA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSc7XG4gICAgdmFyIG91dHB1dCA9ICcnO1xuICAgIHN0ciA9IFN0cmluZyhzdHIpLnJlcGxhY2UoLz0rJC8sICcnKTtcbiAgICBpZiAoc3RyLmxlbmd0aCAlIDQgPT09IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiJ2F0b2InIGZhaWxlZDogVGhlIHN0cmluZyB0byBiZSBkZWNvZGVkIGlzIG5vdCBjb3JyZWN0bHkgZW5jb2RlZC5cIik7XG4gICAgfVxuICAgIGZvciAoXG4gICAgLy8gaW5pdGlhbGl6ZSByZXN1bHQgYW5kIGNvdW50ZXJzXG4gICAgdmFyIGJjID0gMCwgYnMgPSB2b2lkIDAsIGJ1ZmZlciA9IHZvaWQgMCwgaWR4ID0gMDsgXG4gICAgLy8gZ2V0IG5leHQgY2hhcmFjdGVyXG4gICAgYnVmZmVyID0gc3RyLmNoYXJBdChpZHgrKyk7IFxuICAgIC8vIGNoYXJhY3RlciBmb3VuZCBpbiB0YWJsZT8gaW5pdGlhbGl6ZSBiaXQgc3RvcmFnZSBhbmQgYWRkIGl0cyBhc2NpaSB2YWx1ZTtcbiAgICB+YnVmZmVyICYmIChicyA9IGJjICUgNCA/IGJzICogNjQgKyBidWZmZXIgOiBidWZmZXIsXG4gICAgICAgIC8vIGFuZCBpZiBub3QgZmlyc3Qgb2YgZWFjaCA0IGNoYXJhY3RlcnMsXG4gICAgICAgIC8vIGNvbnZlcnQgdGhlIGZpcnN0IDggYml0cyB0byBvbmUgYXNjaWkgY2hhcmFjdGVyXG4gICAgICAgIGJjKysgJSA0KSA/IG91dHB1dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDI1NSAmIGJzID4+ICgtMiAqIGJjICYgNikpIDogMCkge1xuICAgICAgICAvLyB0cnkgdG8gZmluZCBjaGFyYWN0ZXIgaW4gdGFibGUgKDAtNjMsIG5vdCBmb3VuZCA9PiAtMSlcbiAgICAgICAgYnVmZmVyID0gY2hhcnMuaW5kZXhPZihidWZmZXIpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0cHV0O1xufVxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvQVBJL1dpbmRvd0Jhc2U2NC9CYXNlNjRfZW5jb2RpbmdfYW5kX2RlY29kaW5nI1RoZV9Vbmljb2RlX1Byb2JsZW1cbmZ1bmN0aW9uIGI2NERlY29kZVVuaWNvZGUoc3RyKSB7XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChBcnJheS5wcm90b3R5cGUubWFwLmNhbGwoYjY0ZGVjb2RlKHN0ciksIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHJldHVybiAnJScgKyAoJzAwJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgICB9KS5qb2luKCcnKSk7XG59XG5cbnZhciBOYkF1dGhUb2tlbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOYkF1dGhUb2tlbigpIHtcbiAgICAgICAgdGhpcy5wYXlsb2FkID0gbnVsbDtcbiAgICB9XG4gICAgTmJBdXRoVG9rZW4ucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLk5BTUU7XG4gICAgfTtcbiAgICBOYkF1dGhUb2tlbi5wcm90b3R5cGUuZ2V0UGF5bG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF5bG9hZDtcbiAgICB9O1xuICAgIHJldHVybiBOYkF1dGhUb2tlbjtcbn0oKSk7XG52YXIgTmJBdXRoVG9rZW5Ob3RGb3VuZEVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOYkF1dGhUb2tlbk5vdEZvdW5kRXJyb3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTmJBdXRoVG9rZW5Ob3RGb3VuZEVycm9yKG1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIF9uZXdUYXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yO1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzO1xuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoX3RoaXMsIF9uZXdUYXJnZXQucHJvdG90eXBlKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTmJBdXRoVG9rZW5Ob3RGb3VuZEVycm9yO1xufShFcnJvcikpO1xudmFyIE5iQXV0aElsbGVnYWxUb2tlbkVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOYkF1dGhJbGxlZ2FsVG9rZW5FcnJvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYkF1dGhJbGxlZ2FsVG9rZW5FcnJvcihtZXNzYWdlKSB7XG4gICAgICAgIHZhciBfbmV3VGFyZ2V0ID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbWVzc2FnZSkgfHwgdGhpcztcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKF90aGlzLCBfbmV3VGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE5iQXV0aElsbGVnYWxUb2tlbkVycm9yO1xufShFcnJvcikpO1xudmFyIE5iQXV0aEVtcHR5VG9rZW5FcnJvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJBdXRoRW1wdHlUb2tlbkVycm9yLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE5iQXV0aEVtcHR5VG9rZW5FcnJvcihtZXNzYWdlKSB7XG4gICAgICAgIHZhciBfbmV3VGFyZ2V0ID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbWVzc2FnZSkgfHwgdGhpcztcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKF90aGlzLCBfbmV3VGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE5iQXV0aEVtcHR5VG9rZW5FcnJvcjtcbn0oTmJBdXRoSWxsZWdhbFRva2VuRXJyb3IpKTtcbnZhciBOYkF1dGhJbGxlZ2FsSldUVG9rZW5FcnJvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJBdXRoSWxsZWdhbEpXVFRva2VuRXJyb3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTmJBdXRoSWxsZWdhbEpXVFRva2VuRXJyb3IobWVzc2FnZSkge1xuICAgICAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBOYkF1dGhJbGxlZ2FsSldUVG9rZW5FcnJvcjtcbn0oTmJBdXRoSWxsZWdhbFRva2VuRXJyb3IpKTtcbmZ1bmN0aW9uIG5iQXV0aENyZWF0ZVRva2VuKHRva2VuQ2xhc3MsIHRva2VuLCBvd25lclN0cmF0ZWd5TmFtZSwgY3JlYXRlZEF0KSB7XG4gICAgcmV0dXJuIG5ldyB0b2tlbkNsYXNzKHRva2VuLCBvd25lclN0cmF0ZWd5TmFtZSwgY3JlYXRlZEF0KTtcbn1cbmZ1bmN0aW9uIGRlY29kZUp3dFBheWxvYWQocGF5bG9hZCkge1xuICAgIGlmIChwYXlsb2FkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgTmJBdXRoRW1wdHlUb2tlbkVycm9yKCdDYW5ub3QgZXh0cmFjdCBmcm9tIGFuIGVtcHR5IHBheWxvYWQuJyk7XG4gICAgfVxuICAgIHZhciBwYXJ0cyA9IHBheWxvYWQuc3BsaXQoJy4nKTtcbiAgICBpZiAocGFydHMubGVuZ3RoICE9PSAzKSB7XG4gICAgICAgIHRocm93IG5ldyBOYkF1dGhJbGxlZ2FsSldUVG9rZW5FcnJvcihcIlRoZSBwYXlsb2FkIFwiICsgcGF5bG9hZCArIFwiIGlzIG5vdCB2YWxpZCBKV1QgcGF5bG9hZCBhbmQgbXVzdCBjb25zaXN0IG9mIHRocmVlIHBhcnRzLlwiKTtcbiAgICB9XG4gICAgdmFyIGRlY29kZWQ7XG4gICAgdHJ5IHtcbiAgICAgICAgZGVjb2RlZCA9IHVybEJhc2U2NERlY29kZShwYXJ0c1sxXSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBOYkF1dGhJbGxlZ2FsSldUVG9rZW5FcnJvcihcIlRoZSBwYXlsb2FkIFwiICsgcGF5bG9hZCArIFwiIGlzIG5vdCB2YWxpZCBKV1QgcGF5bG9hZCBhbmQgY2Fubm90IGJlIHBhcnNlZC5cIik7XG4gICAgfVxuICAgIGlmICghZGVjb2RlZCkge1xuICAgICAgICB0aHJvdyBuZXcgTmJBdXRoSWxsZWdhbEpXVFRva2VuRXJyb3IoXCJUaGUgcGF5bG9hZCBcIiArIHBheWxvYWQgKyBcIiBpcyBub3QgdmFsaWQgSldUIHBheWxvYWQgYW5kIGNhbm5vdCBiZSBkZWNvZGVkLlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7XG59XG4vKipcbiAqIFdyYXBwZXIgZm9yIHNpbXBsZSAodGV4dCkgdG9rZW5cbiAqL1xudmFyIE5iQXV0aFNpbXBsZVRva2VuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOYkF1dGhTaW1wbGVUb2tlbiwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYkF1dGhTaW1wbGVUb2tlbih0b2tlbiwgb3duZXJTdHJhdGVneU5hbWUsIGNyZWF0ZWRBdCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy50b2tlbiA9IHRva2VuO1xuICAgICAgICBfdGhpcy5vd25lclN0cmF0ZWd5TmFtZSA9IG93bmVyU3RyYXRlZ3lOYW1lO1xuICAgICAgICBfdGhpcy5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBfdGhpcy5wYXJzZVBheWxvYWQoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBOYkF1dGhUb2tlbk5vdEZvdW5kRXJyb3IpKSB7XG4gICAgICAgICAgICAgICAgLy8gdG9rZW4gaXMgcHJlc2VudCBidXQgaGFzIGdvdCBhIHByb2JsZW0sIGluY2x1ZGluZyBpbGxlZ2FsXG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIF90aGlzLmNyZWF0ZWRBdCA9IF90aGlzLnByZXBhcmVDcmVhdGVkQXQoY3JlYXRlZEF0KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBOYkF1dGhTaW1wbGVUb2tlbi5wcm90b3R5cGUucGFyc2VQYXlsb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBheWxvYWQgPSBudWxsO1xuICAgIH07XG4gICAgTmJBdXRoU2ltcGxlVG9rZW4ucHJvdG90eXBlLnByZXBhcmVDcmVhdGVkQXQgPSBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICByZXR1cm4gZGF0ZSA/IGRhdGUgOiBuZXcgRGF0ZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdG9rZW4ncyBjcmVhdGlvbiBkYXRlXG4gICAgICogQHJldHVybnMge0RhdGV9XG4gICAgICovXG4gICAgTmJBdXRoU2ltcGxlVG9rZW4ucHJvdG90eXBlLmdldENyZWF0ZWRBdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlZEF0O1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdG9rZW4gdmFsdWVcbiAgICAgKiBAcmV0dXJucyBzdHJpbmdcbiAgICAgKi9cbiAgICBOYkF1dGhTaW1wbGVUb2tlbi5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuO1xuICAgIH07XG4gICAgTmJBdXRoU2ltcGxlVG9rZW4ucHJvdG90eXBlLmdldE93bmVyU3RyYXRlZ3lOYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vd25lclN0cmF0ZWd5TmFtZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIElzIG5vbiBlbXB0eSBhbmQgdmFsaWRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBOYkF1dGhTaW1wbGVUb2tlbi5wcm90b3R5cGUuaXNWYWxpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5nZXRWYWx1ZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgdmFsdWUgYW5kIGNvbnZlcnQgdG8gc3RyaW5nLCBpZiB2YWx1ZSBpcyBub3QgdmFsaWQgcmV0dXJuIGVtcHR5IHN0cmluZ1xuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgTmJBdXRoU2ltcGxlVG9rZW4ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLnRva2VuID8gdGhpcy50b2tlbiA6ICcnO1xuICAgIH07XG4gICAgTmJBdXRoU2ltcGxlVG9rZW4uTkFNRSA9ICduYjphdXRoOnNpbXBsZTp0b2tlbic7XG4gICAgcmV0dXJuIE5iQXV0aFNpbXBsZVRva2VuO1xufShOYkF1dGhUb2tlbikpO1xuLyoqXG4gKiBXcmFwcGVyIGZvciBKV1QgdG9rZW4gd2l0aCBhZGRpdGlvbmFsIG1ldGhvZHMuXG4gKi9cbnZhciBOYkF1dGhKV1RUb2tlbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJBdXRoSldUVG9rZW4sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTmJBdXRoSldUVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogZm9yIEpXVCB0b2tlbiwgdGhlIGlhdCAoaXNzdWVkIGF0KSBmaWVsZCBvZiB0aGUgdG9rZW4gcGF5bG9hZCBjb250YWlucyB0aGUgY3JlYXRpb24gRGF0ZVxuICAgICAqL1xuICAgIE5iQXV0aEpXVFRva2VuLnByb3RvdHlwZS5wcmVwYXJlQ3JlYXRlZEF0ID0gZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAgICAgdmFyIGRlY29kZWQgPSB0aGlzLmdldFBheWxvYWQoKTtcbiAgICAgICAgcmV0dXJuIGRlY29kZWQgJiYgZGVjb2RlZC5pYXQgPyBuZXcgRGF0ZShOdW1iZXIoZGVjb2RlZC5pYXQpICogMTAwMCkgOiBfc3VwZXIucHJvdG90eXBlLnByZXBhcmVDcmVhdGVkQXQuY2FsbCh0aGlzLCBkYXRlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJldHVybnMgcGF5bG9hZCBvYmplY3RcbiAgICAgKiBAcmV0dXJucyBhbnlcbiAgICAgKi9cbiAgICBOYkF1dGhKV1RUb2tlbi5wcm90b3R5cGUucGFyc2VQYXlsb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMudG9rZW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBOYkF1dGhUb2tlbk5vdEZvdW5kRXJyb3IoJ1Rva2VuIG5vdCBmb3VuZC4gJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wYXlsb2FkID0gZGVjb2RlSnd0UGF5bG9hZCh0aGlzLnRva2VuKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJldHVybnMgZXhwaXJhdGlvbiBkYXRlXG4gICAgICogQHJldHVybnMgRGF0ZVxuICAgICAqL1xuICAgIE5iQXV0aEpXVFRva2VuLnByb3RvdHlwZS5nZXRUb2tlbkV4cERhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBkZWNvZGVkID0gdGhpcy5nZXRQYXlsb2FkKCk7XG4gICAgICAgIGlmIChkZWNvZGVkICYmICFkZWNvZGVkLmhhc093blByb3BlcnR5KCdleHAnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgwKTtcbiAgICAgICAgZGF0ZS5zZXRVVENTZWNvbmRzKGRlY29kZWQuZXhwKTsgLy8gJ2NhdXNlIGp3dCB0b2tlbiBhcmUgc2V0IGluIHNlY29uZHNcbiAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBJcyBkYXRhIGV4cGlyZWRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBOYkF1dGhKV1RUb2tlbi5wcm90b3R5cGUuaXNWYWxpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuaXNWYWxpZC5jYWxsKHRoaXMpICYmICghdGhpcy5nZXRUb2tlbkV4cERhdGUoKSB8fCBuZXcgRGF0ZSgpIDwgdGhpcy5nZXRUb2tlbkV4cERhdGUoKSk7XG4gICAgfTtcbiAgICBOYkF1dGhKV1RUb2tlbi5OQU1FID0gJ25iOmF1dGg6and0OnRva2VuJztcbiAgICByZXR1cm4gTmJBdXRoSldUVG9rZW47XG59KE5iQXV0aFNpbXBsZVRva2VuKSk7XG52YXIgcHJlcGFyZU9BdXRoMlRva2VuID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufTtcbnZhciDJtTAgPSBwcmVwYXJlT0F1dGgyVG9rZW47XG4vKipcbiAqIFdyYXBwZXIgZm9yIE9BdXRoMiB0b2tlbiB3aG9zZSBhY2Nlc3NfdG9rZW4gaXMgYSBKV1QgVG9rZW5cbiAqL1xudmFyIE5iQXV0aE9BdXRoMlRva2VuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOYkF1dGhPQXV0aDJUb2tlbiwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYkF1dGhPQXV0aDJUb2tlbihkYXRhLCBvd25lclN0cmF0ZWd5TmFtZSwgY3JlYXRlZEF0KSB7XG4gICAgICAgIGlmIChkYXRhID09PSB2b2lkIDApIHsgZGF0YSA9IHt9OyB9XG4gICAgICAgIC8vIHdlIG1heSBnZXQgaXQgYXMgc3RyaW5nIHdoZW4gcmV0cmlldmluZyBmcm9tIGEgc3RvcmFnZVxuICAgICAgICByZXR1cm4gX3N1cGVyLmNhbGwodGhpcywgcHJlcGFyZU9BdXRoMlRva2VuKGRhdGEpLCBvd25lclN0cmF0ZWd5TmFtZSwgY3JlYXRlZEF0KSB8fCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0b2tlbiB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHN0cmluZ1xuICAgICAqL1xuICAgIE5iQXV0aE9BdXRoMlRva2VuLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW4uYWNjZXNzX3Rva2VuO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgcmVmcmVzaCB0b2tlblxuICAgICAqIEByZXR1cm5zIHN0cmluZ1xuICAgICAqL1xuICAgIE5iQXV0aE9BdXRoMlRva2VuLnByb3RvdHlwZS5nZXRSZWZyZXNoVG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuLnJlZnJlc2hfdG9rZW47XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiAgcHV0IHJlZnJlc2hUb2tlbiBpbiB0aGUgdG9rZW4gcGF5bG9hZFxuICAgICAgKiBAcGFyYW0gcmVmcmVzaFRva2VuXG4gICAgICovXG4gICAgTmJBdXRoT0F1dGgyVG9rZW4ucHJvdG90eXBlLnNldFJlZnJlc2hUb2tlbiA9IGZ1bmN0aW9uIChyZWZyZXNoVG9rZW4pIHtcbiAgICAgICAgdGhpcy50b2tlbi5yZWZyZXNoX3Rva2VuID0gcmVmcmVzaFRva2VuO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUGFyc2VzIHRva2VuIHBheWxvYWRcbiAgICAgKiBAcmV0dXJucyBhbnlcbiAgICAgKi9cbiAgICBOYkF1dGhPQXV0aDJUb2tlbi5wcm90b3R5cGUucGFyc2VQYXlsb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMudG9rZW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBOYkF1dGhUb2tlbk5vdEZvdW5kRXJyb3IoJ1Rva2VuIG5vdCBmb3VuZC4nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LmtleXModGhpcy50b2tlbikubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5iQXV0aEVtcHR5VG9rZW5FcnJvcignQ2Fubm90IGV4dHJhY3QgcGF5bG9hZCBmcm9tIGFuIGVtcHR5IHRva2VuLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucGF5bG9hZCA9IHRoaXMudG9rZW47XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB0b2tlbiB0eXBlXG4gICAgICogQHJldHVybnMgc3RyaW5nXG4gICAgICovXG4gICAgTmJBdXRoT0F1dGgyVG9rZW4ucHJvdG90eXBlLmdldFR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuLnRva2VuX3R5cGU7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBJcyBkYXRhIGV4cGlyZWRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBOYkF1dGhPQXV0aDJUb2tlbi5wcm90b3R5cGUuaXNWYWxpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuaXNWYWxpZC5jYWxsKHRoaXMpICYmICghdGhpcy5nZXRUb2tlbkV4cERhdGUoKSB8fCBuZXcgRGF0ZSgpIDwgdGhpcy5nZXRUb2tlbkV4cERhdGUoKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGV4cGlyYXRpb24gZGF0ZVxuICAgICAqIEByZXR1cm5zIERhdGVcbiAgICAgKi9cbiAgICBOYkF1dGhPQXV0aDJUb2tlbi5wcm90b3R5cGUuZ2V0VG9rZW5FeHBEYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMudG9rZW4uaGFzT3duUHJvcGVydHkoJ2V4cGlyZXNfaW4nKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMuY3JlYXRlZEF0LmdldFRpbWUoKSArIE51bWJlcih0aGlzLnRva2VuLmV4cGlyZXNfaW4pICogMTAwMCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBDb252ZXJ0IHRvIHN0cmluZ1xuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgTmJBdXRoT0F1dGgyVG9rZW4ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy50b2tlbik7XG4gICAgfTtcbiAgICBOYkF1dGhPQXV0aDJUb2tlbi5OQU1FID0gJ25iOmF1dGg6b2F1dGgyOnRva2VuJztcbiAgICByZXR1cm4gTmJBdXRoT0F1dGgyVG9rZW47XG59KE5iQXV0aFNpbXBsZVRva2VuKSk7XG4vKipcbiAqIFdyYXBwZXIgZm9yIE9BdXRoMiB0b2tlbiBlbWJlZGRpbmcgSldUIHRva2Vuc1xuICovXG52YXIgTmJBdXRoT0F1dGgySldUVG9rZW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE5iQXV0aE9BdXRoMkpXVFRva2VuLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE5iQXV0aE9BdXRoMkpXVFRva2VuKCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLnByb3RvdHlwZS5wYXJzZVBheWxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucGFyc2VQYXlsb2FkLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMucGFyc2VBY2Nlc3NUb2tlblBheWxvYWQoKTtcbiAgICB9O1xuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLnByb3RvdHlwZS5wYXJzZUFjY2Vzc1Rva2VuUGF5bG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgICAgICBpZiAoIWFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTmJBdXRoVG9rZW5Ob3RGb3VuZEVycm9yKCdhY2Nlc3NfdG9rZW4ga2V5IG5vdCBmb3VuZC4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZCA9IGRlY29kZUp3dFBheWxvYWQoYWNjZXNzVG9rZW4pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhY2Nlc3MgdG9rZW4gcGF5bG9hZFxuICAgICAqIEByZXR1cm5zIGFueVxuICAgICAqL1xuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLnByb3RvdHlwZS5nZXRBY2Nlc3NUb2tlblBheWxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGZvciBPYXV0aDIgSldUIHRva2VuLCB0aGUgaWF0IChpc3N1ZWQgYXQpIGZpZWxkIG9mIHRoZSBhY2Nlc3NfdG9rZW4gcGF5bG9hZFxuICAgICAqL1xuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLnByb3RvdHlwZS5wcmVwYXJlQ3JlYXRlZEF0ID0gZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAgICAgdmFyIHBheWxvYWQgPSB0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZDtcbiAgICAgICAgcmV0dXJuIHBheWxvYWQgJiYgcGF5bG9hZC5pYXQgPyBuZXcgRGF0ZShOdW1iZXIocGF5bG9hZC5pYXQpICogMTAwMCkgOiBfc3VwZXIucHJvdG90eXBlLnByZXBhcmVDcmVhdGVkQXQuY2FsbCh0aGlzLCBkYXRlKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIElzIHRva2VuIHZhbGlkXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgTmJBdXRoT0F1dGgySldUVG9rZW4ucHJvdG90eXBlLmlzVmFsaWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZCAmJiBfc3VwZXIucHJvdG90eXBlLmlzVmFsaWQuY2FsbCh0aGlzKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJldHVybnMgZXhwaXJhdGlvbiBkYXRlIDpcbiAgICAgKiAtIGV4cCBpZiBzZXQsXG4gICAgICogLSBzdXBlci5nZXRFeHBEYXRlKCkgb3RoZXJ3aXNlXG4gICAgICogQHJldHVybnMgRGF0ZVxuICAgICAqL1xuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLnByb3RvdHlwZS5nZXRUb2tlbkV4cERhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZCAmJiB0aGlzLmFjY2Vzc1Rva2VuUGF5bG9hZC5oYXNPd25Qcm9wZXJ0eSgnZXhwJykpIHtcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoMCk7XG4gICAgICAgICAgICBkYXRlLnNldFVUQ1NlY29uZHModGhpcy5hY2Nlc3NUb2tlblBheWxvYWQuZXhwKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuZ2V0VG9rZW5FeHBEYXRlLmNhbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE5iQXV0aE9BdXRoMkpXVFRva2VuLk5BTUUgPSAnbmI6YXV0aDpvYXV0aDI6and0OnRva2VuJztcbiAgICByZXR1cm4gTmJBdXRoT0F1dGgySldUVG9rZW47XG59KE5iQXV0aE9BdXRoMlRva2VuKSk7XG5cbnZhciBOQl9BVVRIX0ZBTExCQUNLX1RPS0VOID0gbmV3IEluamVjdGlvblRva2VuKCdOZWJ1bGFyIEF1dGggT3B0aW9ucycpO1xuLyoqXG4gKiBDcmVhdGVzIGEgdG9rZW4gcGFyY2VsIHdoaWNoIGNvdWxkIGJlIHN0b3JlZC9yZXN0b3JlZFxuICovXG52YXIgTmJBdXRoVG9rZW5QYXJjZWxlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOYkF1dGhUb2tlblBhcmNlbGVyKGZhbGxiYWNrQ2xhc3MsIHRva2VuQ2xhc3Nlcykge1xuICAgICAgICB0aGlzLmZhbGxiYWNrQ2xhc3MgPSBmYWxsYmFja0NsYXNzO1xuICAgICAgICB0aGlzLnRva2VuQ2xhc3NlcyA9IHRva2VuQ2xhc3NlcztcbiAgICB9XG4gICAgTmJBdXRoVG9rZW5QYXJjZWxlci5wcm90b3R5cGUud3JhcCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgbmFtZTogdG9rZW4uZ2V0TmFtZSgpLFxuICAgICAgICAgICAgb3duZXJTdHJhdGVneU5hbWU6IHRva2VuLmdldE93bmVyU3RyYXRlZ3lOYW1lKCksXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHRva2VuLmdldENyZWF0ZWRBdCgpLmdldFRpbWUoKSxcbiAgICAgICAgICAgIHZhbHVlOiB0b2tlbi50b1N0cmluZygpLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE5iQXV0aFRva2VuUGFyY2VsZXIucHJvdG90eXBlLnVud3JhcCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB2YXIgdG9rZW5DbGFzcyA9IHRoaXMuZmFsbGJhY2tDbGFzcztcbiAgICAgICAgdmFyIHRva2VuVmFsdWUgPSAnJztcbiAgICAgICAgdmFyIHRva2VuT3duZXJTdHJhdGVneU5hbWUgPSAnJztcbiAgICAgICAgdmFyIHRva2VuQ3JlYXRlZEF0ID0gbnVsbDtcbiAgICAgICAgdmFyIHRva2VuUGFjayA9IHRoaXMucGFyc2VUb2tlblBhY2sodmFsdWUpO1xuICAgICAgICBpZiAodG9rZW5QYWNrKSB7XG4gICAgICAgICAgICB0b2tlbkNsYXNzID0gdGhpcy5nZXRDbGFzc0J5TmFtZSh0b2tlblBhY2submFtZSkgfHwgdGhpcy5mYWxsYmFja0NsYXNzO1xuICAgICAgICAgICAgdG9rZW5WYWx1ZSA9IHRva2VuUGFjay52YWx1ZTtcbiAgICAgICAgICAgIHRva2VuT3duZXJTdHJhdGVneU5hbWUgPSB0b2tlblBhY2sub3duZXJTdHJhdGVneU5hbWU7XG4gICAgICAgICAgICB0b2tlbkNyZWF0ZWRBdCA9IG5ldyBEYXRlKE51bWJlcih0b2tlblBhY2suY3JlYXRlZEF0KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5iQXV0aENyZWF0ZVRva2VuKHRva2VuQ2xhc3MsIHRva2VuVmFsdWUsIHRva2VuT3duZXJTdHJhdGVneU5hbWUsIHRva2VuQ3JlYXRlZEF0KTtcbiAgICB9O1xuICAgIC8vIFRPRE86IHRoaXMgY291bGQgYmUgbW92ZWQgdG8gYSBzZXBhcmF0ZSB0b2tlbiByZWdpc3RyeVxuICAgIE5iQXV0aFRva2VuUGFyY2VsZXIucHJvdG90eXBlLmdldENsYXNzQnlOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5DbGFzc2VzLmZpbmQoZnVuY3Rpb24gKHRva2VuQ2xhc3MpIHsgcmV0dXJuIHRva2VuQ2xhc3MuTkFNRSA9PT0gbmFtZTsgfSk7XG4gICAgfTtcbiAgICBOYkF1dGhUb2tlblBhcmNlbGVyLnByb3RvdHlwZS5wYXJzZVRva2VuUGFjayA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICBOYkF1dGhUb2tlblBhcmNlbGVyID0gX19kZWNvcmF0ZShbXG4gICAgICAgIEluamVjdGFibGUoKSxcbiAgICAgICAgX19wYXJhbSgwLCBJbmplY3QoTkJfQVVUSF9GQUxMQkFDS19UT0tFTikpLFxuICAgICAgICBfX3BhcmFtKDEsIEluamVjdChOQl9BVVRIX1RPS0VOUykpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW09iamVjdCwgQXJyYXldKVxuICAgIF0sIE5iQXV0aFRva2VuUGFyY2VsZXIpO1xuICAgIHJldHVybiBOYkF1dGhUb2tlblBhcmNlbGVyO1xufSgpKTtcblxudmFyIE5iVG9rZW5TdG9yYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iVG9rZW5TdG9yYWdlKCkge1xuICAgIH1cbiAgICByZXR1cm4gTmJUb2tlblN0b3JhZ2U7XG59KCkpO1xuLyoqXG4gKiBTZXJ2aWNlIHRoYXQgdXNlcyBicm93c2VyIGxvY2FsU3RvcmFnZSBhcyBhIHN0b3JhZ2UuXG4gKlxuICogVGhlIHRva2VuIHN0b3JhZ2UgaXMgcHJvdmlkZWQgaW50byBhdXRoIG1vZHVsZSB0aGUgZm9sbG93aW5nIHdheTpcbiAqIGBgYHRzXG4gKiB7IHByb3ZpZGU6IE5iVG9rZW5TdG9yYWdlLCB1c2VDbGFzczogTmJUb2tlbkxvY2FsU3RvcmFnZSB9LFxuICogYGBgXG4gKlxuICogSWYgeW91IG5lZWQgdG8gY2hhbmdlIHRoZSBzdG9yYWdlIGJlaGF2aW91ciBvciBwcm92aWRlIHlvdXIgb3duIC0ganVzdCBleHRlbmQgeW91ciBjbGFzcyBmcm9tIGJhc2ljIGBOYlRva2VuU3RvcmFnZWBcbiAqIG9yIGBOYlRva2VuTG9jYWxTdG9yYWdlYCBhbmQgcHJvdmlkZSBpbiB5b3VyIGBhcHAubW9kdWxlYDpcbiAqIGBgYHRzXG4gKiB7IHByb3ZpZGU6IE5iVG9rZW5TdG9yYWdlLCB1c2VDbGFzczogTmJUb2tlbkN1c3RvbVN0b3JhZ2UgfSxcbiAqIGBgYFxuICpcbiAqL1xudmFyIE5iVG9rZW5Mb2NhbFN0b3JhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE5iVG9rZW5Mb2NhbFN0b3JhZ2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTmJUb2tlbkxvY2FsU3RvcmFnZShwYXJjZWxlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5wYXJjZWxlciA9IHBhcmNlbGVyO1xuICAgICAgICBfdGhpcy5rZXkgPSAnYXV0aF9hcHBfdG9rZW4nO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdG9rZW4gZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICAgKiBAcmV0dXJucyB7TmJBdXRoVG9rZW59XG4gICAgICovXG4gICAgTmJUb2tlbkxvY2FsU3RvcmFnZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmF3ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJjZWxlci51bndyYXAocmF3KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFNldHMgdG9rZW4gdG8gbG9jYWxTdG9yYWdlXG4gICAgICogQHBhcmFtIHtOYkF1dGhUb2tlbn0gdG9rZW5cbiAgICAgKi9cbiAgICBOYlRva2VuTG9jYWxTdG9yYWdlLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgdmFyIHJhdyA9IHRoaXMucGFyY2VsZXIud3JhcCh0b2tlbik7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMua2V5LCByYXcpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRva2VuIGZyb20gbG9jYWxTdG9yYWdlXG4gICAgICovXG4gICAgTmJUb2tlbkxvY2FsU3RvcmFnZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMua2V5KTtcbiAgICB9O1xuICAgIE5iVG9rZW5Mb2NhbFN0b3JhZ2UgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5qZWN0YWJsZSgpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05iQXV0aFRva2VuUGFyY2VsZXJdKVxuICAgIF0sIE5iVG9rZW5Mb2NhbFN0b3JhZ2UpO1xuICAgIHJldHVybiBOYlRva2VuTG9jYWxTdG9yYWdlO1xufShOYlRva2VuU3RvcmFnZSkpO1xuXG4vKipcbiAqIFNlcnZpY2UgdGhhdCBhbGxvd3MgeW91IHRvIG1hbmFnZSBhdXRoZW50aWNhdGlvbiB0b2tlbiAtIGdldCwgc2V0LCBjbGVhciBhbmQgYWxzbyBsaXN0ZW4gdG8gdG9rZW4gY2hhbmdlcyBvdmVyIHRpbWUuXG4gKi9cbnZhciBOYlRva2VuU2VydmljZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOYlRva2VuU2VydmljZSh0b2tlblN0b3JhZ2UpIHtcbiAgICAgICAgdGhpcy50b2tlblN0b3JhZ2UgPSB0b2tlblN0b3JhZ2U7XG4gICAgICAgIHRoaXMudG9rZW4kID0gbmV3IEJlaGF2aW9yU3ViamVjdChudWxsKTtcbiAgICAgICAgdGhpcy5wdWJsaXNoU3RvcmVkVG9rZW4oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHVibGlzaGVzIHRva2VuIHdoZW4gaXQgY2hhbmdlcy5cbiAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZTxOYkF1dGhUb2tlbj59XG4gICAgICovXG4gICAgTmJUb2tlblNlcnZpY2UucHJvdG90eXBlLnRva2VuQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b2tlbiRcbiAgICAgICAgICAgIC5waXBlKGZpbHRlcihmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuICEhdmFsdWU7IH0pLCBzaGFyZSgpKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFNldHMgYSB0b2tlbiBpbnRvIHRoZSBzdG9yYWdlLiBUaGlzIG1ldGhvZCBpcyB1c2VkIGJ5IHRoZSBOYkF1dGhTZXJ2aWNlIGF1dG9tYXRpY2FsbHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05iQXV0aFRva2VufSB0b2tlblxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPGFueT59XG4gICAgICovXG4gICAgTmJUb2tlblNlcnZpY2UucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICB0aGlzLnRva2VuU3RvcmFnZS5zZXQodG9rZW4pO1xuICAgICAgICB0aGlzLnB1Ymxpc2hTdG9yZWRUb2tlbigpO1xuICAgICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIG9ic2VydmFibGUgb2YgY3VycmVudCB0b2tlblxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPE5iQXV0aFRva2VuPn1cbiAgICAgKi9cbiAgICBOYlRva2VuU2VydmljZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLnRva2VuU3RvcmFnZS5nZXQoKTtcbiAgICAgICAgcmV0dXJuIG9mKHRva2VuKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHRva2VuIGFuZCBwdWJsaXNoZWQgdG9rZW4gdmFsdWVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPGFueT59XG4gICAgICovXG4gICAgTmJUb2tlblNlcnZpY2UucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRva2VuU3RvcmFnZS5jbGVhcigpO1xuICAgICAgICB0aGlzLnB1Ymxpc2hTdG9yZWRUb2tlbigpO1xuICAgICAgICByZXR1cm4gb2YobnVsbCk7XG4gICAgfTtcbiAgICBOYlRva2VuU2VydmljZS5wcm90b3R5cGUucHVibGlzaFN0b3JlZFRva2VuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnRva2VuJC5uZXh0KHRoaXMudG9rZW5TdG9yYWdlLmdldCgpKTtcbiAgICB9O1xuICAgIE5iVG9rZW5TZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgICAgIEluamVjdGFibGUoKSxcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOYlRva2VuU3RvcmFnZV0pXG4gICAgXSwgTmJUb2tlblNlcnZpY2UpO1xuICAgIHJldHVybiBOYlRva2VuU2VydmljZTtcbn0oKSk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBBa3Zlby4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi9cbi8qKlxuICogQ29tbW9uIGF1dGhlbnRpY2F0aW9uIHNlcnZpY2UuXG4gKiBTaG91bGQgYmUgdXNlZCB0byBhcyBhbiBpbnRlcmxheWVyIGJldHdlZW4gVUkgQ29tcG9uZW50cyBhbmQgQXV0aCBTdHJhdGVneS5cbiAqL1xudmFyIE5iQXV0aFNlcnZpY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmJBdXRoU2VydmljZSh0b2tlblNlcnZpY2UsIHN0cmF0ZWdpZXMpIHtcbiAgICAgICAgdGhpcy50b2tlblNlcnZpY2UgPSB0b2tlblNlcnZpY2U7XG4gICAgICAgIHRoaXMuc3RyYXRlZ2llcyA9IHN0cmF0ZWdpZXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBjdXJyZW50IGF1dGhlbnRpY2F0ZWQgdG9rZW4gc3RvcmVkXG4gICAgICogQHJldHVybnMge09ic2VydmFibGU8YW55Pn1cbiAgICAgKi9cbiAgICBOYkF1dGhTZXJ2aWNlLnByb3RvdHlwZS5nZXRUb2tlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5TZXJ2aWNlLmdldCgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIGF1dGggdG9rZW4gaXMgcHJlc2VudCBpbiB0aGUgdG9rZW4gc3RvcmFnZVxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPGJvb2xlYW4+fVxuICAgICAqL1xuICAgIE5iQXV0aFNlcnZpY2UucHJvdG90eXBlLmlzQXV0aGVudGljYXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VG9rZW4oKVxuICAgICAgICAgICAgLnBpcGUobWFwKGZ1bmN0aW9uICh0b2tlbikgeyByZXR1cm4gdG9rZW4uaXNWYWxpZCgpOyB9KSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdmFsaWQgYXV0aCB0b2tlbiBpcyBwcmVzZW50IGluIHRoZSB0b2tlbiBzdG9yYWdlLlxuICAgICAqIElmIG5vdCwgY2FsbHMgdGhlIHN0cmF0ZWd5IHJlZnJlc2hUb2tlbiwgYW5kIHJldHVybnMgaXNBdXRoZW50aWNhdGVkKCkgaWYgc3VjY2VzcywgZmFsc2Ugb3RoZXJ3aXNlXG4gICAgICogQHJldHVybnMge09ic2VydmFibGU8Ym9vbGVhbj59XG4gICAgICovXG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUuaXNBdXRoZW50aWNhdGVkT3JSZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRUb2tlbigpXG4gICAgICAgICAgICAucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICAgICBpZiAodG9rZW4uZ2V0VmFsdWUoKSAmJiAhdG9rZW4uaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlZnJlc2hUb2tlbih0b2tlbi5nZXRPd25lclN0cmF0ZWd5TmFtZSgpLCB0b2tlbilcbiAgICAgICAgICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5pc1N1Y2Nlc3MoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmlzQXV0aGVudGljYXRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBvZih0b2tlbi5pc1ZhbGlkKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRva2VucyBzdHJlYW1cbiAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZTxOYkF1dGhTaW1wbGVUb2tlbj59XG4gICAgICovXG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUub25Ub2tlbkNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9rZW5TZXJ2aWNlLnRva2VuQ2hhbmdlKCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGF1dGhlbnRpY2F0aW9uIHN0YXR1cyBzdHJlYW1cbiAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZTxib29sZWFuPn1cbiAgICAgKi9cbiAgICBOYkF1dGhTZXJ2aWNlLnByb3RvdHlwZS5vbkF1dGhlbnRpY2F0aW9uQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vblRva2VuQ2hhbmdlKClcbiAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAodG9rZW4pIHsgcmV0dXJuIHRva2VuLmlzVmFsaWQoKTsgfSkpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQXV0aGVudGljYXRlcyB3aXRoIHRoZSBzZWxlY3RlZCBzdHJhdGVneVxuICAgICAqIFN0b3JlcyByZWNlaXZlZCB0b2tlbiBpbiB0aGUgdG9rZW4gc3RvcmFnZVxuICAgICAqXG4gICAgICogRXhhbXBsZTpcbiAgICAgKiBhdXRoZW50aWNhdGUoJ2VtYWlsJywge2VtYWlsOiAnZW1haWxAZXhhbXBsZS5jb20nLCBwYXNzd29yZDogJ3Rlc3QnfSlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzdHJhdGVneU5hbWVcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPE5iQXV0aFJlc3VsdD59XG4gICAgICovXG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUuYXV0aGVudGljYXRlID0gZnVuY3Rpb24gKHN0cmF0ZWd5TmFtZSwgZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJhdGVneShzdHJhdGVneU5hbWUpLmF1dGhlbnRpY2F0ZShkYXRhKVxuICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9jZXNzUmVzdWx0VG9rZW4ocmVzdWx0KTtcbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIHdpdGggdGhlIHNlbGVjdGVkIHN0cmF0ZWd5XG4gICAgICogU3RvcmVzIHJlY2VpdmVkIHRva2VuIGluIHRoZSB0b2tlbiBzdG9yYWdlXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIHJlZ2lzdGVyKCdlbWFpbCcsIHtlbWFpbDogJ2VtYWlsQGV4YW1wbGUuY29tJywgbmFtZTogJ1NvbWUgTmFtZScsIHBhc3N3b3JkOiAndGVzdCd9KVxuICAgICAqXG4gICAgICogQHBhcmFtIHN0cmF0ZWd5TmFtZVxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge09ic2VydmFibGU8TmJBdXRoUmVzdWx0Pn1cbiAgICAgKi9cbiAgICBOYkF1dGhTZXJ2aWNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChzdHJhdGVneU5hbWUsIGRhdGEpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RyYXRlZ3koc3RyYXRlZ3lOYW1lKS5yZWdpc3RlcihkYXRhKVxuICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5wcm9jZXNzUmVzdWx0VG9rZW4ocmVzdWx0KTtcbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogU2lnbiBvdXRzIHdpdGggdGhlIHNlbGVjdGVkIHN0cmF0ZWd5XG4gICAgICogUmVtb3ZlcyB0b2tlbiBmcm9tIHRoZSB0b2tlbiBzdG9yYWdlXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIGxvZ291dCgnZW1haWwnKVxuICAgICAqXG4gICAgICogQHBhcmFtIHN0cmF0ZWd5TmFtZVxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPE5iQXV0aFJlc3VsdD59XG4gICAgICovXG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUubG9nb3V0ID0gZnVuY3Rpb24gKHN0cmF0ZWd5TmFtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTdHJhdGVneShzdHJhdGVneU5hbWUpLmxvZ291dCgpXG4gICAgICAgICAgICAucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5pc1N1Y2Nlc3MoKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLnRva2VuU2VydmljZS5jbGVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAoKSB7IHJldHVybiByZXN1bHQ7IH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvZihyZXN1bHQpO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBTZW5kcyBmb3Jnb3QgcGFzc3dvcmQgcmVxdWVzdCB0byB0aGUgc2VsZWN0ZWQgc3RyYXRlZ3lcbiAgICAgKlxuICAgICAqIEV4YW1wbGU6XG4gICAgICogcmVxdWVzdFBhc3N3b3JkKCdlbWFpbCcsIHtlbWFpbDogJ2VtYWlsQGV4YW1wbGUuY29tJ30pXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc3RyYXRlZ3lOYW1lXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7T2JzZXJ2YWJsZTxOYkF1dGhSZXN1bHQ+fVxuICAgICAqL1xuICAgIE5iQXV0aFNlcnZpY2UucHJvdG90eXBlLnJlcXVlc3RQYXNzd29yZCA9IGZ1bmN0aW9uIChzdHJhdGVneU5hbWUsIGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RyYXRlZ3koc3RyYXRlZ3lOYW1lKS5yZXF1ZXN0UGFzc3dvcmQoZGF0YSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBUcmllcyB0byByZXNldCBwYXNzd29yZCB3aXRoIHRoZSBzZWxlY3RlZCBzdHJhdGVneVxuICAgICAqXG4gICAgICogRXhhbXBsZTpcbiAgICAgKiByZXNldFBhc3N3b3JkKCdlbWFpbCcsIHtuZXdQYXNzd29yZDogJ3Rlc3QnfSlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzdHJhdGVneU5hbWVcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPE5iQXV0aFJlc3VsdD59XG4gICAgICovXG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUucmVzZXRQYXNzd29yZCA9IGZ1bmN0aW9uIChzdHJhdGVneU5hbWUsIGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RyYXRlZ3koc3RyYXRlZ3lOYW1lKS5yZXNldFBhc3N3b3JkKGRhdGEpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogU2VuZHMgYSByZWZyZXNoIHRva2VuIHJlcXVlc3RcbiAgICAgKiBTdG9yZXMgcmVjZWl2ZWQgdG9rZW4gaW4gdGhlIHRva2VuIHN0b3JhZ2VcbiAgICAgKlxuICAgICAqIEV4YW1wbGU6XG4gICAgICogcmVmcmVzaFRva2VuKCdlbWFpbCcsIHt0b2tlbjogdG9rZW59KVxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmF0ZWd5TmFtZVxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge09ic2VydmFibGU8TmJBdXRoUmVzdWx0Pn1cbiAgICAgKi9cbiAgICBOYkF1dGhTZXJ2aWNlLnByb3RvdHlwZS5yZWZyZXNoVG9rZW4gPSBmdW5jdGlvbiAoc3RyYXRlZ3lOYW1lLCBkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0cmF0ZWd5KHN0cmF0ZWd5TmFtZSkucmVmcmVzaFRva2VuKGRhdGEpXG4gICAgICAgICAgICAucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLnByb2Nlc3NSZXN1bHRUb2tlbihyZXN1bHQpO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBHZXQgcmVnaXN0ZXJlZCBzdHJhdGVneSBieSBuYW1lXG4gICAgICpcbiAgICAgKiBFeGFtcGxlOlxuICAgICAqIGdldFN0cmF0ZWd5KCdlbWFpbCcpXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvdmlkZXJcbiAgICAgKiBAcmV0dXJucyB7TmJBYnN0cmFjdEF1dGhQcm92aWRlcn1cbiAgICAgKi9cbiAgICBOYkF1dGhTZXJ2aWNlLnByb3RvdHlwZS5nZXRTdHJhdGVneSA9IGZ1bmN0aW9uIChzdHJhdGVneU5hbWUpIHtcbiAgICAgICAgdmFyIGZvdW5kID0gdGhpcy5zdHJhdGVnaWVzLmZpbmQoZnVuY3Rpb24gKHN0cmF0ZWd5KSB7IHJldHVybiBzdHJhdGVneS5nZXROYW1lKCkgPT09IHN0cmF0ZWd5TmFtZTsgfSk7XG4gICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGVyZSBpcyBubyBBdXRoIFN0cmF0ZWd5IHJlZ2lzdGVyZWQgdW5kZXIgJ1wiICsgc3RyYXRlZ3lOYW1lICsgXCInIG5hbWVcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH07XG4gICAgTmJBdXRoU2VydmljZS5wcm90b3R5cGUucHJvY2Vzc1Jlc3VsdFRva2VuID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0LmlzU3VjY2VzcygpICYmIHJlc3VsdC5nZXRUb2tlbigpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b2tlblNlcnZpY2Uuc2V0KHJlc3VsdC5nZXRUb2tlbigpKVxuICAgICAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvZihyZXN1bHQpO1xuICAgIH07XG4gICAgTmJBdXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBJbmplY3RhYmxlKCksXG4gICAgICAgIF9fcGFyYW0oMSwgSW5qZWN0KE5CX0FVVEhfU1RSQVRFR0lFUykpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05iVG9rZW5TZXJ2aWNlLCBPYmplY3RdKVxuICAgIF0sIE5iQXV0aFNlcnZpY2UpO1xuICAgIHJldHVybiBOYkF1dGhTZXJ2aWNlO1xufSgpKTtcblxudmFyIE5iQXV0aFN0cmF0ZWd5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iQXV0aFN0cmF0ZWd5KCkge1xuICAgIH1cbiAgICAvLyB3ZSBzaG91bGQga2VlcCB0aGlzIGFueSBhbmQgdmFsaWRhdGlvbiBzaG91bGQgYmUgZG9uZSBpbiBgcmVnaXN0ZXJgIG1ldGhvZCBpbnN0ZWFkXG4gICAgLy8gb3RoZXJ3aXNlIGl0IHdvbid0IGJlIHBvc3NpYmxlIHRvIHBhc3MgYW4gZW1wdHkgb2JqZWN0XG4gICAgTmJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBkZWVwRXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIE5iQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5nZXRPcHRpb24gPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiBnZXREZWVwRnJvbU9iamVjdCh0aGlzLm9wdGlvbnMsIGtleSwgbnVsbCk7XG4gICAgfTtcbiAgICBOYkF1dGhTdHJhdGVneS5wcm90b3R5cGUuY3JlYXRlVG9rZW4gPSBmdW5jdGlvbiAodmFsdWUsIGZhaWxXaGVuSW52YWxpZFRva2VuKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IG5iQXV0aENyZWF0ZVRva2VuKHRoaXMuZ2V0T3B0aW9uKCd0b2tlbi5jbGFzcycpLCB2YWx1ZSwgdGhpcy5nZXROYW1lKCkpO1xuICAgICAgICAvLyBBdCB0aGlzIHBvaW50LCBuYkF1dGhDcmVhdGVUb2tlbiBmYWlsZWQgd2l0aCBOYkF1dGhJbGxlZ2FsVG9rZW5FcnJvciB3aGljaCBNVVNUIGJlIGludGVyY2VwdGVkIGJ5IHN0cmF0ZWdpZXNcbiAgICAgICAgLy8gT3IgdG9rZW4gaXMgY3JlYXRlZC4gSXQgTUFZIGJlIGNyZWF0ZWQgZXZlbiBpZiBiYWNrZW5kIGRpZCBub3QgcmV0dXJuIGFueSB0b2tlbiwgaW4gdGhpcyBjYXNlIGl0IGlzICFWYWxpZFxuICAgICAgICBpZiAoZmFpbFdoZW5JbnZhbGlkVG9rZW4gJiYgIXRva2VuLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgLy8gSWYgd2UgcmVxdWlyZSBhIHZhbGlkIHRva2VuIChpLmUuIGlzVmFsaWQpLCB0aGVuIHdlIE1VU1QgdGhyb3cgTmJBdXRoSWxsZWdhbFRva2VuRXJyb3Igc28gdGhhdCB0aGUgc3RyYXRlZ2llc1xuICAgICAgICAgICAgLy8gaW50ZXJjZXB0IGl0XG4gICAgICAgICAgICB0aHJvdyBuZXcgTmJBdXRoSWxsZWdhbFRva2VuRXJyb3IoJ1Rva2VuIGlzIGVtcHR5IG9yIGludmFsaWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH07XG4gICAgTmJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE9wdGlvbignbmFtZScpO1xuICAgIH07XG4gICAgTmJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmNyZWF0ZUZhaWxSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgSHR0cFJlc3BvbnNlKHsgYm9keToge30sIHN0YXR1czogNDAxIH0pO1xuICAgIH07XG4gICAgTmJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmNyZWF0ZVN1Y2Nlc3NSZXNwb25zZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgSHR0cFJlc3BvbnNlKHsgYm9keToge30sIHN0YXR1czogMjAwIH0pO1xuICAgIH07XG4gICAgTmJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmdldEFjdGlvbkVuZHBvaW50ID0gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICB2YXIgYWN0aW9uRW5kcG9pbnQgPSB0aGlzLmdldE9wdGlvbihhY3Rpb24gKyBcIi5lbmRwb2ludFwiKTtcbiAgICAgICAgdmFyIGJhc2VFbmRwb2ludCA9IHRoaXMuZ2V0T3B0aW9uKCdiYXNlRW5kcG9pbnQnKTtcbiAgICAgICAgcmV0dXJuIGFjdGlvbkVuZHBvaW50ID8gYmFzZUVuZHBvaW50ICsgYWN0aW9uRW5kcG9pbnQgOiAnJztcbiAgICB9O1xuICAgIHJldHVybiBOYkF1dGhTdHJhdGVneTtcbn0oKSk7XG5cbnZhciBOYkF1dGhSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgLy8gVE9ETzogYmV0dGVyIHBhc3Mgb2JqZWN0XG4gICAgZnVuY3Rpb24gTmJBdXRoUmVzdWx0KHN1Y2Nlc3MsIHJlc3BvbnNlLCByZWRpcmVjdCwgZXJyb3JzLCBtZXNzYWdlcywgdG9rZW4pIHtcbiAgICAgICAgaWYgKHRva2VuID09PSB2b2lkIDApIHsgdG9rZW4gPSBudWxsOyB9XG4gICAgICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7XG4gICAgICAgIHRoaXMucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgICAgdGhpcy5yZWRpcmVjdCA9IHJlZGlyZWN0O1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5lcnJvcnMuY29uY2F0KFtlcnJvcnNdKTtcbiAgICAgICAgaWYgKGVycm9ycyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9ycztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gdGhpcy5tZXNzYWdlcy5jb25jYXQoW21lc3NhZ2VzXSk7XG4gICAgICAgIGlmIChtZXNzYWdlcyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VzID0gbWVzc2FnZXM7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgIH1cbiAgICBOYkF1dGhSZXN1bHQucHJvdG90eXBlLmdldFJlc3BvbnNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXNwb25zZTtcbiAgICB9O1xuICAgIE5iQXV0aFJlc3VsdC5wcm90b3R5cGUuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRva2VuO1xuICAgIH07XG4gICAgTmJBdXRoUmVzdWx0LnByb3RvdHlwZS5nZXRSZWRpcmVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3Q7XG4gICAgfTtcbiAgICBOYkF1dGhSZXN1bHQucHJvdG90eXBlLmdldEVycm9ycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JzLmZpbHRlcihmdW5jdGlvbiAodmFsKSB7IHJldHVybiAhIXZhbDsgfSk7XG4gICAgfTtcbiAgICBOYkF1dGhSZXN1bHQucHJvdG90eXBlLmdldE1lc3NhZ2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXNzYWdlcy5maWx0ZXIoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gISF2YWw7IH0pO1xuICAgIH07XG4gICAgTmJBdXRoUmVzdWx0LnByb3RvdHlwZS5pc1N1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1Y2Nlc3M7XG4gICAgfTtcbiAgICBOYkF1dGhSZXN1bHQucHJvdG90eXBlLmlzRmFpbHVyZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLnN1Y2Nlc3M7XG4gICAgfTtcbiAgICByZXR1cm4gTmJBdXRoUmVzdWx0O1xufSgpKTtcblxudmFyIE5iQXV0aFN0cmF0ZWd5T3B0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOYkF1dGhTdHJhdGVneU9wdGlvbnMoKSB7XG4gICAgfVxuICAgIHJldHVybiBOYkF1dGhTdHJhdGVneU9wdGlvbnM7XG59KCkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJEdW1teUF1dGhTdHJhdGVneU9wdGlvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE5iRHVtbXlBdXRoU3RyYXRlZ3lPcHRpb25zLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE5iRHVtbXlBdXRoU3RyYXRlZ3lPcHRpb25zKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudG9rZW4gPSB7XG4gICAgICAgICAgICBjbGFzczogTmJBdXRoU2ltcGxlVG9rZW4sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmRlbGF5ID0gMTAwMDtcbiAgICAgICAgX3RoaXMuYWx3YXlzRmFpbCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBOYkR1bW15QXV0aFN0cmF0ZWd5T3B0aW9ucztcbn0oTmJBdXRoU3RyYXRlZ3lPcHRpb25zKSk7XG52YXIgZHVtbXlTdHJhdGVneU9wdGlvbnMgPSBuZXcgTmJEdW1teUF1dGhTdHJhdGVneU9wdGlvbnMoKTtcblxuLyoqXG4gKiBEdW1teSBhdXRoIHN0cmF0ZWd5LiBDb3VsZCBiZSB1c2VmdWwgZm9yIGF1dGggc2V0dXAgd2hlbiBiYWNrZW5kIGlzIG5vdCBhdmFpbGFibGUgeWV0LlxuICpcbiAqXG4gKiBTdHJhdGVneSBzZXR0aW5ncy5cbiAqXG4gKiBgYGB0c1xuICogZXhwb3J0IGNsYXNzIE5iRHVtbXlBdXRoU3RyYXRlZ3lPcHRpb25zIGV4dGVuZHMgTmJBdXRoU3RyYXRlZ3lPcHRpb25zIHtcbiAqICAgbmFtZSA9ICdkdW1teSc7XG4gKiAgIHRva2VuID0ge1xuICogICAgIGNsYXNzOiBOYkF1dGhTaW1wbGVUb2tlbixcbiAqICAgfTtcbiAqICAgZGVsYXk/ID0gMTAwMDtcbiAqICAgYWx3YXlzRmFpbD8gPSBmYWxzZTtcbiAqIH1cbiAqIGBgYFxuICovXG52YXIgTmJEdW1teUF1dGhTdHJhdGVneSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJEdW1teUF1dGhTdHJhdGVneSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYkR1bW15QXV0aFN0cmF0ZWd5KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuZGVmYXVsdE9wdGlvbnMgPSBkdW1teVN0cmF0ZWd5T3B0aW9ucztcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5XzEgPSBOYkR1bW15QXV0aFN0cmF0ZWd5O1xuICAgIE5iRHVtbXlBdXRoU3RyYXRlZ3kuc2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gW05iRHVtbXlBdXRoU3RyYXRlZ3lfMSwgb3B0aW9uc107XG4gICAgfTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gb2YodGhpcy5jcmVhdGVEdW1teVJlc3VsdChkYXRhKSlcbiAgICAgICAgICAgIC5waXBlKGRlbGF5KHRoaXMuZ2V0T3B0aW9uKCdkZWxheScpKSk7XG4gICAgfTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBvZih0aGlzLmNyZWF0ZUR1bW15UmVzdWx0KGRhdGEpKVxuICAgICAgICAgICAgLnBpcGUoZGVsYXkodGhpcy5nZXRPcHRpb24oJ2RlbGF5JykpKTtcbiAgICB9O1xuICAgIE5iRHVtbXlBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnJlcXVlc3RQYXNzd29yZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBvZih0aGlzLmNyZWF0ZUR1bW15UmVzdWx0KGRhdGEpKVxuICAgICAgICAgICAgLnBpcGUoZGVsYXkodGhpcy5nZXRPcHRpb24oJ2RlbGF5JykpKTtcbiAgICB9O1xuICAgIE5iRHVtbXlBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnJlc2V0UGFzc3dvcmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gb2YodGhpcy5jcmVhdGVEdW1teVJlc3VsdChkYXRhKSlcbiAgICAgICAgICAgIC5waXBlKGRlbGF5KHRoaXMuZ2V0T3B0aW9uKCdkZWxheScpKSk7XG4gICAgfTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5sb2dvdXQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gb2YodGhpcy5jcmVhdGVEdW1teVJlc3VsdChkYXRhKSlcbiAgICAgICAgICAgIC5waXBlKGRlbGF5KHRoaXMuZ2V0T3B0aW9uKCdkZWxheScpKSk7XG4gICAgfTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5yZWZyZXNoVG9rZW4gPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gb2YodGhpcy5jcmVhdGVEdW1teVJlc3VsdChkYXRhKSlcbiAgICAgICAgICAgIC5waXBlKGRlbGF5KHRoaXMuZ2V0T3B0aW9uKCdkZWxheScpKSk7XG4gICAgfTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5jcmVhdGVEdW1teVJlc3VsdCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLmdldE9wdGlvbignYWx3YXlzRmFpbCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdChmYWxzZSwgdGhpcy5jcmVhdGVGYWlsUmVzcG9uc2UoZGF0YSksIG51bGwsIFsnU29tZXRoaW5nIHdlbnQgd3JvbmcuJ10pO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLmNyZWF0ZVRva2VuKCd0ZXN0IHRva2VuJywgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdCh0cnVlLCB0aGlzLmNyZWF0ZVN1Y2Nlc3NSZXNwb25zZShkYXRhKSwgJy8nLCBbXSwgWydTdWNjZXNzZnVsbHkgbG9nZ2VkIGluLiddLCB0b2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYkF1dGhSZXN1bHQoZmFsc2UsIHRoaXMuY3JlYXRlRmFpbFJlc3BvbnNlKGRhdGEpLCBudWxsLCBbZXJyLm1lc3NhZ2VdKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdmFyIE5iRHVtbXlBdXRoU3RyYXRlZ3lfMTtcbiAgICBOYkR1bW15QXV0aFN0cmF0ZWd5ID0gTmJEdW1teUF1dGhTdHJhdGVneV8xID0gX19kZWNvcmF0ZShbXG4gICAgICAgIEluamVjdGFibGUoKVxuICAgIF0sIE5iRHVtbXlBdXRoU3RyYXRlZ3kpO1xuICAgIHJldHVybiBOYkR1bW15QXV0aFN0cmF0ZWd5O1xufShOYkF1dGhTdHJhdGVneSkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJPQXV0aDJSZXNwb25zZVR5cGU7XG4oZnVuY3Rpb24gKE5iT0F1dGgyUmVzcG9uc2VUeXBlKSB7XG4gICAgTmJPQXV0aDJSZXNwb25zZVR5cGVbXCJDT0RFXCJdID0gXCJjb2RlXCI7XG4gICAgTmJPQXV0aDJSZXNwb25zZVR5cGVbXCJUT0tFTlwiXSA9IFwidG9rZW5cIjtcbn0pKE5iT0F1dGgyUmVzcG9uc2VUeXBlIHx8IChOYk9BdXRoMlJlc3BvbnNlVHlwZSA9IHt9KSk7XG4vLyBUT0RPOiBjbGllbnRfY3JlZGVudGlhbHNcbnZhciBOYk9BdXRoMkdyYW50VHlwZTtcbihmdW5jdGlvbiAoTmJPQXV0aDJHcmFudFR5cGUpIHtcbiAgICBOYk9BdXRoMkdyYW50VHlwZVtcIkFVVEhPUklaQVRJT05fQ09ERVwiXSA9IFwiYXV0aG9yaXphdGlvbl9jb2RlXCI7XG4gICAgTmJPQXV0aDJHcmFudFR5cGVbXCJQQVNTV09SRFwiXSA9IFwicGFzc3dvcmRcIjtcbiAgICBOYk9BdXRoMkdyYW50VHlwZVtcIlJFRlJFU0hfVE9LRU5cIl0gPSBcInJlZnJlc2hfdG9rZW5cIjtcbn0pKE5iT0F1dGgyR3JhbnRUeXBlIHx8IChOYk9BdXRoMkdyYW50VHlwZSA9IHt9KSk7XG52YXIgTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kO1xuKGZ1bmN0aW9uIChOYk9BdXRoMkNsaWVudEF1dGhNZXRob2QpIHtcbiAgICBOYk9BdXRoMkNsaWVudEF1dGhNZXRob2RbXCJOT05FXCJdID0gXCJub25lXCI7XG4gICAgTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kW1wiQkFTSUNcIl0gPSBcImJhc2ljXCI7XG4gICAgTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kW1wiUkVRVUVTVF9CT0RZXCJdID0gXCJyZXF1ZXN0LWJvZHlcIjtcbn0pKE5iT0F1dGgyQ2xpZW50QXV0aE1ldGhvZCB8fCAoTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kID0ge30pKTtcbnZhciBOYk9BdXRoMkF1dGhTdHJhdGVneU9wdGlvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE5iT0F1dGgyQXV0aFN0cmF0ZWd5T3B0aW9ucywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYk9BdXRoMkF1dGhTdHJhdGVneU9wdGlvbnMoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5iYXNlRW5kcG9pbnQgPSAnJztcbiAgICAgICAgX3RoaXMuY2xpZW50SWQgPSAnJztcbiAgICAgICAgX3RoaXMuY2xpZW50U2VjcmV0ID0gJyc7XG4gICAgICAgIF90aGlzLmNsaWVudEF1dGhNZXRob2QgPSBOYk9BdXRoMkNsaWVudEF1dGhNZXRob2QuTk9ORTtcbiAgICAgICAgX3RoaXMucmVkaXJlY3QgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiAnLycsXG4gICAgICAgICAgICBmYWlsdXJlOiBudWxsLFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5kZWZhdWx0RXJyb3JzID0gWydTb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2Fpbi4nXTtcbiAgICAgICAgX3RoaXMuZGVmYXVsdE1lc3NhZ2VzID0gWydZb3UgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkLiddO1xuICAgICAgICBfdGhpcy5hdXRob3JpemUgPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogJ2F1dGhvcml6ZScsXG4gICAgICAgICAgICByZXNwb25zZVR5cGU6IE5iT0F1dGgyUmVzcG9uc2VUeXBlLkNPREUsXG4gICAgICAgICAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgX3RoaXMudG9rZW4gPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogJ3Rva2VuJyxcbiAgICAgICAgICAgIGdyYW50VHlwZTogTmJPQXV0aDJHcmFudFR5cGUuQVVUSE9SSVpBVElPTl9DT0RFLFxuICAgICAgICAgICAgcmVxdWlyZVZhbGlkVG9rZW46IHRydWUsXG4gICAgICAgICAgICBjbGFzczogTmJBdXRoT0F1dGgyVG9rZW4sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnJlZnJlc2ggPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogJ3Rva2VuJyxcbiAgICAgICAgICAgIGdyYW50VHlwZTogTmJPQXV0aDJHcmFudFR5cGUuUkVGUkVTSF9UT0tFTixcbiAgICAgICAgICAgIHJlcXVpcmVWYWxpZFRva2VuOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBOYk9BdXRoMkF1dGhTdHJhdGVneU9wdGlvbnM7XG59KE5iQXV0aFN0cmF0ZWd5T3B0aW9ucykpO1xudmFyIGF1dGgyU3RyYXRlZ3lPcHRpb25zID0gbmV3IE5iT0F1dGgyQXV0aFN0cmF0ZWd5T3B0aW9ucygpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG4vKipcbiAqIE9BdXRoMiBhdXRoZW50aWNhdGlvbiBzdHJhdGVneS5cbiAqXG4gKiBTdHJhdGVneSBzZXR0aW5nczpcbiAqXG4gKiBgYGB0c1xuICogZXhwb3J0IGVudW0gTmJPQXV0aDJSZXNwb25zZVR5cGUge1xuICogICBDT0RFID0gJ2NvZGUnLFxuICogICBUT0tFTiA9ICd0b2tlbicsXG4gKiB9XG4gKlxuICogZXhwb3J0IGVudW0gTmJPQXV0aDJHcmFudFR5cGUge1xuICogICBBVVRIT1JJWkFUSU9OX0NPREUgPSAnYXV0aG9yaXphdGlvbl9jb2RlJyxcbiAqICAgUEFTU1dPUkQgPSAncGFzc3dvcmQnLFxuICogICBSRUZSRVNIX1RPS0VOID0gJ3JlZnJlc2hfdG9rZW4nLFxuICogfVxuICpcbiAqIGV4cG9ydCBjbGFzcyBOYk9BdXRoMkF1dGhTdHJhdGVneU9wdGlvbnMge1xuICogICBuYW1lOiBzdHJpbmc7XG4gKiAgIGJhc2VFbmRwb2ludD86IHN0cmluZyA9ICcnO1xuICogICBjbGllbnRJZDogc3RyaW5nID0gJyc7XG4gKiAgIGNsaWVudFNlY3JldDogc3RyaW5nID0gJyc7XG4gKiAgIGNsaWVudEF1dGhNZXRob2Q6IHN0cmluZyA9IE5iT0F1dGgyQ2xpZW50QXV0aE1ldGhvZC5OT05FO1xuICogICByZWRpcmVjdD86IHsgc3VjY2Vzcz86IHN0cmluZzsgZmFpbHVyZT86IHN0cmluZyB9ID0ge1xuICogICAgIHN1Y2Nlc3M6ICcvJyxcbiAqICAgICBmYWlsdXJlOiBudWxsLFxuICogICB9O1xuICogICBkZWZhdWx0RXJyb3JzPzogYW55W10gPSBbJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluLiddO1xuICogICBkZWZhdWx0TWVzc2FnZXM/OiBhbnlbXSA9IFsnWW91IGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZC4nXTtcbiAqICAgYXV0aG9yaXplPzoge1xuICogICAgIGVuZHBvaW50Pzogc3RyaW5nO1xuICogICAgIHJlZGlyZWN0VXJpPzogc3RyaW5nO1xuICogICAgIHJlc3BvbnNlVHlwZT86IHN0cmluZztcbiAqICAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAqICAgICBzY29wZT86IHN0cmluZztcbiAqICAgICBzdGF0ZT86IHN0cmluZztcbiAqICAgICBwYXJhbXM/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9O1xuICogICB9ID0ge1xuICogICAgIGVuZHBvaW50OiAnYXV0aG9yaXplJyxcbiAqICAgICByZXNwb25zZVR5cGU6IE5iT0F1dGgyUmVzcG9uc2VUeXBlLkNPREUsXG4gKiAgIH07XG4gKiAgIHRva2VuPzoge1xuICogICAgIGVuZHBvaW50Pzogc3RyaW5nO1xuICogICAgIGdyYW50VHlwZT86IHN0cmluZztcbiAqICAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAqICAgICByZWRpcmVjdFVyaT86IHN0cmluZztcbiAqICAgICBzY29wZT86IHN0cmluZztcbiAqICAgICBjbGFzczogTmJBdXRoVG9rZW5DbGFzcyxcbiAqICAgfSA9IHtcbiAqICAgICBlbmRwb2ludDogJ3Rva2VuJyxcbiAqICAgICBncmFudFR5cGU6IE5iT0F1dGgyR3JhbnRUeXBlLkFVVEhPUklaQVRJT05fQ09ERSxcbiAqICAgICBjbGFzczogTmJBdXRoT0F1dGgyVG9rZW4sXG4gKiAgIH07XG4gKiAgIHJlZnJlc2g/OiB7XG4gKiAgICAgZW5kcG9pbnQ/OiBzdHJpbmc7XG4gKiAgICAgZ3JhbnRUeXBlPzogc3RyaW5nO1xuICogICAgIHNjb3BlPzogc3RyaW5nO1xuICogICAgIHJlcXVpcmVWYWxpZFRva2VuOiB0cnVlLFxuICogICB9ID0ge1xuICogICAgIGVuZHBvaW50OiAndG9rZW4nLFxuICogICAgIGdyYW50VHlwZTogTmJPQXV0aDJHcmFudFR5cGUuUkVGUkVTSF9UT0tFTixcbiAqICAgfTtcbiAqIH1cbiAqIGBgYFxuICpcbiAqL1xudmFyIE5iT0F1dGgyQXV0aFN0cmF0ZWd5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOYk9BdXRoMkF1dGhTdHJhdGVneSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYk9BdXRoMkF1dGhTdHJhdGVneShodHRwLCByb3V0ZSwgd2luZG93KSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmh0dHAgPSBodHRwO1xuICAgICAgICBfdGhpcy5yb3V0ZSA9IHJvdXRlO1xuICAgICAgICBfdGhpcy53aW5kb3cgPSB3aW5kb3c7XG4gICAgICAgIF90aGlzLnJlZGlyZWN0UmVzdWx0SGFuZGxlcnMgPSAoX2EgPSB7fSxcbiAgICAgICAgICAgIF9hW05iT0F1dGgyUmVzcG9uc2VUeXBlLkNPREVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvZihfdGhpcy5yb3V0ZS5zbmFwc2hvdC5xdWVyeVBhcmFtcykucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zLmNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZXF1ZXN0VG9rZW4ocGFyYW1zLmNvZGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihuZXcgTmJBdXRoUmVzdWx0KGZhbHNlLCBwYXJhbXMsIF90aGlzLmdldE9wdGlvbigncmVkaXJlY3QuZmFpbHVyZScpLCBfdGhpcy5nZXRPcHRpb24oJ2RlZmF1bHRFcnJvcnMnKSwgW10pKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FbTmJPQXV0aDJSZXNwb25zZVR5cGUuVE9LRU5dID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBtb2R1bGUgPSAnYXV0aG9yaXplJztcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWlyZVZhbGlkVG9rZW4gPSBfdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIucmVxdWlyZVZhbGlkVG9rZW5cIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9mKF90aGlzLnJvdXRlLnNuYXBzaG90LmZyYWdtZW50KS5waXBlKG1hcChmdW5jdGlvbiAoZnJhZ21lbnQpIHsgcmV0dXJuIF90aGlzLnBhcnNlSGFzaEFzUXVlcnlQYXJhbXMoZnJhZ21lbnQpOyB9KSwgbWFwKGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJhbXMuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTmJBdXRoUmVzdWx0KHRydWUsIHBhcmFtcywgX3RoaXMuZ2V0T3B0aW9uKCdyZWRpcmVjdC5zdWNjZXNzJyksIFtdLCBfdGhpcy5nZXRPcHRpb24oJ2RlZmF1bHRNZXNzYWdlcycpLCBfdGhpcy5jcmVhdGVUb2tlbihwYXJhbXMsIHJlcXVpcmVWYWxpZFRva2VuKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBOYkF1dGhSZXN1bHQoZmFsc2UsIHBhcmFtcywgX3RoaXMuZ2V0T3B0aW9uKCdyZWRpcmVjdC5mYWlsdXJlJyksIF90aGlzLmdldE9wdGlvbignZGVmYXVsdEVycm9ycycpLCBbXSk7XG4gICAgICAgICAgICAgICAgfSksIGNhdGNoRXJyb3IoZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBOYkF1dGhJbGxlZ2FsVG9rZW5FcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goJ1NvbWV0aGluZyB3ZW50IHdyb25nLicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvZihuZXcgTmJBdXRoUmVzdWx0KGZhbHNlLCBlcnIsIF90aGlzLmdldE9wdGlvbigncmVkaXJlY3QuZmFpbHVyZScpLCBlcnJvcnMpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2EpO1xuICAgICAgICBfdGhpcy5yZWRpcmVjdFJlc3VsdHMgPSAoX2IgPSB7fSxcbiAgICAgICAgICAgIF9iW05iT0F1dGgyUmVzcG9uc2VUeXBlLkNPREVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvZihfdGhpcy5yb3V0ZS5zbmFwc2hvdC5xdWVyeVBhcmFtcykucGlwZShtYXAoZnVuY3Rpb24gKHBhcmFtcykgeyByZXR1cm4gISEocGFyYW1zICYmIChwYXJhbXMuY29kZSB8fCBwYXJhbXMuZXJyb3IpKTsgfSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9iW05iT0F1dGgyUmVzcG9uc2VUeXBlLlRPS0VOXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YoX3RoaXMucm91dGUuc25hcHNob3QuZnJhZ21lbnQpLnBpcGUobWFwKGZ1bmN0aW9uIChmcmFnbWVudCkgeyByZXR1cm4gX3RoaXMucGFyc2VIYXNoQXNRdWVyeVBhcmFtcyhmcmFnbWVudCk7IH0pLCBtYXAoZnVuY3Rpb24gKHBhcmFtcykgeyByZXR1cm4gISEocGFyYW1zICYmIChwYXJhbXMuYWNjZXNzX3Rva2VuIHx8IHBhcmFtcy5lcnJvcikpOyB9KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2IpO1xuICAgICAgICBfdGhpcy5kZWZhdWx0T3B0aW9ucyA9IGF1dGgyU3RyYXRlZ3lPcHRpb25zO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE5iT0F1dGgyQXV0aFN0cmF0ZWd5XzEgPSBOYk9BdXRoMkF1dGhTdHJhdGVneTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5zZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBbTmJPQXV0aDJBdXRoU3RyYXRlZ3lfMSwgb3B0aW9uc107XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLCBcInJlc3BvbnNlVHlwZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T3B0aW9uKCdhdXRob3JpemUucmVzcG9uc2VUeXBlJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUsIFwiY2xpZW50QXV0aE1ldGhvZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T3B0aW9uKCdjbGllbnRBdXRoTWV0aG9kJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE5iT0F1dGgyQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5nZXRPcHRpb24oJ3Rva2VuLmdyYW50VHlwZScpID09PSBOYk9BdXRoMkdyYW50VHlwZS5QQVNTV09SRCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFzc3dvcmRUb2tlbihkYXRhLmVtYWlsLCBkYXRhLnBhc3N3b3JkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzUmVkaXJlY3RSZXN1bHQoKVxuICAgICAgICAgICAgICAgIC5waXBlKHN3aXRjaE1hcChmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXV0aG9yaXplUmVkaXJlY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKG5ldyBOYkF1dGhSZXN1bHQodHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0QXV0aG9yaXphdGlvblJlc3VsdCgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuZ2V0QXV0aG9yaXphdGlvblJlc3VsdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHJlZGlyZWN0UmVzdWx0SGFuZGxlciA9IHRoaXMucmVkaXJlY3RSZXN1bHRIYW5kbGVyc1t0aGlzLnJlc3BvbnNlVHlwZV07XG4gICAgICAgIGlmIChyZWRpcmVjdFJlc3VsdEhhbmRsZXIpIHtcbiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdFJlc3VsdEhhbmRsZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInXCIgKyB0aGlzLnJlc3BvbnNlVHlwZSArIFwiJyByZXNwb25zZVR5cGUgaXMgbm90IHN1cHBvcnRlZCxcXG4gICAgICAgICAgICAgICAgICAgICAgb25seSAndG9rZW4nIGFuZCAnY29kZScgYXJlIHN1cHBvcnRlZCBub3dcIik7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUucmVmcmVzaFRva2VuID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtb2R1bGUgPSAncmVmcmVzaCc7XG4gICAgICAgIHZhciB1cmwgPSB0aGlzLmdldEFjdGlvbkVuZHBvaW50KG1vZHVsZSk7XG4gICAgICAgIHZhciByZXF1aXJlVmFsaWRUb2tlbiA9IHRoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLnJlcXVpcmVWYWxpZFRva2VuXCIpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IHRoaXMuYnVpbGRBdXRoSGVhZGVyKCkgfHwgbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLmFwcGVuZCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCB0aGlzLmJ1aWxkUmVmcmVzaFJlcXVlc3REYXRhKHRva2VuKSwgeyBoZWFkZXJzOiBoZWFkZXJzIH0pXG4gICAgICAgICAgICAucGlwZShtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYkF1dGhSZXN1bHQodHJ1ZSwgcmVzLCBfdGhpcy5nZXRPcHRpb24oJ3JlZGlyZWN0LnN1Y2Nlc3MnKSwgW10sIF90aGlzLmdldE9wdGlvbignZGVmYXVsdE1lc3NhZ2VzJyksIF90aGlzLmNyZWF0ZVJlZnJlc2hlZFRva2VuKHJlcywgdG9rZW4sIHJlcXVpcmVWYWxpZFRva2VuKSk7XG4gICAgICAgIH0pLCBjYXRjaEVycm9yKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIF90aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzKTsgfSkpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnBhc3N3b3JkVG9rZW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtb2R1bGUgPSAndG9rZW4nO1xuICAgICAgICB2YXIgdXJsID0gdGhpcy5nZXRBY3Rpb25FbmRwb2ludChtb2R1bGUpO1xuICAgICAgICB2YXIgcmVxdWlyZVZhbGlkVG9rZW4gPSB0aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZXF1aXJlVmFsaWRUb2tlblwiKTtcbiAgICAgICAgdmFyIGhlYWRlcnMgPSB0aGlzLmJ1aWxkQXV0aEhlYWRlcigpIHx8IG5ldyBIdHRwSGVhZGVycygpO1xuICAgICAgICBoZWFkZXJzID0gaGVhZGVycy5hcHBlbmQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KHVybCwgdGhpcy5idWlsZFBhc3N3b3JkUmVxdWVzdERhdGEodXNlcm5hbWUsIHBhc3N3b3JkKSwgeyBoZWFkZXJzOiBoZWFkZXJzIH0pXG4gICAgICAgICAgICAucGlwZShtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYkF1dGhSZXN1bHQodHJ1ZSwgcmVzLCBfdGhpcy5nZXRPcHRpb24oJ3JlZGlyZWN0LnN1Y2Nlc3MnKSwgW10sIF90aGlzLmdldE9wdGlvbignZGVmYXVsdE1lc3NhZ2VzJyksIF90aGlzLmNyZWF0ZVRva2VuKHJlcywgcmVxdWlyZVZhbGlkVG9rZW4pKTtcbiAgICAgICAgfSksIGNhdGNoRXJyb3IoZnVuY3Rpb24gKHJlcykgeyByZXR1cm4gX3RoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXMpOyB9KSk7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuYXV0aG9yaXplUmVkaXJlY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMud2luZG93LmxvY2F0aW9uLmhyZWYgPSB0aGlzLmJ1aWxkUmVkaXJlY3RVcmwoKTtcbiAgICB9O1xuICAgIE5iT0F1dGgyQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5pc1JlZGlyZWN0UmVzdWx0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWRpcmVjdFJlc3VsdHNbdGhpcy5yZXNwb25zZVR5cGVdLmNhbGwodGhpcyk7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUucmVxdWVzdFRva2VuID0gZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIG1vZHVsZSA9ICd0b2tlbic7XG4gICAgICAgIHZhciB1cmwgPSB0aGlzLmdldEFjdGlvbkVuZHBvaW50KG1vZHVsZSk7XG4gICAgICAgIHZhciByZXF1aXJlVmFsaWRUb2tlbiA9IHRoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLnJlcXVpcmVWYWxpZFRva2VuXCIpO1xuICAgICAgICB2YXIgaGVhZGVycyA9IHRoaXMuYnVpbGRBdXRoSGVhZGVyKCkgfHwgbmV3IEh0dHBIZWFkZXJzKCk7XG4gICAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLmFwcGVuZCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QodXJsLCB0aGlzLmJ1aWxkQ29kZVJlcXVlc3REYXRhKGNvZGUpLCB7IGhlYWRlcnM6IGhlYWRlcnMgfSlcbiAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdCh0cnVlLCByZXMsIF90aGlzLmdldE9wdGlvbigncmVkaXJlY3Quc3VjY2VzcycpLCBbXSwgX3RoaXMuZ2V0T3B0aW9uKCdkZWZhdWx0TWVzc2FnZXMnKSwgX3RoaXMuY3JlYXRlVG9rZW4ocmVzLCByZXF1aXJlVmFsaWRUb2tlbikpO1xuICAgICAgICB9KSwgY2F0Y2hFcnJvcihmdW5jdGlvbiAocmVzKSB7IHJldHVybiBfdGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlcyk7IH0pKTtcbiAgICB9O1xuICAgIE5iT0F1dGgyQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5idWlsZENvZGVSZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICBncmFudF90eXBlOiB0aGlzLmdldE9wdGlvbigndG9rZW4uZ3JhbnRUeXBlJyksXG4gICAgICAgICAgICBjb2RlOiBjb2RlLFxuICAgICAgICAgICAgcmVkaXJlY3RfdXJpOiB0aGlzLmdldE9wdGlvbigndG9rZW4ucmVkaXJlY3RVcmknKSxcbiAgICAgICAgICAgIGNsaWVudF9pZDogdGhpcy5nZXRPcHRpb24oJ2NsaWVudElkJyksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLnVybEVuY29kZVBhcmFtZXRlcnModGhpcy5jbGVhblBhcmFtcyh0aGlzLmFkZENyZWRlbnRpYWxzVG9QYXJhbXMocGFyYW1zKSkpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmJ1aWxkUmVmcmVzaFJlcXVlc3REYXRhID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICBncmFudF90eXBlOiB0aGlzLmdldE9wdGlvbigncmVmcmVzaC5ncmFudFR5cGUnKSxcbiAgICAgICAgICAgIHJlZnJlc2hfdG9rZW46IHRva2VuLmdldFJlZnJlc2hUb2tlbigpLFxuICAgICAgICAgICAgc2NvcGU6IHRoaXMuZ2V0T3B0aW9uKCdyZWZyZXNoLnNjb3BlJyksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLnVybEVuY29kZVBhcmFtZXRlcnModGhpcy5jbGVhblBhcmFtcyh0aGlzLmFkZENyZWRlbnRpYWxzVG9QYXJhbXMocGFyYW1zKSkpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmJ1aWxkUGFzc3dvcmRSZXF1ZXN0RGF0YSA9IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgIGdyYW50X3R5cGU6IHRoaXMuZ2V0T3B0aW9uKCd0b2tlbi5ncmFudFR5cGUnKSxcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgIHNjb3BlOiB0aGlzLmdldE9wdGlvbigndG9rZW4uc2NvcGUnKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMudXJsRW5jb2RlUGFyYW1ldGVycyh0aGlzLmNsZWFuUGFyYW1zKHRoaXMuYWRkQ3JlZGVudGlhbHNUb1BhcmFtcyhwYXJhbXMpKSk7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuYnVpbGRBdXRoSGVhZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5jbGllbnRBdXRoTWV0aG9kID09PSBOYk9BdXRoMkNsaWVudEF1dGhNZXRob2QuQkFTSUMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdldE9wdGlvbignY2xpZW50SWQnKSAmJiB0aGlzLmdldE9wdGlvbignY2xpZW50U2VjcmV0JykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEh0dHBIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmFzaWMgJyArIGJ0b2EodGhpcy5nZXRPcHRpb24oJ2NsaWVudElkJykgKyAnOicgKyB0aGlzLmdldE9wdGlvbignY2xpZW50U2VjcmV0JykpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0ZvciBiYXNpYyBjbGllbnQgYXV0aGVudGljYXRpb24gbWV0aG9kLCBwbGVhc2UgcHJvdmlkZSBib3RoIGNsaWVudElkICYgY2xpZW50U2VjcmV0LicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuY2xlYW5QYXJhbXMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHBhcmFtcylcbiAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIGtleSA9IF9hWzBdLCB2YWwgPSBfYVsxXTtcbiAgICAgICAgICAgIHJldHVybiAhdmFsICYmIGRlbGV0ZSBwYXJhbXNba2V5XTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuYWRkQ3JlZGVudGlhbHNUb1BhcmFtcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgaWYgKHRoaXMuY2xpZW50QXV0aE1ldGhvZCA9PT0gTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kLlJFUVVFU1RfQk9EWSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0T3B0aW9uKCdjbGllbnRJZCcpICYmIHRoaXMuZ2V0T3B0aW9uKCdjbGllbnRTZWNyZXQnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcGFyYW1zKSwgeyBjbGllbnRfaWQ6IHRoaXMuZ2V0T3B0aW9uKCdjbGllbnRJZCcpLCBjbGllbnRfc2VjcmV0OiB0aGlzLmdldE9wdGlvbignY2xpZW50U2VjcmV0JykgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignRm9yIHJlcXVlc3QgYm9keSBjbGllbnQgYXV0aGVudGljYXRpb24gbWV0aG9kLCBwbGVhc2UgcHJvdmlkZSBib3RoIGNsaWVudElkICYgY2xpZW50U2VjcmV0LicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuaGFuZGxlUmVzcG9uc2VFcnJvciA9IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgdmFyIGVycm9ycyA9IFtdO1xuICAgICAgICBpZiAocmVzIGluc3RhbmNlb2YgSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXMuZXJyb3IuZXJyb3JfZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChyZXMuZXJyb3IuZXJyb3JfZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZXJyb3JzID0gdGhpcy5nZXRPcHRpb24oJ2RlZmF1bHRFcnJvcnMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXMgaW5zdGFuY2VvZiBOYkF1dGhJbGxlZ2FsVG9rZW5FcnJvcikge1xuICAgICAgICAgICAgZXJyb3JzLnB1c2gocmVzLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXJyb3JzLnB1c2goJ1NvbWV0aGluZyB3ZW50IHdyb25nLicpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gb2YobmV3IE5iQXV0aFJlc3VsdChmYWxzZSwgcmVzLCB0aGlzLmdldE9wdGlvbigncmVkaXJlY3QuZmFpbHVyZScpLCBlcnJvcnMsIFtdKSk7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUuYnVpbGRSZWRpcmVjdFVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBhcmFtcyA9IF9fYXNzaWduKHsgcmVzcG9uc2VfdHlwZTogdGhpcy5nZXRPcHRpb24oJ2F1dGhvcml6ZS5yZXNwb25zZVR5cGUnKSwgY2xpZW50X2lkOiB0aGlzLmdldE9wdGlvbignY2xpZW50SWQnKSwgcmVkaXJlY3RfdXJpOiB0aGlzLmdldE9wdGlvbignYXV0aG9yaXplLnJlZGlyZWN0VXJpJyksIHNjb3BlOiB0aGlzLmdldE9wdGlvbignYXV0aG9yaXplLnNjb3BlJyksIHN0YXRlOiB0aGlzLmdldE9wdGlvbignYXV0aG9yaXplLnN0YXRlJykgfSwgdGhpcy5nZXRPcHRpb24oJ2F1dGhvcml6ZS5wYXJhbXMnKSk7XG4gICAgICAgIHZhciBlbmRwb2ludCA9IHRoaXMuZ2V0QWN0aW9uRW5kcG9pbnQoJ2F1dGhvcml6ZScpO1xuICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLnVybEVuY29kZVBhcmFtZXRlcnModGhpcy5jbGVhblBhcmFtcyhwYXJhbXMpKTtcbiAgICAgICAgcmV0dXJuIGVuZHBvaW50ICsgXCI/XCIgKyBxdWVyeTtcbiAgICB9O1xuICAgIE5iT0F1dGgyQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5wYXJzZUhhc2hBc1F1ZXJ5UGFyYW1zID0gZnVuY3Rpb24gKGhhc2gpIHtcbiAgICAgICAgcmV0dXJuIGhhc2ggPyBoYXNoLnNwbGl0KCcmJykucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHBhcnQpIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gcGFydC5zcGxpdCgnPScpO1xuICAgICAgICAgICAgYWNjW2l0ZW1bMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0ZW1bMV0pO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwge30pIDoge307XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUudXJsRW5jb2RlUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHBhcmFtcykubWFwKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGspICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQocGFyYW1zW2tdKTtcbiAgICAgICAgfSkuam9pbignJicpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmNyZWF0ZVJlZnJlc2hlZFRva2VuID0gZnVuY3Rpb24gKHJlcywgZXhpc3RpbmdUb2tlbiwgcmVxdWlyZVZhbGlkVG9rZW4pIHtcbiAgICAgICAgdmFyIHJlZnJlc2hlZFRva2VuID0gdGhpcy5jcmVhdGVUb2tlbihyZXMsIHJlcXVpcmVWYWxpZFRva2VuKTtcbiAgICAgICAgaWYgKCFyZWZyZXNoZWRUb2tlbi5nZXRSZWZyZXNoVG9rZW4oKSAmJiBleGlzdGluZ1Rva2VuLmdldFJlZnJlc2hUb2tlbigpKSB7XG4gICAgICAgICAgICByZWZyZXNoZWRUb2tlbi5zZXRSZWZyZXNoVG9rZW4oZXhpc3RpbmdUb2tlbi5nZXRSZWZyZXNoVG9rZW4oKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlZnJlc2hlZFRva2VuO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdgcmVnaXN0ZXJgIGlzIG5vdCBzdXBwb3J0ZWQgYnkgYE5iT0F1dGgyQXV0aFN0cmF0ZWd5YCwgdXNlIGBhdXRoZW50aWNhdGVgLicpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnJlcXVlc3RQYXNzd29yZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignYHJlcXVlc3RQYXNzd29yZGAgaXMgbm90IHN1cHBvcnRlZCBieSBgTmJPQXV0aDJBdXRoU3RyYXRlZ3lgLCB1c2UgYGF1dGhlbnRpY2F0ZWAuJyk7XG4gICAgfTtcbiAgICBOYk9BdXRoMkF1dGhTdHJhdGVneS5wcm90b3R5cGUucmVzZXRQYXNzd29yZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhID09PSB2b2lkIDApIHsgZGF0YSA9IHt9OyB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignYHJlc2V0UGFzc3dvcmRgIGlzIG5vdCBzdXBwb3J0ZWQgYnkgYE5iT0F1dGgyQXV0aFN0cmF0ZWd5YCwgdXNlIGBhdXRoZW50aWNhdGVgLicpO1xuICAgIH07XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG9mKG5ldyBOYkF1dGhSZXN1bHQodHJ1ZSkpO1xuICAgIH07XG4gICAgdmFyIE5iT0F1dGgyQXV0aFN0cmF0ZWd5XzE7XG4gICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3kgPSBOYk9BdXRoMkF1dGhTdHJhdGVneV8xID0gX19kZWNvcmF0ZShbXG4gICAgICAgIEluamVjdGFibGUoKSxcbiAgICAgICAgX19wYXJhbSgyLCBJbmplY3QoTkJfV0lORE9XKSksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbSHR0cENsaWVudCxcbiAgICAgICAgICAgIEFjdGl2YXRlZFJvdXRlLCBPYmplY3RdKVxuICAgIF0sIE5iT0F1dGgyQXV0aFN0cmF0ZWd5KTtcbiAgICByZXR1cm4gTmJPQXV0aDJBdXRoU3RyYXRlZ3k7XG59KE5iQXV0aFN0cmF0ZWd5KSk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBBa3Zlby4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi9cbnZhciBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5T3B0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJQYXNzd29yZEF1dGhTdHJhdGVneU9wdGlvbnMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTmJQYXNzd29yZEF1dGhTdHJhdGVneU9wdGlvbnMoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5iYXNlRW5kcG9pbnQgPSAnL2FwaS9hdXRoLyc7XG4gICAgICAgIF90aGlzLmxvZ2luID0ge1xuICAgICAgICAgICAgYWx3YXlzRmFpbDogZmFsc2UsXG4gICAgICAgICAgICBlbmRwb2ludDogJ2xvZ2luJyxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgcmVxdWlyZVZhbGlkVG9rZW46IHRydWUsXG4gICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICcvJyxcbiAgICAgICAgICAgICAgICBmYWlsdXJlOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlZmF1bHRFcnJvcnM6IFsnTG9naW4vRW1haWwgY29tYmluYXRpb24gaXMgbm90IGNvcnJlY3QsIHBsZWFzZSB0cnkgYWdhaW4uJ10sXG4gICAgICAgICAgICBkZWZhdWx0TWVzc2FnZXM6IFsnWW91IGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgbG9nZ2VkIGluLiddLFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5yZWdpc3RlciA9IHtcbiAgICAgICAgICAgIGFsd2F5c0ZhaWw6IGZhbHNlLFxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdyZWdpc3RlcicsXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIHJlcXVpcmVWYWxpZFRva2VuOiB0cnVlLFxuICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAnLycsXG4gICAgICAgICAgICAgICAgZmFpbHVyZTogbnVsbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWZhdWx0RXJyb3JzOiBbJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluLiddLFxuICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2VzOiBbJ1lvdSBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IHJlZ2lzdGVyZWQuJ10sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnJlcXVlc3RQYXNzID0ge1xuICAgICAgICAgICAgZW5kcG9pbnQ6ICdyZXF1ZXN0LXBhc3MnLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICcvJyxcbiAgICAgICAgICAgICAgICBmYWlsdXJlOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlZmF1bHRFcnJvcnM6IFsnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ10sXG4gICAgICAgICAgICBkZWZhdWx0TWVzc2FnZXM6IFsnUmVzZXQgcGFzc3dvcmQgaW5zdHJ1Y3Rpb25zIGhhdmUgYmVlbiBzZW50IHRvIHlvdXIgZW1haWwuJ10sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnJlc2V0UGFzcyA9IHtcbiAgICAgICAgICAgIGVuZHBvaW50OiAncmVzZXQtcGFzcycsXG4gICAgICAgICAgICBtZXRob2Q6ICdwdXQnLFxuICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAnLycsXG4gICAgICAgICAgICAgICAgZmFpbHVyZTogbnVsbCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNldFBhc3N3b3JkVG9rZW5LZXk6ICdyZXNldF9wYXNzd29yZF90b2tlbicsXG4gICAgICAgICAgICBkZWZhdWx0RXJyb3JzOiBbJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluLiddLFxuICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2VzOiBbJ1lvdXIgcGFzc3dvcmQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGNoYW5nZWQuJ10sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmxvZ291dCA9IHtcbiAgICAgICAgICAgIGFsd2F5c0ZhaWw6IGZhbHNlLFxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdsb2dvdXQnLFxuICAgICAgICAgICAgbWV0aG9kOiAnZGVsZXRlJyxcbiAgICAgICAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogJy8nLFxuICAgICAgICAgICAgICAgIGZhaWx1cmU6IG51bGwsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVmYXVsdEVycm9yczogWydTb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2Fpbi4nXSxcbiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlczogWydZb3UgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBsb2dnZWQgb3V0LiddLFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5yZWZyZXNoVG9rZW4gPSB7XG4gICAgICAgICAgICBlbmRwb2ludDogJ3JlZnJlc2gtdG9rZW4nLFxuICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAgICAgICAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogbnVsbCxcbiAgICAgICAgICAgICAgICBmYWlsdXJlOiBudWxsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlZmF1bHRFcnJvcnM6IFsnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ10sXG4gICAgICAgICAgICBkZWZhdWx0TWVzc2FnZXM6IFsnWW91ciB0b2tlbiBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgcmVmcmVzaGVkLiddLFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy50b2tlbiA9IHtcbiAgICAgICAgICAgIGNsYXNzOiBOYkF1dGhTaW1wbGVUb2tlbixcbiAgICAgICAgICAgIGtleTogJ2RhdGEudG9rZW4nLFxuICAgICAgICAgICAgZ2V0dGVyOiBmdW5jdGlvbiAobW9kdWxlLCByZXMsIG9wdGlvbnMpIHsgcmV0dXJuIGdldERlZXBGcm9tT2JqZWN0KHJlcy5ib2R5LCBvcHRpb25zLnRva2VuLmtleSk7IH0sXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmVycm9ycyA9IHtcbiAgICAgICAgICAgIGtleTogJ2RhdGEuZXJyb3JzJyxcbiAgICAgICAgICAgIGdldHRlcjogZnVuY3Rpb24gKG1vZHVsZSwgcmVzLCBvcHRpb25zKSB7IHJldHVybiBnZXREZWVwRnJvbU9iamVjdChyZXMuZXJyb3IsIG9wdGlvbnMuZXJyb3JzLmtleSwgb3B0aW9uc1ttb2R1bGVdLmRlZmF1bHRFcnJvcnMpOyB9LFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5tZXNzYWdlcyA9IHtcbiAgICAgICAgICAgIGtleTogJ2RhdGEubWVzc2FnZXMnLFxuICAgICAgICAgICAgZ2V0dGVyOiBmdW5jdGlvbiAobW9kdWxlLCByZXMsIG9wdGlvbnMpIHsgcmV0dXJuIGdldERlZXBGcm9tT2JqZWN0KHJlcy5ib2R5LCBvcHRpb25zLm1lc3NhZ2VzLmtleSwgb3B0aW9uc1ttb2R1bGVdLmRlZmF1bHRNZXNzYWdlcyk7IH0sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3lPcHRpb25zO1xufShOYkF1dGhTdHJhdGVneU9wdGlvbnMpKTtcbnZhciBwYXNzd29yZFN0cmF0ZWd5T3B0aW9ucyA9IG5ldyBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5T3B0aW9ucygpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG4vKipcbiAqIFRoZSBtb3N0IGNvbW1vbiBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBmb3IgZW1haWwvcGFzc3dvcmQgc3RyYXRlZ3kuXG4gKlxuICogU3RyYXRlZ3kgc2V0dGluZ3MuIE5vdGUsIHRoZXJlIGlzIG5vIG5lZWQgdG8gY29weSBvdmVyIHRoZSB3aG9sZSBvYmplY3QgdG8gY2hhbmdlIHRoZSBzZXR0aW5ncyB5b3UgbmVlZC5cbiAqIEFsc28sIHRoaXMuZ2V0T3B0aW9uIGNhbGwgd29uJ3Qgd29yayBvdXRzaWRlIG9mIHRoZSBkZWZhdWx0IG9wdGlvbnMgZGVjbGFyYXRpb25cbiAqICh3aGljaCBpcyBpbnNpZGUgb2YgdGhlIGBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5YCBjbGFzcyksIHNvIHlvdSBoYXZlIHRvIHJlcGxhY2UgaXQgd2l0aCBhIGN1c3RvbSBoZWxwZXIgZnVuY3Rpb25cbiAqIGlmIHlvdSBuZWVkIGl0LlxuICpcbiAqIGBgYHRzXG4gKmV4cG9ydCBjbGFzcyBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5T3B0aW9ucyBleHRlbmRzIE5iQXV0aFN0cmF0ZWd5T3B0aW9ucyB7XG4gKiAgbmFtZTogc3RyaW5nO1xuICogIGJhc2VFbmRwb2ludD8gPSAnL2FwaS9hdXRoLyc7XG4gKiAgbG9naW4/OiBib29sZWFuIHwgTmJQYXNzd29yZFN0cmF0ZWd5TW9kdWxlID0ge1xuICogICAgYWx3YXlzRmFpbDogZmFsc2UsXG4gKiAgICBlbmRwb2ludDogJ2xvZ2luJyxcbiAqICAgIG1ldGhvZDogJ3Bvc3QnLFxuICogICAgcmVxdWlyZVZhbGlkVG9rZW46IHRydWUsXG4gKiAgICByZWRpcmVjdDoge1xuICogICAgICBzdWNjZXNzOiAnLycsXG4gKiAgICAgIGZhaWx1cmU6IG51bGwsXG4gKiAgICB9LFxuICogICAgZGVmYXVsdEVycm9yczogWydMb2dpbi9FbWFpbCBjb21iaW5hdGlvbiBpcyBub3QgY29ycmVjdCwgcGxlYXNlIHRyeSBhZ2Fpbi4nXSxcbiAqICAgIGRlZmF1bHRNZXNzYWdlczogWydZb3UgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBsb2dnZWQgaW4uJ10sXG4gKiAgfTtcbiAqICByZWdpc3Rlcj86IGJvb2xlYW4gfCBOYlBhc3N3b3JkU3RyYXRlZ3lNb2R1bGUgPSB7XG4gKiAgICBhbHdheXNGYWlsOiBmYWxzZSxcbiAqICAgIGVuZHBvaW50OiAncmVnaXN0ZXInLFxuICogICAgbWV0aG9kOiAncG9zdCcsXG4gKiAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAqICAgIHJlZGlyZWN0OiB7XG4gKiAgICAgIHN1Y2Nlc3M6ICcvJyxcbiAqICAgICAgZmFpbHVyZTogbnVsbCxcbiAqICAgIH0sXG4gKiAgICBkZWZhdWx0RXJyb3JzOiBbJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluLiddLFxuICogICAgZGVmYXVsdE1lc3NhZ2VzOiBbJ1lvdSBoYXZlIGJlZW4gc3VjY2Vzc2Z1bGx5IHJlZ2lzdGVyZWQuJ10sXG4gKiAgfTtcbiAqICByZXF1ZXN0UGFzcz86IGJvb2xlYW4gfCBOYlBhc3N3b3JkU3RyYXRlZ3lNb2R1bGUgPSB7XG4gKiAgICBlbmRwb2ludDogJ3JlcXVlc3QtcGFzcycsXG4gKiAgICBtZXRob2Q6ICdwb3N0JyxcbiAqICAgIHJlZGlyZWN0OiB7XG4gKiAgICAgIHN1Y2Nlc3M6ICcvJyxcbiAqICAgICAgZmFpbHVyZTogbnVsbCxcbiAqICAgIH0sXG4gKiAgICBkZWZhdWx0RXJyb3JzOiBbJ1NvbWV0aGluZyB3ZW50IHdyb25nLCBwbGVhc2UgdHJ5IGFnYWluLiddLFxuICogICAgZGVmYXVsdE1lc3NhZ2VzOiBbJ1Jlc2V0IHBhc3N3b3JkIGluc3RydWN0aW9ucyBoYXZlIGJlZW4gc2VudCB0byB5b3VyIGVtYWlsLiddLFxuICogIH07XG4gKiAgcmVzZXRQYXNzPzogYm9vbGVhbiB8IE5iUGFzc3dvcmRTdHJhdGVneVJlc2V0ID0ge1xuICogICAgZW5kcG9pbnQ6ICdyZXNldC1wYXNzJyxcbiAqICAgIG1ldGhvZDogJ3B1dCcsXG4gKiAgICByZWRpcmVjdDoge1xuICogICAgICBzdWNjZXNzOiAnLycsXG4gKiAgICAgIGZhaWx1cmU6IG51bGwsXG4gKiAgICB9LFxuICogICAgcmVzZXRQYXNzd29yZFRva2VuS2V5OiAncmVzZXRfcGFzc3dvcmRfdG9rZW4nLFxuICogICAgZGVmYXVsdEVycm9yczogWydTb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2Fpbi4nXSxcbiAqICAgIGRlZmF1bHRNZXNzYWdlczogWydZb3VyIHBhc3N3b3JkIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBjaGFuZ2VkLiddLFxuICogIH07XG4gKiAgbG9nb3V0PzogYm9vbGVhbiB8IE5iUGFzc3dvcmRTdHJhdGVneVJlc2V0ID0ge1xuICogICAgYWx3YXlzRmFpbDogZmFsc2UsXG4gKiAgICBlbmRwb2ludDogJ2xvZ291dCcsXG4gKiAgICBtZXRob2Q6ICdkZWxldGUnLFxuICogICAgcmVkaXJlY3Q6IHtcbiAqICAgICAgc3VjY2VzczogJy8nLFxuICogICAgICBmYWlsdXJlOiBudWxsLFxuICogICAgfSxcbiAqICAgIGRlZmF1bHRFcnJvcnM6IFsnU29tZXRoaW5nIHdlbnQgd3JvbmcsIHBsZWFzZSB0cnkgYWdhaW4uJ10sXG4gKiAgICBkZWZhdWx0TWVzc2FnZXM6IFsnWW91IGhhdmUgYmVlbiBzdWNjZXNzZnVsbHkgbG9nZ2VkIG91dC4nXSxcbiAqICB9O1xuICogIHJlZnJlc2hUb2tlbj86IGJvb2xlYW4gfCBOYlBhc3N3b3JkU3RyYXRlZ3lNb2R1bGUgPSB7XG4gKiAgICBlbmRwb2ludDogJ3JlZnJlc2gtdG9rZW4nLFxuICogICAgbWV0aG9kOiAncG9zdCcsXG4gKiAgICByZXF1aXJlVmFsaWRUb2tlbjogdHJ1ZSxcbiAqICAgIHJlZGlyZWN0OiB7XG4gKiAgICAgIHN1Y2Nlc3M6IG51bGwsXG4gKiAgICAgIGZhaWx1cmU6IG51bGwsXG4gKiAgICB9LFxuICogICAgZGVmYXVsdEVycm9yczogWydTb21ldGhpbmcgd2VudCB3cm9uZywgcGxlYXNlIHRyeSBhZ2Fpbi4nXSxcbiAqICAgIGRlZmF1bHRNZXNzYWdlczogWydZb3VyIHRva2VuIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSByZWZyZXNoZWQuJ10sXG4gKiAgfTtcbiAqICB0b2tlbj86IE5iUGFzc3dvcmRTdHJhdGVneVRva2VuID0ge1xuICogICAgY2xhc3M6IE5iQXV0aFNpbXBsZVRva2VuLFxuICogICAga2V5OiAnZGF0YS50b2tlbicsXG4gKiAgICBnZXR0ZXI6IChtb2R1bGU6IHN0cmluZywgcmVzOiBIdHRwUmVzcG9uc2U8T2JqZWN0Piwgb3B0aW9uczogTmJQYXNzd29yZEF1dGhTdHJhdGVneU9wdGlvbnMpID0+IGdldERlZXBGcm9tT2JqZWN0KFxuICogICAgICByZXMuYm9keSxcbiAqICAgICAgb3B0aW9ucy50b2tlbi5rZXksXG4gKiAgICApLFxuICogIH07XG4gKiAgZXJyb3JzPzogTmJQYXNzd29yZFN0cmF0ZWd5TWVzc2FnZSA9IHtcbiAqICAgIGtleTogJ2RhdGEuZXJyb3JzJyxcbiAqICAgIGdldHRlcjogKG1vZHVsZTogc3RyaW5nLCByZXM6IEh0dHBFcnJvclJlc3BvbnNlLCBvcHRpb25zOiBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5T3B0aW9ucykgPT4gZ2V0RGVlcEZyb21PYmplY3QoXG4gKiAgICAgIHJlcy5lcnJvcixcbiAqICAgICAgb3B0aW9ucy5lcnJvcnMua2V5LFxuICogICAgICBvcHRpb25zW21vZHVsZV0uZGVmYXVsdEVycm9ycyxcbiAqICAgICksXG4gKiAgfTtcbiAqICBtZXNzYWdlcz86IE5iUGFzc3dvcmRTdHJhdGVneU1lc3NhZ2UgPSB7XG4gKiAgICBrZXk6ICdkYXRhLm1lc3NhZ2VzJyxcbiAqICAgIGdldHRlcjogKG1vZHVsZTogc3RyaW5nLCByZXM6IEh0dHBSZXNwb25zZTxPYmplY3Q+LCBvcHRpb25zOiBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5T3B0aW9ucykgPT4gZ2V0RGVlcEZyb21PYmplY3QoXG4gKiAgICAgIHJlcy5ib2R5LFxuICogICAgICBvcHRpb25zLm1lc3NhZ2VzLmtleSxcbiAqICAgICAgb3B0aW9uc1ttb2R1bGVdLmRlZmF1bHRNZXNzYWdlcyxcbiAqICAgICksXG4gKiAgfTtcbiAqICB2YWxpZGF0aW9uPzoge1xuICogICAgcGFzc3dvcmQ/OiB7XG4gKiAgICAgIHJlcXVpcmVkPzogYm9vbGVhbjtcbiAqICAgICAgbWluTGVuZ3RoPzogbnVtYmVyIHwgbnVsbDtcbiAqICAgICAgbWF4TGVuZ3RoPzogbnVtYmVyIHwgbnVsbDtcbiAqICAgICAgcmVnZXhwPzogc3RyaW5nIHwgbnVsbDtcbiAqICAgIH07XG4gKiAgICBlbWFpbD86IHtcbiAqICAgICAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICogICAgICByZWdleHA/OiBzdHJpbmcgfCBudWxsO1xuICogICAgfTtcbiAqICAgIGZ1bGxOYW1lPzoge1xuICogICAgICByZXF1aXJlZD86IGJvb2xlYW47XG4gKiAgICAgIG1pbkxlbmd0aD86IG51bWJlciB8IG51bGw7XG4gKiAgICAgIG1heExlbmd0aD86IG51bWJlciB8IG51bGw7XG4gKiAgICAgIHJlZ2V4cD86IHN0cmluZyB8IG51bGw7XG4gKiAgICB9O1xuICogIH07XG4gKn1cbiAqIGBgYFxuICovXG52YXIgTmJQYXNzd29yZEF1dGhTdHJhdGVneSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmJQYXNzd29yZEF1dGhTdHJhdGVneSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5KGh0dHAsIHJvdXRlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmh0dHAgPSBodHRwO1xuICAgICAgICBfdGhpcy5yb3V0ZSA9IHJvdXRlO1xuICAgICAgICBfdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHBhc3N3b3JkU3RyYXRlZ3lPcHRpb25zO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3lfMSA9IE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3k7XG4gICAgTmJQYXNzd29yZEF1dGhTdHJhdGVneS5zZXR1cCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBbTmJQYXNzd29yZEF1dGhTdHJhdGVneV8xLCBvcHRpb25zXTtcbiAgICB9O1xuICAgIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmF1dGhlbnRpY2F0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtb2R1bGUgPSAnbG9naW4nO1xuICAgICAgICB2YXIgbWV0aG9kID0gdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIubWV0aG9kXCIpO1xuICAgICAgICB2YXIgdXJsID0gdGhpcy5nZXRBY3Rpb25FbmRwb2ludChtb2R1bGUpO1xuICAgICAgICB2YXIgcmVxdWlyZVZhbGlkVG9rZW4gPSB0aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZXF1aXJlVmFsaWRUb2tlblwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KG1ldGhvZCwgdXJsLCB7IGJvZHk6IGRhdGEsIG9ic2VydmU6ICdyZXNwb25zZScgfSlcbiAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLmFsd2F5c0ZhaWxcIikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBfdGhpcy5jcmVhdGVGYWlsUmVzcG9uc2UoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9KSwgbWFwKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTmJBdXRoUmVzdWx0KHRydWUsIHJlcywgX3RoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLnJlZGlyZWN0LnN1Y2Nlc3NcIiksIFtdLCBfdGhpcy5nZXRPcHRpb24oJ21lc3NhZ2VzLmdldHRlcicpKG1vZHVsZSwgcmVzLCBfdGhpcy5vcHRpb25zKSwgX3RoaXMuY3JlYXRlVG9rZW4oX3RoaXMuZ2V0T3B0aW9uKCd0b2tlbi5nZXR0ZXInKShtb2R1bGUsIHJlcywgX3RoaXMub3B0aW9ucyksIHJlcXVpcmVWYWxpZFRva2VuKSk7XG4gICAgICAgIH0pLCBjYXRjaEVycm9yKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlcywgbW9kdWxlKTtcbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgTmJQYXNzd29yZEF1dGhTdHJhdGVneS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbW9kdWxlID0gJ3JlZ2lzdGVyJztcbiAgICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLm1ldGhvZFwiKTtcbiAgICAgICAgdmFyIHVybCA9IHRoaXMuZ2V0QWN0aW9uRW5kcG9pbnQobW9kdWxlKTtcbiAgICAgICAgdmFyIHJlcXVpcmVWYWxpZFRva2VuID0gdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIucmVxdWlyZVZhbGlkVG9rZW5cIik7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChtZXRob2QsIHVybCwgeyBib2R5OiBkYXRhLCBvYnNlcnZlOiAncmVzcG9uc2UnIH0pXG4gICAgICAgICAgICAucGlwZShtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYgKF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5hbHdheXNGYWlsXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgX3RoaXMuY3JlYXRlRmFpbFJlc3BvbnNlKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfSksIG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdCh0cnVlLCByZXMsIF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZWRpcmVjdC5zdWNjZXNzXCIpLCBbXSwgX3RoaXMuZ2V0T3B0aW9uKCdtZXNzYWdlcy5nZXR0ZXInKShtb2R1bGUsIHJlcywgX3RoaXMub3B0aW9ucyksIF90aGlzLmNyZWF0ZVRva2VuKF90aGlzLmdldE9wdGlvbigndG9rZW4uZ2V0dGVyJykoJ2xvZ2luJywgcmVzLCBfdGhpcy5vcHRpb25zKSwgcmVxdWlyZVZhbGlkVG9rZW4pKTtcbiAgICAgICAgfSksIGNhdGNoRXJyb3IoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzLCBtb2R1bGUpO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5yZXF1ZXN0UGFzc3dvcmQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbW9kdWxlID0gJ3JlcXVlc3RQYXNzJztcbiAgICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLm1ldGhvZFwiKTtcbiAgICAgICAgdmFyIHVybCA9IHRoaXMuZ2V0QWN0aW9uRW5kcG9pbnQobW9kdWxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KG1ldGhvZCwgdXJsLCB7IGJvZHk6IGRhdGEsIG9ic2VydmU6ICdyZXNwb25zZScgfSlcbiAgICAgICAgICAgIC5waXBlKG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLmFsd2F5c0ZhaWxcIikpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBfdGhpcy5jcmVhdGVGYWlsUmVzcG9uc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH0pLCBtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYkF1dGhSZXN1bHQodHJ1ZSwgcmVzLCBfdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIucmVkaXJlY3Quc3VjY2Vzc1wiKSwgW10sIF90aGlzLmdldE9wdGlvbignbWVzc2FnZXMuZ2V0dGVyJykobW9kdWxlLCByZXMsIF90aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgfSksIGNhdGNoRXJyb3IoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhhbmRsZVJlc3BvbnNlRXJyb3IocmVzLCBtb2R1bGUpO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5LnByb3RvdHlwZS5yZXNldFBhc3N3b3JkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGRhdGEgPT09IHZvaWQgMCkgeyBkYXRhID0ge307IH1cbiAgICAgICAgdmFyIG1vZHVsZSA9ICdyZXNldFBhc3MnO1xuICAgICAgICB2YXIgbWV0aG9kID0gdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIubWV0aG9kXCIpO1xuICAgICAgICB2YXIgdXJsID0gdGhpcy5nZXRBY3Rpb25FbmRwb2ludChtb2R1bGUpO1xuICAgICAgICB2YXIgdG9rZW5LZXkgPSB0aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZXNldFBhc3N3b3JkVG9rZW5LZXlcIik7XG4gICAgICAgIGRhdGFbdG9rZW5LZXldID0gdGhpcy5yb3V0ZS5zbmFwc2hvdC5xdWVyeVBhcmFtc1t0b2tlbktleV07XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChtZXRob2QsIHVybCwgeyBib2R5OiBkYXRhLCBvYnNlcnZlOiAncmVzcG9uc2UnIH0pXG4gICAgICAgICAgICAucGlwZShtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYgKF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5hbHdheXNGYWlsXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgX3RoaXMuY3JlYXRlRmFpbFJlc3BvbnNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9KSwgbWFwKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTmJBdXRoUmVzdWx0KHRydWUsIHJlcywgX3RoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLnJlZGlyZWN0LnN1Y2Nlc3NcIiksIFtdLCBfdGhpcy5nZXRPcHRpb24oJ21lc3NhZ2VzLmdldHRlcicpKG1vZHVsZSwgcmVzLCBfdGhpcy5vcHRpb25zKSk7XG4gICAgICAgIH0pLCBjYXRjaEVycm9yKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVSZXNwb25zZUVycm9yKHJlcywgbW9kdWxlKTtcbiAgICAgICAgfSkpO1xuICAgIH07XG4gICAgTmJQYXNzd29yZEF1dGhTdHJhdGVneS5wcm90b3R5cGUubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbW9kdWxlID0gJ2xvZ291dCc7XG4gICAgICAgIHZhciBtZXRob2QgPSB0aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5tZXRob2RcIik7XG4gICAgICAgIHZhciB1cmwgPSB0aGlzLmdldEFjdGlvbkVuZHBvaW50KG1vZHVsZSk7XG4gICAgICAgIHJldHVybiBvZih7fSlcbiAgICAgICAgICAgIC5waXBlKHN3aXRjaE1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBpZiAoIXVybCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvZihyZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmh0dHAucmVxdWVzdChtZXRob2QsIHVybCwgeyBvYnNlcnZlOiAncmVzcG9uc2UnIH0pO1xuICAgICAgICB9KSwgbWFwKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIuYWx3YXlzRmFpbFwiKSkge1xuICAgICAgICAgICAgICAgIHRocm93IF90aGlzLmNyZWF0ZUZhaWxSZXNwb25zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfSksIG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdCh0cnVlLCByZXMsIF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZWRpcmVjdC5zdWNjZXNzXCIpLCBbXSwgX3RoaXMuZ2V0T3B0aW9uKCdtZXNzYWdlcy5nZXR0ZXInKShtb2R1bGUsIHJlcywgX3RoaXMub3B0aW9ucykpO1xuICAgICAgICB9KSwgY2F0Y2hFcnJvcihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXMsIG1vZHVsZSk7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3kucHJvdG90eXBlLnJlZnJlc2hUb2tlbiA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBtb2R1bGUgPSAncmVmcmVzaFRva2VuJztcbiAgICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuZ2V0T3B0aW9uKG1vZHVsZSArIFwiLm1ldGhvZFwiKTtcbiAgICAgICAgdmFyIHVybCA9IHRoaXMuZ2V0QWN0aW9uRW5kcG9pbnQobW9kdWxlKTtcbiAgICAgICAgdmFyIHJlcXVpcmVWYWxpZFRva2VuID0gdGhpcy5nZXRPcHRpb24obW9kdWxlICsgXCIucmVxdWlyZVZhbGlkVG9rZW5cIik7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChtZXRob2QsIHVybCwgeyBib2R5OiBkYXRhLCBvYnNlcnZlOiAncmVzcG9uc2UnIH0pXG4gICAgICAgICAgICAucGlwZShtYXAoZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYgKF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5hbHdheXNGYWlsXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgX3RoaXMuY3JlYXRlRmFpbFJlc3BvbnNlKGRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfSksIG1hcChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5iQXV0aFJlc3VsdCh0cnVlLCByZXMsIF90aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZWRpcmVjdC5zdWNjZXNzXCIpLCBbXSwgX3RoaXMuZ2V0T3B0aW9uKCdtZXNzYWdlcy5nZXR0ZXInKShtb2R1bGUsIHJlcywgX3RoaXMub3B0aW9ucyksIF90aGlzLmNyZWF0ZVRva2VuKF90aGlzLmdldE9wdGlvbigndG9rZW4uZ2V0dGVyJykobW9kdWxlLCByZXMsIF90aGlzLm9wdGlvbnMpLCByZXF1aXJlVmFsaWRUb2tlbikpO1xuICAgICAgICB9KSwgY2F0Y2hFcnJvcihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuaGFuZGxlUmVzcG9uc2VFcnJvcihyZXMsIG1vZHVsZSk7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3kucHJvdG90eXBlLmhhbmRsZVJlc3BvbnNlRXJyb3IgPSBmdW5jdGlvbiAocmVzLCBtb2R1bGUpIHtcbiAgICAgICAgdmFyIGVycm9ycyA9IFtdO1xuICAgICAgICBpZiAocmVzIGluc3RhbmNlb2YgSHR0cEVycm9yUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGVycm9ycyA9IHRoaXMuZ2V0T3B0aW9uKCdlcnJvcnMuZ2V0dGVyJykobW9kdWxlLCByZXMsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzIGluc3RhbmNlb2YgTmJBdXRoSWxsZWdhbFRva2VuRXJyb3IpIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKHJlcy5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKCdTb21ldGhpbmcgd2VudCB3cm9uZy4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2YobmV3IE5iQXV0aFJlc3VsdChmYWxzZSwgcmVzLCB0aGlzLmdldE9wdGlvbihtb2R1bGUgKyBcIi5yZWRpcmVjdC5mYWlsdXJlXCIpLCBlcnJvcnMpKTtcbiAgICB9O1xuICAgIHZhciBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5XzE7XG4gICAgTmJQYXNzd29yZEF1dGhTdHJhdGVneSA9IE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3lfMSA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBJbmplY3RhYmxlKCksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbSHR0cENsaWVudCwgQWN0aXZhdGVkUm91dGVdKVxuICAgIF0sIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3kpO1xuICAgIHJldHVybiBOYlBhc3N3b3JkQXV0aFN0cmF0ZWd5O1xufShOYkF1dGhTdHJhdGVneSkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJBdXRoQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIC8vIHNob3djYXNlIG9mIGhvdyB0byB1c2UgdGhlIG9uQXV0aGVudGljYXRpb25DaGFuZ2UgbWV0aG9kXG4gICAgZnVuY3Rpb24gTmJBdXRoQ29tcG9uZW50KGF1dGgsIGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XG4gICAgICAgIHRoaXMubG9jYXRpb24gPSBsb2NhdGlvbjtcbiAgICAgICAgdGhpcy5kZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRva2VuID0gJyc7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gYXV0aC5vbkF1dGhlbnRpY2F0aW9uQ2hhbmdlKClcbiAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKGF1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICAgIF90aGlzLmF1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGVkO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgTmJBdXRoQ29tcG9uZW50LnByb3RvdHlwZS5iYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvY2F0aW9uLmJhY2soKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgTmJBdXRoQ29tcG9uZW50LnByb3RvdHlwZS5uZ09uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9O1xuICAgIE5iQXV0aENvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBDb21wb25lbnQoe1xuICAgICAgICAgICAgc2VsZWN0b3I6ICduYi1hdXRoJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIlxcbiAgICA8bmItbGF5b3V0PlxcbiAgICAgIDxuYi1sYXlvdXQtY29sdW1uPlxcbiAgICAgICAgPG5iLWNhcmQ+XFxuICAgICAgICAgIDxuYi1jYXJkLWhlYWRlcj5cXG4gICAgICAgICAgICA8bmF2IGNsYXNzPVxcXCJuYXZpZ2F0aW9uXFxcIj5cXG4gICAgICAgICAgICAgIDxhIGhyZWY9XFxcIiNcXFwiIChjbGljayk9XFxcImJhY2soKVxcXCIgY2xhc3M9XFxcImxpbmsgYmFjay1saW5rXFxcIiBhcmlhLWxhYmVsPVxcXCJCYWNrXFxcIj5cXG4gICAgICAgICAgICAgICAgPG5iLWljb24gaWNvbj1cXFwiYXJyb3ctYmFja1xcXCI+PC9uYi1pY29uPlxcbiAgICAgICAgICAgICAgPC9hPlxcbiAgICAgICAgICAgIDwvbmF2PlxcbiAgICAgICAgICA8L25iLWNhcmQtaGVhZGVyPlxcbiAgICAgICAgICA8bmItY2FyZC1ib2R5PlxcbiAgICAgICAgICAgIDxuYi1hdXRoLWJsb2NrPlxcbiAgICAgICAgICAgICAgPHJvdXRlci1vdXRsZXQ+PC9yb3V0ZXItb3V0bGV0PlxcbiAgICAgICAgICAgIDwvbmItYXV0aC1ibG9jaz5cXG4gICAgICAgICAgPC9uYi1jYXJkLWJvZHk+XFxuICAgICAgICA8L25iLWNhcmQ+XFxuICAgICAgPC9uYi1sYXlvdXQtY29sdW1uPlxcbiAgICA8L25iLWxheW91dD5cXG4gIFwiLFxuICAgICAgICAgICAgc3R5bGVzOiBbXCIvKiFcXG4gKiBAbGljZW5zZVxcbiAqIENvcHlyaWdodCBBa3Zlby4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxcbiAqLzpob3N0IG5iLWNhcmR7bWFyZ2luOjA7aGVpZ2h0OmNhbGMoMTAwdmggLSAyICogMi41cmVtKX06aG9zdCAubmF2aWdhdGlvbiAubGlua3tkaXNwbGF5OmlubGluZS1ibG9jazt0ZXh0LWRlY29yYXRpb246bm9uZX06aG9zdCAubmF2aWdhdGlvbiAubGluayBuYi1pY29ue2ZvbnQtc2l6ZToycmVtO3ZlcnRpY2FsLWFsaWduOm1pZGRsZX06aG9zdCAubGlua3MgbmItaWNvbntmb250LXNpemU6Mi41cmVtfTpob3N0IG5iLWNhcmQtYm9keXtkaXNwbGF5OmZsZXg7d2lkdGg6MTAwJX06aG9zdCBuYi1hdXRoLWJsb2Nre21hcmdpbjphdXRvfUBtZWRpYSAobWF4LXdpZHRoOiA3NjcuOThweCl7Omhvc3QgbmItY2FyZHtib3JkZXItcmFkaXVzOjA7aGVpZ2h0OjEwMHZofX06aG9zdCA6Om5nLWRlZXAgbmItbGF5b3V0IC5sYXlvdXQgLmxheW91dC1jb250YWluZXIgLmNvbnRlbnQgLmNvbHVtbnMgbmItbGF5b3V0LWNvbHVtbntwYWRkaW5nOjIuNXJlbX1AbWVkaWEgKG1heC13aWR0aDogNzY3Ljk4cHgpezpob3N0IDo6bmctZGVlcCBuYi1sYXlvdXQgLmxheW91dCAubGF5b3V0LWNvbnRhaW5lciAuY29udGVudCAuY29sdW1ucyBuYi1sYXlvdXQtY29sdW1ue3BhZGRpbmc6MH19XFxuXCJdXG4gICAgICAgIH0pLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05iQXV0aFNlcnZpY2UsIExvY2F0aW9uXSlcbiAgICBdLCBOYkF1dGhDb21wb25lbnQpO1xuICAgIHJldHVybiBOYkF1dGhDb21wb25lbnQ7XG59KCkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJBdXRoQmxvY2tDb21wb25lbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmJBdXRoQmxvY2tDb21wb25lbnQoKSB7XG4gICAgfVxuICAgIE5iQXV0aEJsb2NrQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgICAgIENvbXBvbmVudCh7XG4gICAgICAgICAgICBzZWxlY3RvcjogJ25iLWF1dGgtYmxvY2snLFxuICAgICAgICAgICAgdGVtcGxhdGU6IFwiXFxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cXG4gIFwiLFxuICAgICAgICAgICAgc3R5bGVzOiBbXCI6aG9zdHtkaXNwbGF5OmJsb2NrO3dpZHRoOjEwMCU7bWF4LXdpZHRoOjM1cmVtfTpob3N0IDo6bmctZGVlcCBmb3Jte3dpZHRoOjEwMCV9Omhvc3QgOjpuZy1kZWVwIC5sYWJlbHtkaXNwbGF5OmJsb2NrO21hcmdpbi1ib3R0b206MC41cmVtfTpob3N0IDo6bmctZGVlcCAuZm9yZ290LXBhc3N3b3Jke3RleHQtZGVjb3JhdGlvbjpub25lO21hcmdpbi1ib3R0b206MC41cmVtfTpob3N0IDo6bmctZGVlcCAuY2FwdGlvbnttYXJnaW4tdG9wOjAuNXJlbX06aG9zdCA6Om5nLWRlZXAgLmFsZXJ0e3RleHQtYWxpZ246Y2VudGVyfTpob3N0IDo6bmctZGVlcCAudGl0bGV7bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MC43NXJlbTt0ZXh0LWFsaWduOmNlbnRlcn06aG9zdCA6Om5nLWRlZXAgLnN1Yi10aXRsZXttYXJnaW4tYm90dG9tOjJyZW07dGV4dC1hbGlnbjpjZW50ZXJ9Omhvc3QgOjpuZy1kZWVwIC5mb3JtLWNvbnRyb2wtZ3JvdXB7bWFyZ2luLWJvdHRvbToycmVtfTpob3N0IDo6bmctZGVlcCAuZm9ybS1jb250cm9sLWdyb3VwLmFjY2VwdC1ncm91cHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47bWFyZ2luOjJyZW0gMH06aG9zdCA6Om5nLWRlZXAgLmxhYmVsLXdpdGgtbGlua3tkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW59Omhvc3QgOjpuZy1kZWVwIC5saW5rc3t0ZXh0LWFsaWduOmNlbnRlcjttYXJnaW4tdG9wOjEuNzVyZW19Omhvc3QgOjpuZy1kZWVwIC5saW5rcyAuc29jaWFsc3ttYXJnaW4tdG9wOjEuNXJlbX06aG9zdCA6Om5nLWRlZXAgLmxpbmtzIC5zb2NpYWxzIGF7bWFyZ2luOjAgMXJlbTt0ZXh0LWRlY29yYXRpb246bm9uZTt2ZXJ0aWNhbC1hbGlnbjptaWRkbGV9Omhvc3QgOjpuZy1kZWVwIC5saW5rcyAuc29jaWFscyBhLndpdGgtaWNvbntmb250LXNpemU6MnJlbX06aG9zdCA6Om5nLWRlZXAgLmFub3RoZXItYWN0aW9ue21hcmdpbi10b3A6MnJlbTt0ZXh0LWFsaWduOmNlbnRlcn06aG9zdCA6Om5nLWRlZXAgLnNpZ24taW4tb3ItdXB7bWFyZ2luLXRvcDoycmVtO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn06aG9zdCA6Om5nLWRlZXAgbmItYWxlcnQgLmFsZXJ0LXRpdGxlLDpob3N0IDo6bmctZGVlcCBuYi1hbGVydCAuYWxlcnQtbWVzc2FnZXttYXJnaW46MCAwIDAuNXJlbX06aG9zdCA6Om5nLWRlZXAgbmItYWxlcnQgLmFsZXJ0LW1lc3NhZ2UtbGlzdHtsaXN0LXN0eWxlLXR5cGU6bm9uZTtwYWRkaW5nOjA7bWFyZ2luOjB9XFxuXCJdXG4gICAgICAgIH0pXG4gICAgXSwgTmJBdXRoQmxvY2tDb21wb25lbnQpO1xuICAgIHJldHVybiBOYkF1dGhCbG9ja0NvbXBvbmVudDtcbn0oKSk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBBa3Zlby4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi9cbnZhciBOYkxvZ2luQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iTG9naW5Db21wb25lbnQoc2VydmljZSwgb3B0aW9ucywgY2QsIHJvdXRlcikge1xuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNkID0gY2Q7XG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgICAgICB0aGlzLnJlZGlyZWN0RGVsYXkgPSAwO1xuICAgICAgICB0aGlzLnNob3dNZXNzYWdlcyA9IHt9O1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gJyc7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gW107XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICAgICAgdGhpcy51c2VyID0ge307XG4gICAgICAgIHRoaXMuc3VibWl0dGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc29jaWFsTGlua3MgPSBbXTtcbiAgICAgICAgdGhpcy5yZW1lbWJlck1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVkaXJlY3REZWxheSA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLmxvZ2luLnJlZGlyZWN0RGVsYXknKTtcbiAgICAgICAgdGhpcy5zaG93TWVzc2FnZXMgPSB0aGlzLmdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5sb2dpbi5zaG93TWVzc2FnZXMnKTtcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLmxvZ2luLnN0cmF0ZWd5Jyk7XG4gICAgICAgIHRoaXMuc29jaWFsTGlua3MgPSB0aGlzLmdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5sb2dpbi5zb2NpYWxMaW5rcycpO1xuICAgICAgICB0aGlzLnJlbWVtYmVyTWUgPSB0aGlzLmdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5sb2dpbi5yZW1lbWJlck1lJyk7XG4gICAgfVxuICAgIE5iTG9naW5Db21wb25lbnQucHJvdG90eXBlLmxvZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIHRoaXMuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmF1dGhlbnRpY2F0ZSh0aGlzLnN0cmF0ZWd5LCB0aGlzLnVzZXIpLnN1YnNjcmliZShmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBfdGhpcy5zdWJtaXR0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuaXNTdWNjZXNzKCkpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5tZXNzYWdlcyA9IHJlc3VsdC5nZXRNZXNzYWdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZXJyb3JzID0gcmVzdWx0LmdldEVycm9ycygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlZGlyZWN0ID0gcmVzdWx0LmdldFJlZGlyZWN0KCk7XG4gICAgICAgICAgICBpZiAocmVkaXJlY3QpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKHJlZGlyZWN0KTtcbiAgICAgICAgICAgICAgICB9LCBfdGhpcy5yZWRpcmVjdERlbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBOYkxvZ2luQ29tcG9uZW50LnByb3RvdHlwZS5nZXRDb25maWdWYWx1ZSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuIGdldERlZXBGcm9tT2JqZWN0KHRoaXMub3B0aW9ucywga2V5LCBudWxsKTtcbiAgICB9O1xuICAgIE5iTG9naW5Db21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnbmItbG9naW4nLFxuICAgICAgICAgICAgdGVtcGxhdGU6IFwiPGgxIGlkPVxcXCJ0aXRsZVxcXCIgY2xhc3M9XFxcInRpdGxlXFxcIj5Mb2dpbjwvaDE+XFxuPHAgY2xhc3M9XFxcInN1Yi10aXRsZVxcXCI+SGVsbG8hIExvZyBpbiB3aXRoIHlvdXIgZW1haWwuPC9wPlxcblxcbjxuYi1hbGVydCAqbmdJZj1cXFwic2hvd01lc3NhZ2VzLmVycm9yICYmIGVycm9ycz8ubGVuZ3RoICYmICFzdWJtaXR0ZWRcXFwiIG91dGxpbmU9XFxcImRhbmdlclxcXCIgcm9sZT1cXFwiYWxlcnRcXFwiPlxcbiAgPHAgY2xhc3M9XFxcImFsZXJ0LXRpdGxlXFxcIj48Yj5PaCBzbmFwITwvYj48L3A+XFxuICA8dWwgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2UtbGlzdFxcXCI+XFxuICAgIDxsaSAqbmdGb3I9XFxcImxldCBlcnJvciBvZiBlcnJvcnNcXFwiIGNsYXNzPVxcXCJhbGVydC1tZXNzYWdlXFxcIj57eyBlcnJvciB9fTwvbGk+XFxuICA8L3VsPlxcbjwvbmItYWxlcnQ+XFxuXFxuPG5iLWFsZXJ0ICpuZ0lmPVxcXCJzaG93TWVzc2FnZXMuc3VjY2VzcyAmJiBtZXNzYWdlcz8ubGVuZ3RoICYmICFzdWJtaXR0ZWRcXFwiIG91dGxpbmU9XFxcInN1Y2Nlc3NcXFwiIHJvbGU9XFxcImFsZXJ0XFxcIj5cXG4gIDxwIGNsYXNzPVxcXCJhbGVydC10aXRsZVxcXCI+PGI+SG9vcmF5ITwvYj48L3A+XFxuICA8dWwgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2UtbGlzdFxcXCI+XFxuICAgIDxsaSAqbmdGb3I9XFxcImxldCBtZXNzYWdlIG9mIG1lc3NhZ2VzXFxcIiBjbGFzcz1cXFwiYWxlcnQtbWVzc2FnZVxcXCI+e3sgbWVzc2FnZSB9fTwvbGk+XFxuICA8L3VsPlxcbjwvbmItYWxlcnQ+XFxuXFxuPGZvcm0gKG5nU3VibWl0KT1cXFwibG9naW4oKVxcXCIgI2Zvcm09XFxcIm5nRm9ybVxcXCIgYXJpYS1sYWJlbGxlZGJ5PVxcXCJ0aXRsZVxcXCI+XFxuXFxuICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWNvbnRyb2wtZ3JvdXBcXFwiPlxcbiAgICA8bGFiZWwgY2xhc3M9XFxcImxhYmVsXFxcIiBmb3I9XFxcImlucHV0LWVtYWlsXFxcIj5FbWFpbCBhZGRyZXNzOjwvbGFiZWw+XFxuICAgIDxpbnB1dCBuYklucHV0XFxuICAgICAgICAgICBmdWxsV2lkdGhcXG4gICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJ1c2VyLmVtYWlsXFxcIlxcbiAgICAgICAgICAgI2VtYWlsPVxcXCJuZ01vZGVsXFxcIlxcbiAgICAgICAgICAgbmFtZT1cXFwiZW1haWxcXFwiXFxuICAgICAgICAgICBpZD1cXFwiaW5wdXQtZW1haWxcXFwiXFxuICAgICAgICAgICBwYXR0ZXJuPVxcXCIuK0AuK1xcXFwuLitcXFwiXFxuICAgICAgICAgICBwbGFjZWhvbGRlcj1cXFwiRW1haWwgYWRkcmVzc1xcXCJcXG4gICAgICAgICAgIGZpZWxkU2l6ZT1cXFwibGFyZ2VcXFwiXFxuICAgICAgICAgICBhdXRvZm9jdXNcXG4gICAgICAgICAgIFtzdGF0dXNdPVxcXCJlbWFpbC5kaXJ0eSA/IChlbWFpbC5pbnZhbGlkICA/ICdkYW5nZXInIDogJ3N1Y2Nlc3MnKSA6ICdiYXNpYydcXFwiXFxuICAgICAgICAgICBbcmVxdWlyZWRdPVxcXCJnZXRDb25maWdWYWx1ZSgnZm9ybXMudmFsaWRhdGlvbi5lbWFpbC5yZXF1aXJlZCcpXFxcIlxcbiAgICAgICAgICAgW2F0dHIuYXJpYS1pbnZhbGlkXT1cXFwiZW1haWwuaW52YWxpZCAmJiBlbWFpbC50b3VjaGVkID8gdHJ1ZSA6IG51bGxcXFwiPlxcbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVxcXCJlbWFpbC5pbnZhbGlkICYmIGVtYWlsLnRvdWNoZWRcXFwiPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJlbWFpbC5lcnJvcnM/LnJlcXVpcmVkXFxcIj5cXG4gICAgICAgIEVtYWlsIGlzIHJlcXVpcmVkIVxcbiAgICAgIDwvcD5cXG4gICAgICA8cCBjbGFzcz1cXFwiY2FwdGlvbiBzdGF0dXMtZGFuZ2VyXFxcIiAqbmdJZj1cXFwiZW1haWwuZXJyb3JzPy5wYXR0ZXJuXFxcIj5cXG4gICAgICAgIEVtYWlsIHNob3VsZCBiZSB0aGUgcmVhbCBvbmUhXFxuICAgICAgPC9wPlxcbiAgICA8L25nLWNvbnRhaW5lcj5cXG4gIDwvZGl2PlxcblxcbiAgPGRpdiBjbGFzcz1cXFwiZm9ybS1jb250cm9sLWdyb3VwXFxcIj5cXG4gICAgPHNwYW4gY2xhc3M9XFxcImxhYmVsLXdpdGgtbGlua1xcXCI+XFxuICAgICAgPGxhYmVsIGNsYXNzPVxcXCJsYWJlbFxcXCIgZm9yPVxcXCJpbnB1dC1wYXNzd29yZFxcXCI+UGFzc3dvcmQ6PC9sYWJlbD5cXG4gICAgICA8YSBjbGFzcz1cXFwiZm9yZ290LXBhc3N3b3JkIGNhcHRpb24tMlxcXCIgcm91dGVyTGluaz1cXFwiLi4vcmVxdWVzdC1wYXNzd29yZFxcXCI+Rm9yZ290IFBhc3N3b3JkPzwvYT5cXG4gICAgPC9zcGFuPlxcbiAgICA8aW5wdXQgbmJJbnB1dFxcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBbKG5nTW9kZWwpXT1cXFwidXNlci5wYXNzd29yZFxcXCJcXG4gICAgICAgICAgICNwYXNzd29yZD1cXFwibmdNb2RlbFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcInBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgdHlwZT1cXFwicGFzc3dvcmRcXFwiXFxuICAgICAgICAgICBpZD1cXFwiaW5wdXQtcGFzc3dvcmRcXFwiXFxuICAgICAgICAgICBwbGFjZWhvbGRlcj1cXFwiUGFzc3dvcmRcXFwiXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcInBhc3N3b3JkLmRpcnR5ID8gKHBhc3N3b3JkLmludmFsaWQgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbbWlubGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWluTGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbbWF4bGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWF4TGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJwYXNzd29yZC5pbnZhbGlkICYmIHBhc3N3b3JkLnRvdWNoZWQgPyB0cnVlIDogbnVsbFxcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XFxcInBhc3N3b3JkLmludmFsaWQgJiYgcGFzc3dvcmQudG91Y2hlZCBcXFwiPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJwYXNzd29yZC5lcnJvcnM/LnJlcXVpcmVkXFxcIj5cXG4gICAgICAgIFBhc3N3b3JkIGlzIHJlcXVpcmVkIVxcbiAgICAgIDwvcD5cXG4gICAgICA8cCBjbGFzcz1cXFwiY2FwdGlvbiBzdGF0dXMtZGFuZ2VyXFxcIiAqbmdJZj1cXFwicGFzc3dvcmQuZXJyb3JzPy5taW5sZW5ndGggfHwgcGFzc3dvcmQuZXJyb3JzPy5tYXhsZW5ndGhcXFwiPlxcbiAgICAgICAgUGFzc3dvcmQgc2hvdWxkIGNvbnRhaW5cXG4gICAgICAgIGZyb20ge3sgZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWluTGVuZ3RoJykgfX1cXG4gICAgICAgIHRvIHt7IGdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLm1heExlbmd0aCcpIH19XFxuICAgICAgICBjaGFyYWN0ZXJzXFxuICAgICAgPC9wPlxcbiAgICA8L25nLWNvbnRhaW5lcj5cXG4gIDwvZGl2PlxcblxcbiAgPGRpdiBjbGFzcz1cXFwiZm9ybS1jb250cm9sLWdyb3VwIGFjY2VwdC1ncm91cFxcXCI+XFxuICAgIDxuYi1jaGVja2JveCBuYW1lPVxcXCJyZW1lbWJlck1lXFxcIiBbKG5nTW9kZWwpXT1cXFwidXNlci5yZW1lbWJlck1lXFxcIiAqbmdJZj1cXFwicmVtZW1iZXJNZVxcXCI+UmVtZW1iZXIgbWU8L25iLWNoZWNrYm94PlxcbiAgPC9kaXY+XFxuXFxuICA8YnV0dG9uIG5iQnV0dG9uXFxuICAgICAgICAgIGZ1bGxXaWR0aFxcbiAgICAgICAgICBzdGF0dXM9XFxcInByaW1hcnlcXFwiXFxuICAgICAgICAgIHNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICBbZGlzYWJsZWRdPVxcXCJzdWJtaXR0ZWQgfHwgIWZvcm0udmFsaWRcXFwiXFxuICAgICAgICAgIFtjbGFzcy5idG4tcHVsc2VdPVxcXCJzdWJtaXR0ZWRcXFwiPlxcbiAgICBMb2cgSW5cXG4gIDwvYnV0dG9uPlxcbjwvZm9ybT5cXG5cXG48c2VjdGlvbiAqbmdJZj1cXFwic29jaWFsTGlua3MgJiYgc29jaWFsTGlua3MubGVuZ3RoID4gMFxcXCIgY2xhc3M9XFxcImxpbmtzXFxcIiBhcmlhLWxhYmVsPVxcXCJTb2NpYWwgc2lnbiBpblxcXCI+XFxuICBvciBlbnRlciB3aXRoOlxcbiAgPGRpdiBjbGFzcz1cXFwic29jaWFsc1xcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVxcXCJsZXQgc29jaWFsTGluayBvZiBzb2NpYWxMaW5rc1xcXCI+XFxuICAgICAgPGEgKm5nSWY9XFxcInNvY2lhbExpbmsubGlua1xcXCJcXG4gICAgICAgICBbcm91dGVyTGlua109XFxcInNvY2lhbExpbmsubGlua1xcXCJcXG4gICAgICAgICBbYXR0ci50YXJnZXRdPVxcXCJzb2NpYWxMaW5rLnRhcmdldFxcXCJcXG4gICAgICAgICBbYXR0ci5jbGFzc109XFxcInNvY2lhbExpbmsuaWNvblxcXCJcXG4gICAgICAgICBbY2xhc3Mud2l0aC1pY29uXT1cXFwic29jaWFsTGluay5pY29uXFxcIj5cXG4gICAgICAgIDxuYi1pY29uICpuZ0lmPVxcXCJzb2NpYWxMaW5rLmljb247IGVsc2UgdGl0bGVcXFwiIFtpY29uXT1cXFwic29jaWFsTGluay5pY29uXFxcIj48L25iLWljb24+XFxuICAgICAgICA8bmctdGVtcGxhdGUgI3RpdGxlPnt7IHNvY2lhbExpbmsudGl0bGUgfX08L25nLXRlbXBsYXRlPlxcbiAgICAgIDwvYT5cXG4gICAgICA8YSAqbmdJZj1cXFwic29jaWFsTGluay51cmxcXFwiXFxuICAgICAgICAgW2F0dHIuaHJlZl09XFxcInNvY2lhbExpbmsudXJsXFxcIlxcbiAgICAgICAgIFthdHRyLnRhcmdldF09XFxcInNvY2lhbExpbmsudGFyZ2V0XFxcIlxcbiAgICAgICAgIFthdHRyLmNsYXNzXT1cXFwic29jaWFsTGluay5pY29uXFxcIlxcbiAgICAgICAgIFtjbGFzcy53aXRoLWljb25dPVxcXCJzb2NpYWxMaW5rLmljb25cXFwiPlxcbiAgICAgICAgPG5iLWljb24gKm5nSWY9XFxcInNvY2lhbExpbmsuaWNvbjsgZWxzZSB0aXRsZVxcXCIgW2ljb25dPVxcXCJzb2NpYWxMaW5rLmljb25cXFwiPjwvbmItaWNvbj5cXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjdGl0bGU+e3sgc29jaWFsTGluay50aXRsZSB9fTwvbmctdGVtcGxhdGU+XFxuICAgICAgPC9hPlxcbiAgICA8L25nLWNvbnRhaW5lcj5cXG4gIDwvZGl2Plxcbjwvc2VjdGlvbj5cXG5cXG48c2VjdGlvbiBjbGFzcz1cXFwiYW5vdGhlci1hY3Rpb25cXFwiIGFyaWEtbGFiZWw9XFxcIlJlZ2lzdGVyXFxcIj5cXG4gIERvbid0IGhhdmUgYW4gYWNjb3VudD8gPGEgY2xhc3M9XFxcInRleHQtbGlua1xcXCIgcm91dGVyTGluaz1cXFwiLi4vcmVnaXN0ZXJcXFwiPlJlZ2lzdGVyPC9hPlxcbjwvc2VjdGlvbj5cXG5cIixcbiAgICAgICAgICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG4gICAgICAgIH0pLFxuICAgICAgICBfX3BhcmFtKDEsIEluamVjdChOQl9BVVRIX09QVElPTlMpKSxcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOYkF1dGhTZXJ2aWNlLCBPYmplY3QsIENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgUm91dGVyXSlcbiAgICBdLCBOYkxvZ2luQ29tcG9uZW50KTtcbiAgICByZXR1cm4gTmJMb2dpbkNvbXBvbmVudDtcbn0oKSk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBBa3Zlby4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4gU2VlIExpY2Vuc2UudHh0IGluIHRoZSBwcm9qZWN0IHJvb3QgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24uXG4gKi9cbnZhciBOYlJlZ2lzdGVyQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iUmVnaXN0ZXJDb21wb25lbnQoc2VydmljZSwgb3B0aW9ucywgY2QsIHJvdXRlcikge1xuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmNkID0gY2Q7XG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgICAgICB0aGlzLnJlZGlyZWN0RGVsYXkgPSAwO1xuICAgICAgICB0aGlzLnNob3dNZXNzYWdlcyA9IHt9O1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gJyc7XG4gICAgICAgIHRoaXMuc3VibWl0dGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gW107XG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICAgICAgdGhpcy51c2VyID0ge307XG4gICAgICAgIHRoaXMuc29jaWFsTGlua3MgPSBbXTtcbiAgICAgICAgdGhpcy5yZWRpcmVjdERlbGF5ID0gdGhpcy5nZXRDb25maWdWYWx1ZSgnZm9ybXMucmVnaXN0ZXIucmVkaXJlY3REZWxheScpO1xuICAgICAgICB0aGlzLnNob3dNZXNzYWdlcyA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnJlZ2lzdGVyLnNob3dNZXNzYWdlcycpO1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gdGhpcy5nZXRDb25maWdWYWx1ZSgnZm9ybXMucmVnaXN0ZXIuc3RyYXRlZ3knKTtcbiAgICAgICAgdGhpcy5zb2NpYWxMaW5rcyA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLmxvZ2luLnNvY2lhbExpbmtzJyk7XG4gICAgfVxuICAgIE5iUmVnaXN0ZXJDb21wb25lbnQucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMubWVzc2FnZXMgPSBbXTtcbiAgICAgICAgdGhpcy5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnNlcnZpY2UucmVnaXN0ZXIodGhpcy5zdHJhdGVneSwgdGhpcy51c2VyKS5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmlzU3VjY2VzcygpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMubWVzc2FnZXMgPSByZXN1bHQuZ2V0TWVzc2FnZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmVycm9ycyA9IHJlc3VsdC5nZXRFcnJvcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZWRpcmVjdCA9IHJlc3VsdC5nZXRSZWRpcmVjdCgpO1xuICAgICAgICAgICAgaWYgKHJlZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChyZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgfSwgX3RoaXMucmVkaXJlY3REZWxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTmJSZWdpc3RlckNvbXBvbmVudC5wcm90b3R5cGUuZ2V0Q29uZmlnVmFsdWUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiBnZXREZWVwRnJvbU9iamVjdCh0aGlzLm9wdGlvbnMsIGtleSwgbnVsbCk7XG4gICAgfTtcbiAgICBOYlJlZ2lzdGVyQ29tcG9uZW50ID0gX19kZWNvcmF0ZShbXG4gICAgICAgIENvbXBvbmVudCh7XG4gICAgICAgICAgICBzZWxlY3RvcjogJ25iLXJlZ2lzdGVyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIjxoMSBpZD1cXFwidGl0bGVcXFwiIGNsYXNzPVxcXCJ0aXRsZVxcXCI+UmVnaXN0ZXI8L2gxPlxcblxcbjxuYi1hbGVydCAqbmdJZj1cXFwic2hvd01lc3NhZ2VzLmVycm9yICYmIGVycm9ycz8ubGVuZ3RoICYmICFzdWJtaXR0ZWRcXFwiIG91dGxpbmU9XFxcImRhbmdlclxcXCIgcm9sZT1cXFwiYWxlcnRcXFwiPlxcbiAgPHAgY2xhc3M9XFxcImFsZXJ0LXRpdGxlXFxcIj48Yj5PaCBzbmFwITwvYj48L3A+XFxuICA8dWwgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2UtbGlzdFxcXCI+XFxuICAgIDxsaSAqbmdGb3I9XFxcImxldCBlcnJvciBvZiBlcnJvcnNcXFwiIGNsYXNzPVxcXCJhbGVydC1tZXNzYWdlXFxcIj57eyBlcnJvciB9fTwvbGk+XFxuICA8L3VsPlxcbjwvbmItYWxlcnQ+XFxuXFxuPG5iLWFsZXJ0ICpuZ0lmPVxcXCJzaG93TWVzc2FnZXMuc3VjY2VzcyAmJiBtZXNzYWdlcz8ubGVuZ3RoICYmICFzdWJtaXR0ZWRcXFwiIG91dGxpbmU9XFxcInN1Y2Nlc3NcXFwiIHJvbGU9XFxcImFsZXJ0XFxcIj5cXG4gIDxwIGNsYXNzPVxcXCJhbGVydC10aXRsZVxcXCI+PGI+SG9vcmF5ITwvYj48L3A+XFxuICA8dWwgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2UtbGlzdFxcXCI+XFxuICAgIDxsaSAqbmdGb3I9XFxcImxldCBtZXNzYWdlIG9mIG1lc3NhZ2VzXFxcIiBjbGFzcz1cXFwiYWxlcnQtbWVzc2FnZVxcXCI+e3sgbWVzc2FnZSB9fTwvbGk+XFxuICA8L3VsPlxcbjwvbmItYWxlcnQ+XFxuXFxuPGZvcm0gKG5nU3VibWl0KT1cXFwicmVnaXN0ZXIoKVxcXCIgI2Zvcm09XFxcIm5nRm9ybVxcXCIgYXJpYS1sYWJlbGxlZGJ5PVxcXCJ0aXRsZVxcXCI+XFxuXFxuICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWNvbnRyb2wtZ3JvdXBcXFwiPlxcbiAgICA8bGFiZWwgY2xhc3M9XFxcImxhYmVsXFxcIiBmb3I9XFxcImlucHV0LW5hbWVcXFwiPkZ1bGwgbmFtZTo8L2xhYmVsPlxcbiAgICA8aW5wdXQgbmJJbnB1dFxcbiAgICAgICAgICAgWyhuZ01vZGVsKV09XFxcInVzZXIuZnVsbE5hbWVcXFwiXFxuICAgICAgICAgICAjZnVsbE5hbWU9XFxcIm5nTW9kZWxcXFwiXFxuICAgICAgICAgICBpZD1cXFwiaW5wdXQtbmFtZVxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcImZ1bGxOYW1lXFxcIlxcbiAgICAgICAgICAgcGxhY2Vob2xkZXI9XFxcIkZ1bGwgbmFtZVxcXCJcXG4gICAgICAgICAgIGF1dG9mb2N1c1xcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcImZ1bGxOYW1lLmRpcnR5ID8gKGZ1bGxOYW1lLmludmFsaWQgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLmZ1bGxOYW1lLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbbWlubGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24uZnVsbE5hbWUubWluTGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbbWF4bGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24uZnVsbE5hbWUubWF4TGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJmdWxsTmFtZS5pbnZhbGlkICYmIGZ1bGxOYW1lLnRvdWNoZWQgPyB0cnVlIDogbnVsbFxcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XFxcImZ1bGxOYW1lLmludmFsaWQgJiYgZnVsbE5hbWUudG91Y2hlZFxcXCI+XFxuICAgICAgPHAgY2xhc3M9XFxcImNhcHRpb24gc3RhdHVzLWRhbmdlclxcXCIgKm5nSWY9XFxcImZ1bGxOYW1lLmVycm9ycz8ucmVxdWlyZWRcXFwiPlxcbiAgICAgICAgRnVsbCBuYW1lIGlzIHJlcXVpcmVkIVxcbiAgICAgIDwvcD5cXG4gICAgICA8cCBjbGFzcz1cXFwiY2FwdGlvbiBzdGF0dXMtZGFuZ2VyXFxcIiAqbmdJZj1cXFwiZnVsbE5hbWUuZXJyb3JzPy5taW5sZW5ndGggfHwgZnVsbE5hbWUuZXJyb3JzPy5tYXhsZW5ndGhcXFwiPlxcbiAgICAgICAgRnVsbCBuYW1lIHNob3VsZCBjb250YWluc1xcbiAgICAgICAgZnJvbSB7e2dldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLmZ1bGxOYW1lLm1pbkxlbmd0aCcpfX1cXG4gICAgICAgIHRvIHt7Z2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24uZnVsbE5hbWUubWF4TGVuZ3RoJyl9fVxcbiAgICAgICAgY2hhcmFjdGVyc1xcbiAgICAgIDwvcD5cXG4gICAgPC9uZy1jb250YWluZXI+XFxuICA8L2Rpdj5cXG5cXG4gIDxkaXYgY2xhc3M9XFxcImZvcm0tY29udHJvbC1ncm91cFxcXCI+XFxuICAgIDxsYWJlbCBjbGFzcz1cXFwibGFiZWxcXFwiIGZvcj1cXFwiaW5wdXQtZW1haWxcXFwiPkVtYWlsIGFkZHJlc3M6PC9sYWJlbD5cXG4gICAgPGlucHV0IG5iSW5wdXRcXG4gICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJ1c2VyLmVtYWlsXFxcIlxcbiAgICAgICAgICAgI2VtYWlsPVxcXCJuZ01vZGVsXFxcIlxcbiAgICAgICAgICAgaWQ9XFxcImlucHV0LWVtYWlsXFxcIlxcbiAgICAgICAgICAgbmFtZT1cXFwiZW1haWxcXFwiXFxuICAgICAgICAgICBwYXR0ZXJuPVxcXCIuK0AuKy4uK1xcXCJcXG4gICAgICAgICAgIHBsYWNlaG9sZGVyPVxcXCJFbWFpbCBhZGRyZXNzXFxcIlxcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcImVtYWlsLmRpcnR5ID8gKGVtYWlsLmludmFsaWQgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLmVtYWlsLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJlbWFpbC5pbnZhbGlkICYmIGVtYWlsLnRvdWNoZWQgPyB0cnVlIDogbnVsbFxcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XFxcImVtYWlsLmludmFsaWQgJiYgZW1haWwudG91Y2hlZFxcXCI+XFxuICAgICAgPHAgY2xhc3M9XFxcImNhcHRpb24gc3RhdHVzLWRhbmdlclxcXCIgKm5nSWY9XFxcImVtYWlsLmVycm9ycz8ucmVxdWlyZWRcXFwiPlxcbiAgICAgICAgRW1haWwgaXMgcmVxdWlyZWQhXFxuICAgICAgPC9wPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJlbWFpbC5lcnJvcnM/LnBhdHRlcm5cXFwiPlxcbiAgICAgICAgRW1haWwgc2hvdWxkIGJlIHRoZSByZWFsIG9uZSFcXG4gICAgICA8L3A+XFxuICAgIDwvbmctY29udGFpbmVyPlxcbiAgPC9kaXY+XFxuXFxuICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWNvbnRyb2wtZ3JvdXBcXFwiPlxcbiAgICA8bGFiZWwgY2xhc3M9XFxcImxhYmVsXFxcIiBmb3I9XFxcImlucHV0LXBhc3N3b3JkXFxcIj5QYXNzd29yZDo8L2xhYmVsPlxcbiAgICA8aW5wdXQgbmJJbnB1dFxcbiAgICAgICAgICAgWyhuZ01vZGVsKV09XFxcInVzZXIucGFzc3dvcmRcXFwiXFxuICAgICAgICAgICAjcGFzc3dvcmQ9XFxcIm5nTW9kZWxcXFwiXFxuICAgICAgICAgICB0eXBlPVxcXCJwYXNzd29yZFxcXCJcXG4gICAgICAgICAgIGlkPVxcXCJpbnB1dC1wYXNzd29yZFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcInBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgcGxhY2Vob2xkZXI9XFxcIlBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcInBhc3N3b3JkLmRpcnR5ID8gKHBhc3N3b3JkLmludmFsaWQgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbbWlubGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWluTGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbbWF4bGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWF4TGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJwYXNzd29yZC5pbnZhbGlkICYmIHBhc3N3b3JkLnRvdWNoZWQgPyB0cnVlIDogbnVsbFxcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XFxcInBhc3N3b3JkLmludmFsaWQgJiYgcGFzc3dvcmQudG91Y2hlZFxcXCI+XFxuICAgICAgPHAgY2xhc3M9XFxcImNhcHRpb24gc3RhdHVzLWRhbmdlclxcXCIgKm5nSWY9XFxcInBhc3N3b3JkLmVycm9ycz8ucmVxdWlyZWRcXFwiPlxcbiAgICAgICAgUGFzc3dvcmQgaXMgcmVxdWlyZWQhXFxuICAgICAgPC9wPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJwYXNzd29yZC5lcnJvcnM/Lm1pbmxlbmd0aCB8fCBwYXNzd29yZC5lcnJvcnM/Lm1heGxlbmd0aFxcXCI+XFxuICAgICAgICBQYXNzd29yZCBzaG91bGQgY29udGFpblxcbiAgICAgICAgZnJvbSB7eyBnZXRDb25maWdWYWx1ZSgnZm9ybXMudmFsaWRhdGlvbi5wYXNzd29yZC5taW5MZW5ndGgnKSB9fVxcbiAgICAgICAgdG8ge3sgZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWF4TGVuZ3RoJykgfX1cXG4gICAgICAgIGNoYXJhY3RlcnNcXG4gICAgICA8L3A+XFxuICAgIDwvbmctY29udGFpbmVyPlxcbiAgPC9kaXY+XFxuXFxuICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWNvbnRyb2wtZ3JvdXBcXFwiPlxcbiAgICA8bGFiZWwgY2xhc3M9XFxcImxhYmVsXFxcIiBmb3I9XFxcImlucHV0LXJlLXBhc3N3b3JkXFxcIj5SZXBlYXQgcGFzc3dvcmQ6PC9sYWJlbD5cXG4gICAgPGlucHV0IG5iSW5wdXRcXG4gICAgICAgICAgIFsobmdNb2RlbCldPVxcXCJ1c2VyLmNvbmZpcm1QYXNzd29yZFxcXCJcXG4gICAgICAgICAgICNyZVBhc3M9XFxcIm5nTW9kZWxcXFwiXFxuICAgICAgICAgICB0eXBlPVxcXCJwYXNzd29yZFxcXCJcXG4gICAgICAgICAgIGlkPVxcXCJpbnB1dC1yZS1wYXNzd29yZFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcInJlUGFzc1xcXCJcXG4gICAgICAgICAgIHBsYWNlaG9sZGVyPVxcXCJDb25maXJtIFBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcInJlUGFzcy5kaXJ0eSA/IChyZVBhc3MuaW52YWxpZCB8fCBwYXNzd29yZC52YWx1ZSAhPSByZVBhc3MudmFsdWUgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJyZVBhc3MuaW52YWxpZCAmJiByZVBhc3MudG91Y2hlZCA/IHRydWUgOiBudWxsXFxcIj5cXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cXFwicmVQYXNzLmludmFsaWQgJiYgcmVQYXNzLnRvdWNoZWRcXFwiPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJyZVBhc3MuZXJyb3JzPy5yZXF1aXJlZFxcXCI+XFxuICAgICAgICBQYXNzd29yZCBjb25maXJtYXRpb24gaXMgcmVxdWlyZWQhXFxuICAgICAgPC9wPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJwYXNzd29yZC52YWx1ZSAhPSByZVBhc3MudmFsdWUgJiYgIXJlUGFzcy5lcnJvcnM/LnJlcXVpcmVkXFxcIj5cXG4gICAgICAgIFBhc3N3b3JkIGRvZXMgbm90IG1hdGNoIHRoZSBjb25maXJtIHBhc3N3b3JkLlxcbiAgICAgIDwvcD5cXG4gICAgPC9uZy1jb250YWluZXI+XFxuICA8L2Rpdj5cXG5cXG4gIDxkaXYgY2xhc3M9XFxcImZvcm0tY29udHJvbC1ncm91cCBhY2NlcHQtZ3JvdXBcXFwiICpuZ0lmPVxcXCJnZXRDb25maWdWYWx1ZSgnZm9ybXMucmVnaXN0ZXIudGVybXMnKVxcXCI+XFxuICAgIDxuYi1jaGVja2JveCBuYW1lPVxcXCJ0ZXJtc1xcXCIgWyhuZ01vZGVsKV09XFxcInVzZXIudGVybXNcXFwiIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5yZWdpc3Rlci50ZXJtcycpXFxcIj5cXG4gICAgICBBZ3JlZSB0byA8YSBocmVmPVxcXCIjXFxcIiB0YXJnZXQ9XFxcIl9ibGFua1xcXCI+PHN0cm9uZz5UZXJtcyAmIENvbmRpdGlvbnM8L3N0cm9uZz48L2E+XFxuICAgIDwvbmItY2hlY2tib3g+XFxuICA8L2Rpdj5cXG5cXG4gIDxidXR0b24gbmJCdXR0b25cXG4gICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgIHN0YXR1cz1cXFwicHJpbWFyeVxcXCJcXG4gICAgICAgICAgc2l6ZT1cXFwibGFyZ2VcXFwiXFxuICAgICAgICAgIFtkaXNhYmxlZF09XFxcInN1Ym1pdHRlZCB8fCAhZm9ybS52YWxpZFxcXCJcXG4gICAgICAgICAgW2NsYXNzLmJ0bi1wdWxzZV09XFxcInN1Ym1pdHRlZFxcXCI+XFxuICAgIFJlZ2lzdGVyXFxuICA8L2J1dHRvbj5cXG48L2Zvcm0+XFxuXFxuPHNlY3Rpb24gKm5nSWY9XFxcInNvY2lhbExpbmtzICYmIHNvY2lhbExpbmtzLmxlbmd0aCA+IDBcXFwiIGNsYXNzPVxcXCJsaW5rc1xcXCIgYXJpYS1sYWJlbD1cXFwiU29jaWFsIHNpZ24gaW5cXFwiPlxcbiAgb3IgZW50ZXIgd2l0aDpcXG4gIDxkaXYgY2xhc3M9XFxcInNvY2lhbHNcXFwiPlxcbiAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cXFwibGV0IHNvY2lhbExpbmsgb2Ygc29jaWFsTGlua3NcXFwiPlxcbiAgICAgIDxhICpuZ0lmPVxcXCJzb2NpYWxMaW5rLmxpbmtcXFwiXFxuICAgICAgICAgW3JvdXRlckxpbmtdPVxcXCJzb2NpYWxMaW5rLmxpbmtcXFwiXFxuICAgICAgICAgW2F0dHIudGFyZ2V0XT1cXFwic29jaWFsTGluay50YXJnZXRcXFwiXFxuICAgICAgICAgW2F0dHIuY2xhc3NdPVxcXCJzb2NpYWxMaW5rLmljb25cXFwiXFxuICAgICAgICAgW2NsYXNzLndpdGgtaWNvbl09XFxcInNvY2lhbExpbmsuaWNvblxcXCI+XFxuICAgICAgICA8bmItaWNvbiAqbmdJZj1cXFwic29jaWFsTGluay5pY29uOyBlbHNlIHRpdGxlXFxcIiBbaWNvbl09XFxcInNvY2lhbExpbmsuaWNvblxcXCI+PC9uYi1pY29uPlxcbiAgICAgICAgPG5nLXRlbXBsYXRlICN0aXRsZT57eyBzb2NpYWxMaW5rLnRpdGxlIH19PC9uZy10ZW1wbGF0ZT5cXG4gICAgICA8L2E+XFxuICAgICAgPGEgKm5nSWY9XFxcInNvY2lhbExpbmsudXJsXFxcIlxcbiAgICAgICAgIFthdHRyLmhyZWZdPVxcXCJzb2NpYWxMaW5rLnVybFxcXCJcXG4gICAgICAgICBbYXR0ci50YXJnZXRdPVxcXCJzb2NpYWxMaW5rLnRhcmdldFxcXCJcXG4gICAgICAgICBbYXR0ci5jbGFzc109XFxcInNvY2lhbExpbmsuaWNvblxcXCJcXG4gICAgICAgICBbY2xhc3Mud2l0aC1pY29uXT1cXFwic29jaWFsTGluay5pY29uXFxcIj5cXG4gICAgICAgIDxuYi1pY29uICpuZ0lmPVxcXCJzb2NpYWxMaW5rLmljb247IGVsc2UgdGl0bGVcXFwiIFtpY29uXT1cXFwic29jaWFsTGluay5pY29uXFxcIj48L25iLWljb24+XFxuICAgICAgICA8bmctdGVtcGxhdGUgI3RpdGxlPnt7IHNvY2lhbExpbmsudGl0bGUgfX08L25nLXRlbXBsYXRlPlxcbiAgICAgIDwvYT5cXG4gICAgPC9uZy1jb250YWluZXI+XFxuICA8L2Rpdj5cXG48L3NlY3Rpb24+XFxuXFxuPHNlY3Rpb24gY2xhc3M9XFxcImFub3RoZXItYWN0aW9uXFxcIiBhcmlhLWxhYmVsPVxcXCJTaWduIGluXFxcIj5cXG4gIEFscmVhZHkgaGF2ZSBhbiBhY2NvdW50PyA8YSBjbGFzcz1cXFwidGV4dC1saW5rXFxcIiByb3V0ZXJMaW5rPVxcXCIuLi9sb2dpblxcXCI+TG9nIGluPC9hPlxcbjwvc2VjdGlvbj5cXG5cIixcbiAgICAgICAgICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgICAgICAgICAgc3R5bGVzOiBbXCI6aG9zdCAudGl0bGV7bWFyZ2luLWJvdHRvbToycmVtfVxcblwiXVxuICAgICAgICB9KSxcbiAgICAgICAgX19wYXJhbSgxLCBJbmplY3QoTkJfQVVUSF9PUFRJT05TKSksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbTmJBdXRoU2VydmljZSwgT2JqZWN0LCBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgIFJvdXRlcl0pXG4gICAgXSwgTmJSZWdpc3RlckNvbXBvbmVudCk7XG4gICAgcmV0dXJuIE5iUmVnaXN0ZXJDb21wb25lbnQ7XG59KCkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJMb2dvdXRDb21wb25lbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmJMb2dvdXRDb21wb25lbnQoc2VydmljZSwgb3B0aW9ucywgcm91dGVyKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgICAgICB0aGlzLnJlZGlyZWN0RGVsYXkgPSAwO1xuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gJyc7XG4gICAgICAgIHRoaXMucmVkaXJlY3REZWxheSA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLmxvZ291dC5yZWRpcmVjdERlbGF5Jyk7XG4gICAgICAgIHRoaXMuc3RyYXRlZ3kgPSB0aGlzLmdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5sb2dvdXQuc3RyYXRlZ3knKTtcbiAgICB9XG4gICAgTmJMb2dvdXRDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxvZ291dCh0aGlzLnN0cmF0ZWd5KTtcbiAgICB9O1xuICAgIE5iTG9nb3V0Q29tcG9uZW50LnByb3RvdHlwZS5sb2dvdXQgPSBmdW5jdGlvbiAoc3RyYXRlZ3kpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5zZXJ2aWNlLmxvZ291dChzdHJhdGVneSkuc3Vic2NyaWJlKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIHZhciByZWRpcmVjdCA9IHJlc3VsdC5nZXRSZWRpcmVjdCgpO1xuICAgICAgICAgICAgaWYgKHJlZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChyZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgfSwgX3RoaXMucmVkaXJlY3REZWxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTmJMb2dvdXRDb21wb25lbnQucHJvdG90eXBlLmdldENvbmZpZ1ZhbHVlID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICByZXR1cm4gZ2V0RGVlcEZyb21PYmplY3QodGhpcy5vcHRpb25zLCBrZXksIG51bGwpO1xuICAgIH07XG4gICAgTmJMb2dvdXRDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnbmItbG9nb3V0JyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIjxkaXY+TG9nZ2luZyBvdXQsIHBsZWFzZSB3YWl0Li4uPC9kaXY+XFxuXCJcbiAgICAgICAgfSksXG4gICAgICAgIF9fcGFyYW0oMSwgSW5qZWN0KE5CX0FVVEhfT1BUSU9OUykpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05iQXV0aFNlcnZpY2UsIE9iamVjdCwgUm91dGVyXSlcbiAgICBdLCBOYkxvZ291dENvbXBvbmVudCk7XG4gICAgcmV0dXJuIE5iTG9nb3V0Q29tcG9uZW50O1xufSgpKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEFrdmVvLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqL1xudmFyIE5iUmVxdWVzdFBhc3N3b3JkQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iUmVxdWVzdFBhc3N3b3JkQ29tcG9uZW50KHNlcnZpY2UsIG9wdGlvbnMsIGNkLCByb3V0ZXIpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0ge307IH1cbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy5jZCA9IGNkO1xuICAgICAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcbiAgICAgICAgdGhpcy5yZWRpcmVjdERlbGF5ID0gMDtcbiAgICAgICAgdGhpcy5zaG93TWVzc2FnZXMgPSB7fTtcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9ICcnO1xuICAgICAgICB0aGlzLnN1Ym1pdHRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIHRoaXMudXNlciA9IHt9O1xuICAgICAgICB0aGlzLnJlZGlyZWN0RGVsYXkgPSB0aGlzLmdldENvbmZpZ1ZhbHVlKCdmb3Jtcy5yZXF1ZXN0UGFzc3dvcmQucmVkaXJlY3REZWxheScpO1xuICAgICAgICB0aGlzLnNob3dNZXNzYWdlcyA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnJlcXVlc3RQYXNzd29yZC5zaG93TWVzc2FnZXMnKTtcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnJlcXVlc3RQYXNzd29yZC5zdHJhdGVneScpO1xuICAgIH1cbiAgICBOYlJlcXVlc3RQYXNzd29yZENvbXBvbmVudC5wcm90b3R5cGUucmVxdWVzdFBhc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5tZXNzYWdlcyA9IFtdO1xuICAgICAgICB0aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5yZXF1ZXN0UGFzc3dvcmQodGhpcy5zdHJhdGVneSwgdGhpcy51c2VyKS5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmlzU3VjY2VzcygpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMubWVzc2FnZXMgPSByZXN1bHQuZ2V0TWVzc2FnZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF90aGlzLmVycm9ycyA9IHJlc3VsdC5nZXRFcnJvcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZWRpcmVjdCA9IHJlc3VsdC5nZXRSZWRpcmVjdCgpO1xuICAgICAgICAgICAgaWYgKHJlZGlyZWN0KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChyZWRpcmVjdCk7XG4gICAgICAgICAgICAgICAgfSwgX3RoaXMucmVkaXJlY3REZWxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQucHJvdG90eXBlLmdldENvbmZpZ1ZhbHVlID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICByZXR1cm4gZ2V0RGVlcEZyb21PYmplY3QodGhpcy5vcHRpb25zLCBrZXksIG51bGwpO1xuICAgIH07XG4gICAgTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnbmItcmVxdWVzdC1wYXNzd29yZC1wYWdlJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIjxoMSBpZD1cXFwidGl0bGVcXFwiIGNsYXNzPVxcXCJ0aXRsZVxcXCI+Rm9yZ290IFBhc3N3b3JkPC9oMT5cXG48cCBjbGFzcz1cXFwic3ViLXRpdGxlXFxcIj5FbnRlciB5b3VyIGVtYWlsIGFkZHJlc3MgYW5kIHdlXFx1MjAxOWxsIHNlbmQgYSBsaW5rIHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQ8L3A+XFxuXFxuPG5iLWFsZXJ0ICpuZ0lmPVxcXCJzaG93TWVzc2FnZXMuZXJyb3IgJiYgZXJyb3JzPy5sZW5ndGggJiYgIXN1Ym1pdHRlZFxcXCIgb3V0bGluZT1cXFwiZGFuZ2VyXFxcIiByb2xlPVxcXCJhbGVydFxcXCI+XFxuICA8cCBjbGFzcz1cXFwiYWxlcnQtdGl0bGVcXFwiPjxiPk9oIHNuYXAhPC9iPjwvcD5cXG4gIDx1bCBjbGFzcz1cXFwiYWxlcnQtbWVzc2FnZS1saXN0XFxcIj5cXG4gICAgPGxpICpuZ0Zvcj1cXFwibGV0IGVycm9yIG9mIGVycm9yc1xcXCIgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2VcXFwiPnt7IGVycm9yIH19PC9saT5cXG4gIDwvdWw+XFxuPC9uYi1hbGVydD5cXG5cXG48bmItYWxlcnQgKm5nSWY9XFxcInNob3dNZXNzYWdlcy5zdWNjZXNzICYmIG1lc3NhZ2VzPy5sZW5ndGggJiYgIXN1Ym1pdHRlZFxcXCIgb3V0bGluZT1cXFwic3VjY2Vzc1xcXCIgcm9sZT1cXFwiYWxlcnRcXFwiPlxcbiAgPHAgY2xhc3M9XFxcImFsZXJ0LXRpdGxlXFxcIj48Yj5Ib29yYXkhPC9iPjwvcD5cXG4gIDx1bCBjbGFzcz1cXFwiYWxlcnQtbWVzc2FnZS1saXN0XFxcIj5cXG4gICAgPGxpICpuZ0Zvcj1cXFwibGV0IG1lc3NhZ2Ugb2YgbWVzc2FnZXNcXFwiIGNsYXNzPVxcXCJhbGVydC1tZXNzYWdlXFxcIj57eyBtZXNzYWdlIH19PC9saT5cXG4gIDwvdWw+XFxuPC9uYi1hbGVydD5cXG5cXG48Zm9ybSAobmdTdWJtaXQpPVxcXCJyZXF1ZXN0UGFzcygpXFxcIiAjcmVxdWVzdFBhc3NGb3JtPVxcXCJuZ0Zvcm1cXFwiIGFyaWEtbGFiZWxsZWRieT1cXFwidGl0bGVcXFwiPlxcblxcbiAgPGRpdiBjbGFzcz1cXFwiZm9ybS1jb250cm9sLWdyb3VwXFxcIj5cXG4gICAgPGxhYmVsIGNsYXNzPVxcXCJsYWJlbFxcXCIgZm9yPVxcXCJpbnB1dC1lbWFpbFxcXCI+RW50ZXIgeW91ciBlbWFpbCBhZGRyZXNzOjwvbGFiZWw+XFxuICAgIDxpbnB1dCBuYklucHV0XFxuICAgICAgICAgICBbKG5nTW9kZWwpXT1cXFwidXNlci5lbWFpbFxcXCJcXG4gICAgICAgICAgICNlbWFpbD1cXFwibmdNb2RlbFxcXCJcXG4gICAgICAgICAgIGlkPVxcXCJpbnB1dC1lbWFpbFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcImVtYWlsXFxcIlxcbiAgICAgICAgICAgcGF0dGVybj1cXFwiLitALitcXFxcLi4rXFxcIlxcbiAgICAgICAgICAgcGxhY2Vob2xkZXI9XFxcIkVtYWlsIGFkZHJlc3NcXFwiXFxuICAgICAgICAgICBhdXRvZm9jdXNcXG4gICAgICAgICAgIGZ1bGxXaWR0aFxcbiAgICAgICAgICAgZmllbGRTaXplPVxcXCJsYXJnZVxcXCJcXG4gICAgICAgICAgIFtzdGF0dXNdPVxcXCJlbWFpbC5kaXJ0eSA/IChlbWFpbC5pbnZhbGlkICA/ICdkYW5nZXInIDogJ3N1Y2Nlc3MnKSA6ICdiYXNpYydcXFwiXFxuICAgICAgICAgICBbcmVxdWlyZWRdPVxcXCJnZXRDb25maWdWYWx1ZSgnZm9ybXMudmFsaWRhdGlvbi5lbWFpbC5yZXF1aXJlZCcpXFxcIlxcbiAgICAgICAgICAgW2F0dHIuYXJpYS1pbnZhbGlkXT1cXFwiZW1haWwuaW52YWxpZCAmJiBlbWFpbC50b3VjaGVkID8gdHJ1ZSA6IG51bGxcXFwiPlxcbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVxcXCJlbWFpbC5pbnZhbGlkICYmIGVtYWlsLnRvdWNoZWRcXFwiPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJlbWFpbC5lcnJvcnM/LnJlcXVpcmVkXFxcIj5cXG4gICAgICAgIEVtYWlsIGlzIHJlcXVpcmVkIVxcbiAgICAgIDwvcD5cXG4gICAgICA8cCBjbGFzcz1cXFwiY2FwdGlvbiBzdGF0dXMtZGFuZ2VyXFxcIiAqbmdJZj1cXFwiZW1haWwuZXJyb3JzPy5wYXR0ZXJuXFxcIj5cXG4gICAgICAgIEVtYWlsIHNob3VsZCBiZSB0aGUgcmVhbCBvbmUhXFxuICAgICAgPC9wPlxcbiAgICA8L25nLWNvbnRhaW5lcj5cXG4gIDwvZGl2PlxcblxcbiAgPGJ1dHRvbiBuYkJ1dHRvblxcbiAgICAgICAgICBmdWxsV2lkdGhcXG4gICAgICAgICAgc3RhdHVzPVxcXCJwcmltYXJ5XFxcIlxcbiAgICAgICAgICBzaXplPVxcXCJsYXJnZVxcXCJcXG4gICAgICAgICAgW2Rpc2FibGVkXT1cXFwic3VibWl0dGVkIHx8ICFyZXF1ZXN0UGFzc0Zvcm0udmFsaWRcXFwiXFxuICAgICAgICAgIFtjbGFzcy5idG4tcHVsc2VdPVxcXCJzdWJtaXR0ZWRcXFwiPlxcbiAgICBSZXF1ZXN0IHBhc3N3b3JkXFxuICA8L2J1dHRvbj5cXG48L2Zvcm0+XFxuXFxuPHNlY3Rpb24gY2xhc3M9XFxcInNpZ24taW4tb3ItdXBcXFwiIGFyaWEtbGFiZWw9XFxcIlNpZ24gaW4gb3Igc2lnbiB1cFxcXCI+XFxuICA8cD48YSBjbGFzcz1cXFwidGV4dC1saW5rXFxcIiByb3V0ZXJMaW5rPVxcXCIuLi9sb2dpblxcXCI+QmFjayB0byBMb2cgSW48L2E+PC9wPlxcbiAgPHA+PGEgcm91dGVyTGluaz1cXFwiLi4vcmVnaXN0ZXJcXFwiIGNsYXNzPVxcXCJ0ZXh0LWxpbmtcXFwiPlJlZ2lzdGVyPC9hPjwvcD5cXG48L3NlY3Rpb24+XFxuXCIsXG4gICAgICAgICAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgICAgICAgICAgIHN0eWxlczogW1wiOmhvc3QgLmZvcm0tZ3JvdXA6bGFzdC1vZi10eXBle21hcmdpbi1ib3R0b206M3JlbX1cXG5cIl1cbiAgICAgICAgfSksXG4gICAgICAgIF9fcGFyYW0oMSwgSW5qZWN0KE5CX0FVVEhfT1BUSU9OUykpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW05iQXV0aFNlcnZpY2UsIE9iamVjdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICAgICAgICBSb3V0ZXJdKVxuICAgIF0sIE5iUmVxdWVzdFBhc3N3b3JkQ29tcG9uZW50KTtcbiAgICByZXR1cm4gTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQ7XG59KCkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG52YXIgTmJSZXNldFBhc3N3b3JkQ29tcG9uZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iUmVzZXRQYXNzd29yZENvbXBvbmVudChzZXJ2aWNlLCBvcHRpb25zLCBjZCwgcm91dGVyKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuY2QgPSBjZDtcbiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XG4gICAgICAgIHRoaXMucmVkaXJlY3REZWxheSA9IDA7XG4gICAgICAgIHRoaXMuc2hvd01lc3NhZ2VzID0ge307XG4gICAgICAgIHRoaXMuc3RyYXRlZ3kgPSAnJztcbiAgICAgICAgdGhpcy5zdWJtaXR0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lcnJvcnMgPSBbXTtcbiAgICAgICAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuICAgICAgICB0aGlzLnVzZXIgPSB7fTtcbiAgICAgICAgdGhpcy5yZWRpcmVjdERlbGF5ID0gdGhpcy5nZXRDb25maWdWYWx1ZSgnZm9ybXMucmVzZXRQYXNzd29yZC5yZWRpcmVjdERlbGF5Jyk7XG4gICAgICAgIHRoaXMuc2hvd01lc3NhZ2VzID0gdGhpcy5nZXRDb25maWdWYWx1ZSgnZm9ybXMucmVzZXRQYXNzd29yZC5zaG93TWVzc2FnZXMnKTtcbiAgICAgICAgdGhpcy5zdHJhdGVneSA9IHRoaXMuZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnJlc2V0UGFzc3dvcmQuc3RyYXRlZ3knKTtcbiAgICB9XG4gICAgTmJSZXNldFBhc3N3b3JkQ29tcG9uZW50LnByb3RvdHlwZS5yZXNldFBhc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZXJyb3JzID0gdGhpcy5tZXNzYWdlcyA9IFtdO1xuICAgICAgICB0aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VydmljZS5yZXNldFBhc3N3b3JkKHRoaXMuc3RyYXRlZ3ksIHRoaXMudXNlcikuc3Vic2NyaWJlKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgIF90aGlzLnN1Ym1pdHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5pc1N1Y2Nlc3MoKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLm1lc3NhZ2VzID0gcmVzdWx0LmdldE1lc3NhZ2VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5lcnJvcnMgPSByZXN1bHQuZ2V0RXJyb3JzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVkaXJlY3QgPSByZXN1bHQuZ2V0UmVkaXJlY3QoKTtcbiAgICAgICAgICAgIGlmIChyZWRpcmVjdCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwocmVkaXJlY3QpO1xuICAgICAgICAgICAgICAgIH0sIF90aGlzLnJlZGlyZWN0RGVsYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIE5iUmVzZXRQYXNzd29yZENvbXBvbmVudC5wcm90b3R5cGUuZ2V0Q29uZmlnVmFsdWUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiBnZXREZWVwRnJvbU9iamVjdCh0aGlzLm9wdGlvbnMsIGtleSwgbnVsbCk7XG4gICAgfTtcbiAgICBOYlJlc2V0UGFzc3dvcmRDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnbmItcmVzZXQtcGFzc3dvcmQtcGFnZScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCI8aDEgaWQ9XFxcInRpdGxlXFxcIiBjbGFzcz1cXFwidGl0bGVcXFwiPkNoYW5nZSBwYXNzd29yZDwvaDE+XFxuPHAgY2xhc3M9XFxcInN1Yi10aXRsZVxcXCI+UGxlYXNlIHNldCBhIG5ldyBwYXNzd29yZDwvcD5cXG5cXG48bmItYWxlcnQgKm5nSWY9XFxcInNob3dNZXNzYWdlcy5lcnJvciAmJiBlcnJvcnM/Lmxlbmd0aCAmJiAhc3VibWl0dGVkXFxcIiBvdXRsaW5lPVxcXCJkYW5nZXJcXFwiIHJvbGU9XFxcImFsZXJ0XFxcIj5cXG4gIDxwIGNsYXNzPVxcXCJhbGVydC10aXRsZVxcXCI+PGI+T2ggc25hcCE8L2I+PC9wPlxcbiAgPHVsIGNsYXNzPVxcXCJhbGVydC1tZXNzYWdlLWxpc3RcXFwiPlxcbiAgICA8bGkgKm5nRm9yPVxcXCJsZXQgZXJyb3Igb2YgZXJyb3JzXFxcIiBjbGFzcz1cXFwiYWxlcnQtbWVzc2FnZVxcXCI+e3sgZXJyb3IgfX08L2xpPlxcbiAgPC91bD5cXG48L25iLWFsZXJ0PlxcblxcbjxuYi1hbGVydCAqbmdJZj1cXFwic2hvd01lc3NhZ2VzLnN1Y2Nlc3MgJiYgbWVzc2FnZXM/Lmxlbmd0aCAmJiAhc3VibWl0dGVkXFxcIiBvdXRsaW5lPVxcXCJzdWNjZXNzXFxcIiByb2xlPVxcXCJhbGVydFxcXCI+XFxuICA8cCBjbGFzcz1cXFwiYWxlcnQtdGl0bGVcXFwiPjxiPkhvb3JheSE8L2I+PC9wPlxcbiAgPHVsIGNsYXNzPVxcXCJhbGVydC1tZXNzYWdlLWxpc3RcXFwiPlxcbiAgICA8bGkgKm5nRm9yPVxcXCJsZXQgbWVzc2FnZSBvZiBtZXNzYWdlc1xcXCIgY2xhc3M9XFxcImFsZXJ0LW1lc3NhZ2VcXFwiPnt7IG1lc3NhZ2UgfX08L2xpPlxcbiAgPC91bD5cXG48L25iLWFsZXJ0Plxcblxcbjxmb3JtIChuZ1N1Ym1pdCk9XFxcInJlc2V0UGFzcygpXFxcIiAjcmVzZXRQYXNzRm9ybT1cXFwibmdGb3JtXFxcIiBhcmlhLWxhYmVsbGVkYnk9XFxcInRpdGxlXFxcIj5cXG5cXG4gIDxkaXYgY2xhc3M9XFxcImZvcm0tY29udHJvbC1ncm91cFxcXCI+XFxuICAgIDxsYWJlbCBjbGFzcz1cXFwibGFiZWxcXFwiIGZvcj1cXFwiaW5wdXQtcGFzc3dvcmRcXFwiPk5ldyBQYXNzd29yZDo8L2xhYmVsPlxcbiAgICA8aW5wdXQgbmJJbnB1dFxcbiAgICAgICAgICAgWyhuZ01vZGVsKV09XFxcInVzZXIucGFzc3dvcmRcXFwiXFxuICAgICAgICAgICAjcGFzc3dvcmQ9XFxcIm5nTW9kZWxcXFwiXFxuICAgICAgICAgICB0eXBlPVxcXCJwYXNzd29yZFxcXCJcXG4gICAgICAgICAgIGlkPVxcXCJpbnB1dC1wYXNzd29yZFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcInBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgY2xhc3M9XFxcImZpcnN0XFxcIlxcbiAgICAgICAgICAgcGxhY2Vob2xkZXI9XFxcIk5ldyBQYXNzd29yZFxcXCJcXG4gICAgICAgICAgIGF1dG9mb2N1c1xcbiAgICAgICAgICAgZnVsbFdpZHRoXFxuICAgICAgICAgICBmaWVsZFNpemU9XFxcImxhcmdlXFxcIlxcbiAgICAgICAgICAgW3N0YXR1c109XFxcInBhc3N3b3JkLmRpcnR5ID8gKHBhc3N3b3JkLmludmFsaWQgID8gJ2RhbmdlcicgOiAnc3VjY2VzcycpIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbbWlubGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWluTGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbbWF4bGVuZ3RoXT1cXFwiZ2V0Q29uZmlnVmFsdWUoJ2Zvcm1zLnZhbGlkYXRpb24ucGFzc3dvcmQubWF4TGVuZ3RoJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJwYXNzd29yZC5pbnZhbGlkICYmIHBhc3N3b3JkLnRvdWNoZWQgPyB0cnVlIDogbnVsbFxcXCI+XFxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XFxcInBhc3N3b3JkLmludmFsaWQgJiYgcGFzc3dvcmQudG91Y2hlZFxcXCI+XFxuICAgICAgPHAgY2xhc3M9XFxcImNhcHRpb24gc3RhdHVzLWRhbmdlclxcXCIgKm5nSWY9XFxcInBhc3N3b3JkLmVycm9ycz8ucmVxdWlyZWRcXFwiPlxcbiAgICAgICAgUGFzc3dvcmQgaXMgcmVxdWlyZWQhXFxuICAgICAgPC9wPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJwYXNzd29yZC5lcnJvcnM/Lm1pbmxlbmd0aCB8fCBwYXNzd29yZC5lcnJvcnM/Lm1heGxlbmd0aFxcXCI+XFxuICAgICAgICBQYXNzd29yZCBzaG91bGQgY29udGFpbnNcXG4gICAgICAgIGZyb20ge3tnZXRDb25maWdWYWx1ZSgnZm9ybXMudmFsaWRhdGlvbi5wYXNzd29yZC5taW5MZW5ndGgnKX19XFxuICAgICAgICB0byB7e2dldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLm1heExlbmd0aCcpfX1cXG4gICAgICAgIGNoYXJhY3RlcnNcXG4gICAgICA8L3A+XFxuICAgIDwvbmctY29udGFpbmVyPlxcbiAgPC9kaXY+XFxuXFxuICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWdyb3VwXFxcIj5cXG4gICAgPGxhYmVsIGNsYXNzPVxcXCJsYWJlbFxcXCIgZm9yPVxcXCJpbnB1dC1yZS1wYXNzd29yZFxcXCI+Q29uZmlybSBQYXNzd29yZDo8L2xhYmVsPlxcbiAgICA8aW5wdXQgbmJJbnB1dFxcbiAgICAgICAgICAgWyhuZ01vZGVsKV09XFxcInVzZXIuY29uZmlybVBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgI3JlUGFzcz1cXFwibmdNb2RlbFxcXCJcXG4gICAgICAgICAgIGlkPVxcXCJpbnB1dC1yZS1wYXNzd29yZFxcXCJcXG4gICAgICAgICAgIG5hbWU9XFxcInJlUGFzc1xcXCJcXG4gICAgICAgICAgIHR5cGU9XFxcInBhc3N3b3JkXFxcIlxcbiAgICAgICAgICAgY2xhc3M9XFxcImxhc3RcXFwiXFxuICAgICAgICAgICBwbGFjZWhvbGRlcj1cXFwiQ29uZmlybSBQYXNzd29yZFxcXCJcXG4gICAgICAgICAgIGZ1bGxXaWR0aFxcbiAgICAgICAgICAgZmllbGRTaXplPVxcXCJsYXJnZVxcXCJcXG4gICAgICAgICAgIFtzdGF0dXNdPVxcXCJyZVBhc3MudG91Y2hlZFxcbiAgICAgICAgICAgICAgID8gKHJlUGFzcy5pbnZhbGlkIHx8IHBhc3N3b3JkLnZhbHVlICE9IHJlUGFzcy52YWx1ZSA/ICdkYW5nZXInIDogJ3N1Y2Nlc3MnKVxcbiAgICAgICAgICAgICAgIDogJ2Jhc2ljJ1xcXCJcXG4gICAgICAgICAgIFtyZXF1aXJlZF09XFxcImdldENvbmZpZ1ZhbHVlKCdmb3Jtcy52YWxpZGF0aW9uLnBhc3N3b3JkLnJlcXVpcmVkJylcXFwiXFxuICAgICAgICAgICBbYXR0ci5hcmlhLWludmFsaWRdPVxcXCJyZVBhc3MuaW52YWxpZCAmJiByZVBhc3MudG91Y2hlZCA/IHRydWUgOiBudWxsXFxcIj5cXG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cXFwicmVQYXNzLnRvdWNoZWRcXFwiPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJyZVBhc3MuaW52YWxpZCAmJiByZVBhc3MuZXJyb3JzPy5yZXF1aXJlZFxcXCI+XFxuICAgICAgICBQYXNzd29yZCBjb25maXJtYXRpb24gaXMgcmVxdWlyZWQhXFxuICAgICAgPC9wPlxcbiAgICAgIDxwIGNsYXNzPVxcXCJjYXB0aW9uIHN0YXR1cy1kYW5nZXJcXFwiICpuZ0lmPVxcXCJwYXNzd29yZC52YWx1ZSAhPSByZVBhc3MudmFsdWUgJiYgIXJlUGFzcy5lcnJvcnM/LnJlcXVpcmVkXFxcIj5cXG4gICAgICAgIFBhc3N3b3JkIGRvZXMgbm90IG1hdGNoIHRoZSBjb25maXJtIHBhc3N3b3JkLlxcbiAgICAgIDwvcD5cXG4gICAgPC9uZy1jb250YWluZXI+XFxuICA8L2Rpdj5cXG5cXG4gIDxidXR0b24gbmJCdXR0b25cXG4gICAgICAgICAgc3RhdHVzPVxcXCJwcmltYXJ5XFxcIlxcbiAgICAgICAgICBmdWxsV2lkdGhcXG4gICAgICAgICAgc2l6ZT1cXFwibGFyZ2VcXFwiXFxuICAgICAgICAgIFtkaXNhYmxlZF09XFxcInN1Ym1pdHRlZCB8fCAhcmVzZXRQYXNzRm9ybS52YWxpZFxcXCJcXG4gICAgICAgICAgW2NsYXNzLmJ0bi1wdWxzZV09XFxcInN1Ym1pdHRlZFxcXCI+XFxuICAgIENoYW5nZSBwYXNzd29yZFxcbiAgPC9idXR0b24+XFxuPC9mb3JtPlxcblxcbjxzZWN0aW9uIGNsYXNzPVxcXCJzaWduLWluLW9yLXVwXFxcIiBhcmlhLWxhYmVsPVxcXCJTaWduIGluIG9yIHNpZ24gdXBcXFwiPlxcbiAgPHA+PGEgY2xhc3M9XFxcInRleHQtbGlua1xcXCIgcm91dGVyTGluaz1cXFwiLi4vbG9naW5cXFwiPkJhY2sgdG8gTG9nIEluPC9hPjwvcD5cXG4gIDxwPjxhIGNsYXNzPVxcXCJ0ZXh0LWxpbmtcXFwiIHJvdXRlckxpbms9XFxcIi4uL3JlZ2lzdGVyXFxcIj5SZWdpc3RlcjwvYT48L3A+XFxuPC9zZWN0aW9uPlxcblwiLFxuICAgICAgICAgICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgICAgICAgICBzdHlsZXM6IFtcIjpob3N0IC5mb3JtLWdyb3VwOmxhc3Qtb2YtdHlwZXttYXJnaW4tYm90dG9tOjNyZW19XFxuXCJdXG4gICAgICAgIH0pLFxuICAgICAgICBfX3BhcmFtKDEsIEluamVjdChOQl9BVVRIX09QVElPTlMpKSxcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtOYkF1dGhTZXJ2aWNlLCBPYmplY3QsIENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgUm91dGVyXSlcbiAgICBdLCBOYlJlc2V0UGFzc3dvcmRDb21wb25lbnQpO1xuICAgIHJldHVybiBOYlJlc2V0UGFzc3dvcmRDb21wb25lbnQ7XG59KCkpO1xuXG5mdW5jdGlvbiBuYlN0cmF0ZWdpZXNGYWN0b3J5KG9wdGlvbnMsIGluamVjdG9yKSB7XG4gICAgdmFyIHN0cmF0ZWdpZXMgPSBbXTtcbiAgICBvcHRpb25zLnN0cmF0ZWdpZXNcbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciBzdHJhdGVneUNsYXNzID0gX2FbMF0sIHN0cmF0ZWd5T3B0aW9ucyA9IF9hWzFdO1xuICAgICAgICB2YXIgc3RyYXRlZ3kgPSBpbmplY3Rvci5nZXQoc3RyYXRlZ3lDbGFzcyk7XG4gICAgICAgIHN0cmF0ZWd5LnNldE9wdGlvbnMoc3RyYXRlZ3lPcHRpb25zKTtcbiAgICAgICAgc3RyYXRlZ2llcy5wdXNoKHN0cmF0ZWd5KTtcbiAgICB9KTtcbiAgICByZXR1cm4gc3RyYXRlZ2llcztcbn1cbmZ1bmN0aW9uIG5iVG9rZW5zRmFjdG9yeShzdHJhdGVnaWVzKSB7XG4gICAgdmFyIHRva2VucyA9IFtdO1xuICAgIHN0cmF0ZWdpZXNcbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKHN0cmF0ZWd5KSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHN0cmF0ZWd5LmdldE9wdGlvbigndG9rZW4uY2xhc3MnKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRva2Vucztcbn1cbmZ1bmN0aW9uIG5iT3B0aW9uc0ZhY3Rvcnkob3B0aW9ucykge1xuICAgIHJldHVybiBkZWVwRXh0ZW5kKGRlZmF1bHRBdXRoT3B0aW9ucywgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBuYk5vT3BJbnRlcmNlcHRvckZpbHRlcihyZXEpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbnZhciBOYkF1dGhNb2R1bGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmJBdXRoTW9kdWxlKCkge1xuICAgIH1cbiAgICBOYkF1dGhNb2R1bGVfMSA9IE5iQXV0aE1vZHVsZTtcbiAgICBOYkF1dGhNb2R1bGUuZm9yUm9vdCA9IGZ1bmN0aW9uIChuYkF1dGhPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZ01vZHVsZTogTmJBdXRoTW9kdWxlXzEsXG4gICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICB7IHByb3ZpZGU6IE5CX0FVVEhfVVNFUl9PUFRJT05TLCB1c2VWYWx1ZTogbmJBdXRoT3B0aW9ucyB9LFxuICAgICAgICAgICAgICAgIHsgcHJvdmlkZTogTkJfQVVUSF9PUFRJT05TLCB1c2VGYWN0b3J5OiBuYk9wdGlvbnNGYWN0b3J5LCBkZXBzOiBbTkJfQVVUSF9VU0VSX09QVElPTlNdIH0sXG4gICAgICAgICAgICAgICAgeyBwcm92aWRlOiBOQl9BVVRIX1NUUkFURUdJRVMsIHVzZUZhY3Rvcnk6IG5iU3RyYXRlZ2llc0ZhY3RvcnksIGRlcHM6IFtOQl9BVVRIX09QVElPTlMsIEluamVjdG9yXSB9LFxuICAgICAgICAgICAgICAgIHsgcHJvdmlkZTogTkJfQVVUSF9UT0tFTlMsIHVzZUZhY3Rvcnk6IG5iVG9rZW5zRmFjdG9yeSwgZGVwczogW05CX0FVVEhfU1RSQVRFR0lFU10gfSxcbiAgICAgICAgICAgICAgICB7IHByb3ZpZGU6IE5CX0FVVEhfRkFMTEJBQ0tfVE9LRU4sIHVzZVZhbHVlOiBOYkF1dGhTaW1wbGVUb2tlbiB9LFxuICAgICAgICAgICAgICAgIHsgcHJvdmlkZTogTkJfQVVUSF9JTlRFUkNFUFRPUl9IRUFERVIsIHVzZVZhbHVlOiAnQXV0aG9yaXphdGlvbicgfSxcbiAgICAgICAgICAgICAgICB7IHByb3ZpZGU6IE5CX0FVVEhfVE9LRU5fSU5URVJDRVBUT1JfRklMVEVSLCB1c2VWYWx1ZTogbmJOb09wSW50ZXJjZXB0b3JGaWx0ZXIgfSxcbiAgICAgICAgICAgICAgICB7IHByb3ZpZGU6IE5iVG9rZW5TdG9yYWdlLCB1c2VDbGFzczogTmJUb2tlbkxvY2FsU3RvcmFnZSB9LFxuICAgICAgICAgICAgICAgIE5iQXV0aFRva2VuUGFyY2VsZXIsXG4gICAgICAgICAgICAgICAgTmJBdXRoU2VydmljZSxcbiAgICAgICAgICAgICAgICBOYlRva2VuU2VydmljZSxcbiAgICAgICAgICAgICAgICBOYkR1bW15QXV0aFN0cmF0ZWd5LFxuICAgICAgICAgICAgICAgIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3ksXG4gICAgICAgICAgICAgICAgTmJPQXV0aDJBdXRoU3RyYXRlZ3ksXG4gICAgICAgICAgICBdLFxuICAgICAgICB9O1xuICAgIH07XG4gICAgdmFyIE5iQXV0aE1vZHVsZV8xO1xuICAgIE5iQXV0aE1vZHVsZSA9IE5iQXV0aE1vZHVsZV8xID0gX19kZWNvcmF0ZShbXG4gICAgICAgIE5nTW9kdWxlKHtcbiAgICAgICAgICAgIGltcG9ydHM6IFtcbiAgICAgICAgICAgICAgICBDb21tb25Nb2R1bGUsXG4gICAgICAgICAgICAgICAgTmJMYXlvdXRNb2R1bGUsXG4gICAgICAgICAgICAgICAgTmJDYXJkTW9kdWxlLFxuICAgICAgICAgICAgICAgIE5iQ2hlY2tib3hNb2R1bGUsXG4gICAgICAgICAgICAgICAgTmJBbGVydE1vZHVsZSxcbiAgICAgICAgICAgICAgICBOYklucHV0TW9kdWxlLFxuICAgICAgICAgICAgICAgIE5iQnV0dG9uTW9kdWxlLFxuICAgICAgICAgICAgICAgIFJvdXRlck1vZHVsZSxcbiAgICAgICAgICAgICAgICBGb3Jtc01vZHVsZSxcbiAgICAgICAgICAgICAgICBOYkljb25Nb2R1bGUsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgZGVjbGFyYXRpb25zOiBbXG4gICAgICAgICAgICAgICAgTmJBdXRoQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIE5iQXV0aEJsb2NrQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIE5iTG9naW5Db21wb25lbnQsXG4gICAgICAgICAgICAgICAgTmJSZWdpc3RlckNvbXBvbmVudCxcbiAgICAgICAgICAgICAgICBOYlJlcXVlc3RQYXNzd29yZENvbXBvbmVudCxcbiAgICAgICAgICAgICAgICBOYlJlc2V0UGFzc3dvcmRDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgTmJMb2dvdXRDb21wb25lbnQsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgZXhwb3J0czogW1xuICAgICAgICAgICAgICAgIE5iQXV0aENvbXBvbmVudCxcbiAgICAgICAgICAgICAgICBOYkF1dGhCbG9ja0NvbXBvbmVudCxcbiAgICAgICAgICAgICAgICBOYkxvZ2luQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIE5iUmVnaXN0ZXJDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQsXG4gICAgICAgICAgICAgICAgTmJSZXNldFBhc3N3b3JkQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIE5iTG9nb3V0Q29tcG9uZW50LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSlcbiAgICBdLCBOYkF1dGhNb2R1bGUpO1xuICAgIHJldHVybiBOYkF1dGhNb2R1bGU7XG59KCkpO1xuXG52YXIgcm91dGVzID0gW1xuICAgIHtcbiAgICAgICAgcGF0aDogJ2F1dGgnLFxuICAgICAgICBjb21wb25lbnQ6IE5iQXV0aENvbXBvbmVudCxcbiAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXRoOiAnJyxcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6IE5iTG9naW5Db21wb25lbnQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhdGg6ICdsb2dpbicsXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiBOYkxvZ2luQ29tcG9uZW50LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwYXRoOiAncmVnaXN0ZXInLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogTmJSZWdpc3RlckNvbXBvbmVudCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGF0aDogJ2xvZ291dCcsXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiBOYkxvZ291dENvbXBvbmVudCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcGF0aDogJ3JlcXVlc3QtcGFzc3dvcmQnLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHBhdGg6ICdyZXNldC1wYXNzd29yZCcsXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiBOYlJlc2V0UGFzc3dvcmRDb21wb25lbnQsXG4gICAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgIH0sXG5dO1xuXG52YXIgTmJBdXRoSldUSW50ZXJjZXB0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmJBdXRoSldUSW50ZXJjZXB0b3IoaW5qZWN0b3IsIGZpbHRlciQkMSkge1xuICAgICAgICB0aGlzLmluamVjdG9yID0gaW5qZWN0b3I7XG4gICAgICAgIHRoaXMuZmlsdGVyID0gZmlsdGVyJCQxO1xuICAgIH1cbiAgICBOYkF1dGhKV1RJbnRlcmNlcHRvci5wcm90b3R5cGUuaW50ZXJjZXB0ID0gZnVuY3Rpb24gKHJlcSwgbmV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAvLyBkbyBub3QgaW50ZXJjZXB0IHJlcXVlc3Qgd2hvc2UgdXJscyBhcmUgZmlsdGVyZWQgYnkgdGhlIGluamVjdGVkIGZpbHRlclxuICAgICAgICBpZiAoIXRoaXMuZmlsdGVyKHJlcSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZE9yUmVmcmVzaCgpXG4gICAgICAgICAgICAgICAgLnBpcGUoc3dpdGNoTWFwKGZ1bmN0aW9uIChhdXRoZW50aWNhdGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGF1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmF1dGhTZXJ2aWNlLmdldFRva2VuKCkucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgSldUID0gXCJCZWFyZXIgXCIgKyB0b2tlbi5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxID0gcmVxLmNsb25lKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRIZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IEpXVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxKTtcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWVzdCBpcyBzZW50IHRvIHNlcnZlciB3aXRob3V0IGF1dGhlbnRpY2F0aW9uIHNvIHRoYXQgdGhlIGNsaWVudCBjb2RlXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlY2VpdmVzIHRoZSA0MDEvNDAzIGVycm9yIGFuZCBjYW4gYWN0IGFzIGRlc2lyZWQgKCdzZXNzaW9uIGV4cGlyZWQnLCByZWRpcmVjdCB0byBsb2dpbiwgYXNvKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5iQXV0aEpXVEludGVyY2VwdG9yLnByb3RvdHlwZSwgXCJhdXRoU2VydmljZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5qZWN0b3IuZ2V0KE5iQXV0aFNlcnZpY2UpO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBOYkF1dGhKV1RJbnRlcmNlcHRvciA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBJbmplY3RhYmxlKCksXG4gICAgICAgIF9fcGFyYW0oMSwgSW5qZWN0KE5CX0FVVEhfVE9LRU5fSU5URVJDRVBUT1JfRklMVEVSKSksXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbSW5qZWN0b3IsIE9iamVjdF0pXG4gICAgXSwgTmJBdXRoSldUSW50ZXJjZXB0b3IpO1xuICAgIHJldHVybiBOYkF1dGhKV1RJbnRlcmNlcHRvcjtcbn0oKSk7XG5cbnZhciBOYkF1dGhTaW1wbGVJbnRlcmNlcHRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOYkF1dGhTaW1wbGVJbnRlcmNlcHRvcihpbmplY3RvciwgaGVhZGVyTmFtZSkge1xuICAgICAgICBpZiAoaGVhZGVyTmFtZSA9PT0gdm9pZCAwKSB7IGhlYWRlck5hbWUgPSAnQXV0aG9yaXphdGlvbic7IH1cbiAgICAgICAgdGhpcy5pbmplY3RvciA9IGluamVjdG9yO1xuICAgICAgICB0aGlzLmhlYWRlck5hbWUgPSBoZWFkZXJOYW1lO1xuICAgIH1cbiAgICBOYkF1dGhTaW1wbGVJbnRlcmNlcHRvci5wcm90b3R5cGUuaW50ZXJjZXB0ID0gZnVuY3Rpb24gKHJlcSwgbmV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5hdXRoU2VydmljZS5nZXRUb2tlbigpXG4gICAgICAgICAgICAucGlwZShzd2l0Y2hNYXAoZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBpZiAodG9rZW4gJiYgdG9rZW4uZ2V0VmFsdWUoKSkge1xuICAgICAgICAgICAgICAgIHJlcSA9IHJlcS5jbG9uZSh7XG4gICAgICAgICAgICAgICAgICAgIHNldEhlYWRlcnM6IChfYSA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX2FbX3RoaXMuaGVhZGVyTmFtZV0gPSB0b2tlbi5nZXRWYWx1ZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgX2EpLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5leHQuaGFuZGxlKHJlcSk7XG4gICAgICAgIH0pKTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShOYkF1dGhTaW1wbGVJbnRlcmNlcHRvci5wcm90b3R5cGUsIFwiYXV0aFNlcnZpY2VcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluamVjdG9yLmdldChOYkF1dGhTZXJ2aWNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgTmJBdXRoU2ltcGxlSW50ZXJjZXB0b3IgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5qZWN0YWJsZSgpLFxuICAgICAgICBfX3BhcmFtKDEsIEluamVjdChOQl9BVVRIX0lOVEVSQ0VQVE9SX0hFQURFUikpLFxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0luamVjdG9yLCBTdHJpbmddKVxuICAgIF0sIE5iQXV0aFNpbXBsZUludGVyY2VwdG9yKTtcbiAgICByZXR1cm4gTmJBdXRoU2ltcGxlSW50ZXJjZXB0b3I7XG59KCkpO1xuXG52YXIgTmJVc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5iVXNlcihpZCwgZW1haWwsIHBhc3N3b3JkLCByZW1lbWJlck1lLCB0ZXJtcywgY29uZmlybVBhc3N3b3JkLCBmdWxsTmFtZSkge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMuZW1haWwgPSBlbWFpbDtcbiAgICAgICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkO1xuICAgICAgICB0aGlzLnJlbWVtYmVyTWUgPSByZW1lbWJlck1lO1xuICAgICAgICB0aGlzLnRlcm1zID0gdGVybXM7XG4gICAgICAgIHRoaXMuY29uZmlybVBhc3N3b3JkID0gY29uZmlybVBhc3N3b3JkO1xuICAgICAgICB0aGlzLmZ1bGxOYW1lID0gZnVsbE5hbWU7XG4gICAgfVxuICAgIHJldHVybiBOYlVzZXI7XG59KCkpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgQWt2ZW8uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICovXG5cbi8qKlxuICogR2VuZXJhdGVkIGJ1bmRsZSBpbmRleC4gRG8gbm90IGVkaXQuXG4gKi9cblxuZXhwb3J0IHsgZGVmYXVsdEF1dGhPcHRpb25zLCBOQl9BVVRIX09QVElPTlMsIE5CX0FVVEhfVVNFUl9PUFRJT05TLCBOQl9BVVRIX1NUUkFURUdJRVMsIE5CX0FVVEhfVE9LRU5TLCBOQl9BVVRIX0lOVEVSQ0VQVE9SX0hFQURFUiwgTkJfQVVUSF9UT0tFTl9JTlRFUkNFUFRPUl9GSUxURVIsIG5iU3RyYXRlZ2llc0ZhY3RvcnksIG5iVG9rZW5zRmFjdG9yeSwgbmJPcHRpb25zRmFjdG9yeSwgbmJOb09wSW50ZXJjZXB0b3JGaWx0ZXIsIE5iQXV0aE1vZHVsZSwgcm91dGVzLCBOYkF1dGhDb21wb25lbnQsIE5iQXV0aEJsb2NrQ29tcG9uZW50LCBOYkxvZ2luQ29tcG9uZW50LCBOYkxvZ291dENvbXBvbmVudCwgTmJSZWdpc3RlckNvbXBvbmVudCwgTmJSZXF1ZXN0UGFzc3dvcmRDb21wb25lbnQsIE5iUmVzZXRQYXNzd29yZENvbXBvbmVudCwgTmJBdXRoU2VydmljZSwgTmJBdXRoUmVzdWx0LCBOYkF1dGhKV1RJbnRlcmNlcHRvciwgTmJBdXRoU2ltcGxlSW50ZXJjZXB0b3IsIE5iQXV0aFRva2VuLCBOYkF1dGhUb2tlbk5vdEZvdW5kRXJyb3IsIE5iQXV0aElsbGVnYWxUb2tlbkVycm9yLCBOYkF1dGhFbXB0eVRva2VuRXJyb3IsIE5iQXV0aElsbGVnYWxKV1RUb2tlbkVycm9yLCBuYkF1dGhDcmVhdGVUb2tlbiwgZGVjb2RlSnd0UGF5bG9hZCwgTmJBdXRoU2ltcGxlVG9rZW4sIE5iQXV0aEpXVFRva2VuLCBOYkF1dGhPQXV0aDJUb2tlbiwgTmJBdXRoT0F1dGgySldUVG9rZW4sIMm1MCwgTmJUb2tlblN0b3JhZ2UsIE5iVG9rZW5Mb2NhbFN0b3JhZ2UsIE5iVG9rZW5TZXJ2aWNlLCBOQl9BVVRIX0ZBTExCQUNLX1RPS0VOLCBOYkF1dGhUb2tlblBhcmNlbGVyLCBOYkF1dGhTdHJhdGVneSwgTmJBdXRoU3RyYXRlZ3lPcHRpb25zLCBOYkR1bW15QXV0aFN0cmF0ZWd5LCBOYkR1bW15QXV0aFN0cmF0ZWd5T3B0aW9ucywgZHVtbXlTdHJhdGVneU9wdGlvbnMsIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3ksIE5iUGFzc3dvcmRBdXRoU3RyYXRlZ3lPcHRpb25zLCBwYXNzd29yZFN0cmF0ZWd5T3B0aW9ucywgTmJPQXV0aDJBdXRoU3RyYXRlZ3ksIE5iT0F1dGgyUmVzcG9uc2VUeXBlLCBOYk9BdXRoMkdyYW50VHlwZSwgTmJPQXV0aDJDbGllbnRBdXRoTWV0aG9kLCBOYk9BdXRoMkF1dGhTdHJhdGVneU9wdGlvbnMsIGF1dGgyU3RyYXRlZ3lPcHRpb25zLCBOYlVzZXIsIGRlZXBFeHRlbmQsIGdldERlZXBGcm9tT2JqZWN0LCB1cmxCYXNlNjREZWNvZGUsIGI2NGRlY29kZSwgYjY0RGVjb2RlVW5pY29kZSB9O1xuIl19